<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Order - Dealer Portal</title>
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
    }

    /* Header */
    .dealer-header {
      background: #2d5a27;
      color: white;
      padding: 0 24px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }
    .dealer-header-left { display: flex; align-items: center; gap: 16px; }
    .dealer-header img { height: 32px; }
    .dealer-header h1 { font-size: 18px; font-weight: 600; }
    .tier-badge {
      background: rgba(255,255,255,0.2);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .tier-badge.bronze { background: #cd7f32; }
    .tier-badge.silver { background: #c0c0c0; color: #333; }
    .tier-badge.gold { background: #ffd700; color: #333; }
    .dealer-header-right { display: flex; align-items: center; gap: 16px; }
    .btn-logout {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    /* Navigation */
    .dealer-nav {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      position: fixed;
      top: 64px;
      left: 0;
      right: 0;
      z-index: 99;
      padding: 0 24px;
    }
    .nav-links { display: flex; gap: 8px; max-width: 1600px; margin: 0 auto; }
    .nav-link {
      padding: 16px 20px;
      color: #6b7280;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 2px solid transparent;
    }
    .nav-link:hover { color: #2d5a27; }
    .nav-link.active { color: #2d5a27; border-bottom-color: #2d5a27; }

    /* Main Content */
    .dealer-main {
      margin-top: 120px;
      padding: 24px;
      max-width: 1600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Page Header */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .page-title { font-size: 24px; font-weight: 700; color: #1a1a2e; }
    .btn-back {
      color: #6b7280;
      text-decoration: none;
      font-size: 14px;
    }
    .btn-back:hover { color: #2d5a27; }

    /* Info Box */
    .info-box {
      background: linear-gradient(135deg, #2d5a27 0%, #1a3a15 100%);
      color: white;
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    .info-box-text { font-size: 15px; }
    .info-box-text strong { color: #90EE90; }
    .discount-badge-large {
      background: rgba(255,255,255,0.2);
      padding: 8px 20px;
      border-radius: 24px;
      font-size: 18px;
      font-weight: 700;
    }

    /* Layout Grid */
    .order-layout {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 24px;
    }
    @media (max-width: 1200px) {
      .order-layout { grid-template-columns: 1fr; }
    }

    /* Form Cards */
    .form-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      margin-bottom: 24px;
      overflow: hidden;
    }
    .card-header {
      padding: 16px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: #1a1a2e;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card-title .step {
      background: #2d5a27;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }
    .card-body { padding: 24px; }

    /* Product Selection */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }
    .product-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .product-card:hover { border-color: #2d5a27; transform: translateY(-2px); }
    .product-card.selected { border-color: #2d5a27; background: #f0f9f0; }
    .product-card img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 8px;
      background: #f3f4f6;
    }
    .product-card .name { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
    .product-card .price { color: #2d5a27; font-weight: 600; font-size: 14px; }

    /* Customer Form */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }
    @media (max-width: 640px) {
      .form-row { grid-template-columns: 1fr; }
    }
    .form-group { margin-bottom: 16px; }
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #1a1a2e;
      margin-bottom: 6px;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #2d5a27;
    }

    /* Dimensions */
    .dimension-row {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }
    .dimension-group { flex: 1; }
    .dimension-input-wrapper {
      display: flex;
      align-items: center;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }
    .dimension-input-wrapper input {
      flex: 1;
      padding: 12px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
    }
    .dimension-input-wrapper input:focus { outline: none; }
    .dimension-input-wrapper .unit {
      padding: 12px;
      background: #f3f4f6;
      font-size: 14px;
      color: #6b7280;
    }

    /* Fabric Selection */
    .filter-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .filter-btn {
      padding: 10px 20px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn:hover { border-color: #2d5a27; }
    .filter-btn.selected {
      border-color: #2d5a27;
      background: #2d5a27;
      color: white;
    }
    .fabric-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }
    .fabric-swatch {
      width: 80px;
      text-align: center;
      cursor: pointer;
      padding: 4px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .fabric-swatch:hover { background: #f0f9f0; }
    .fabric-swatch.selected { background: #d1fae5; }
    .fabric-swatch img {
      width: 60px;
      height: 60px;
      border-radius: 6px;
      object-fit: cover;
      border: 2px solid transparent;
    }
    .fabric-swatch.selected img { border-color: #2d5a27; }
    .fabric-swatch .code { font-size: 10px; color: #6b7280; margin-top: 4px; }

    /* Hardware Options */
    .hardware-section { margin-bottom: 20px; }
    .hardware-label {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a2e;
      margin-bottom: 10px;
      display: block;
    }
    .hardware-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .hardware-option {
      padding: 10px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      text-align: center;
      min-width: 100px;
      transition: all 0.2s;
    }
    .hardware-option:hover { border-color: #2d5a27; }
    .hardware-option.selected {
      border-color: #2d5a27;
      background: #f0f9f0;
    }
    .hardware-option .name { font-size: 13px; font-weight: 500; }
    .hardware-option .price { font-size: 11px; color: #2d5a27; margin-top: 2px; }

    /* Accessories */
    .accessory-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
    }
    .accessory-option:hover { background: #f9fafb; }
    .accessory-option.selected { background: #f0f9f0; border-color: #2d5a27; }
    .accessory-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid #e5e7eb;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .accessory-option.selected .accessory-checkbox {
      background: #2d5a27;
      border-color: #2d5a27;
      color: white;
    }
    .accessory-info { flex: 1; }
    .accessory-name { font-weight: 500; font-size: 14px; }
    .accessory-desc { font-size: 12px; color: #6b7280; }
    .accessory-price { font-weight: 600; color: #2d5a27; }

    /* Order Summary Sidebar */
    .summary-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      position: sticky;
      top: 140px;
    }
    .summary-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
    }
    .summary-title { font-size: 18px; font-weight: 700; }
    .summary-body { padding: 24px; }
    .summary-product {
      display: flex;
      gap: 12px;
      padding-bottom: 16px;
      border-bottom: 1px solid #f3f4f6;
      margin-bottom: 16px;
    }
    .summary-product img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      background: #f3f4f6;
    }
    .summary-product-info { flex: 1; }
    .summary-product-name { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
    .summary-product-details { font-size: 12px; color: #6b7280; }
    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 14px;
    }
    .summary-row .label { color: #6b7280; }
    .summary-row .value { font-weight: 600; }
    .summary-row.discount .value { color: #10b981; }
    .summary-row.total {
      font-size: 18px;
      padding-top: 16px;
      margin-top: 8px;
      border-top: 2px solid #e5e7eb;
    }
    .summary-row.total .label { font-weight: 600; }
    .summary-row.total .value { color: #2d5a27; }

    /* Quantity */
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #f3f4f6;
    }
    .quantity-label { font-size: 14px; font-weight: 500; }
    .quantity-buttons {
      display: flex;
      align-items: center;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }
    .qty-btn {
      width: 36px;
      height: 36px;
      border: none;
      background: #f3f4f6;
      font-size: 18px;
      cursor: pointer;
    }
    .qty-btn:hover { background: #e5e7eb; }
    .qty-value {
      width: 50px;
      text-align: center;
      font-weight: 600;
      font-size: 16px;
    }

    /* Buttons */
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 24px;
    }
    .btn {
      padding: 16px 24px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      text-align: center;
      text-decoration: none;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #2d5a27;
      color: white;
      border: none;
    }
    .btn-primary:hover { background: #1a3a15; }
    .btn-primary:disabled { background: #9ca3af; cursor: not-allowed; }
    .btn-secondary {
      background: white;
      color: #1a1a2e;
      border: 1px solid #e5e7eb;
    }
    .btn-secondary:hover { background: #f3f4f6; }

    /* Loading */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #e5e7eb;
      border-top-color: #2d5a27;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <header class="dealer-header">
    <div class="dealer-header-left">
      <img src="/images/logo-white.png" alt="Peekaboo Shades" onerror="this.src='/images/logo.png'">
      <h1>Dealer Portal</h1>
      <span id="tier-badge" class="tier-badge">Bronze</span>
    </div>
    <div class="dealer-header-right">
      <button class="btn-logout" onclick="logout()">Logout</button>
    </div>
  </header>

  <nav class="dealer-nav">
    <div class="nav-links">
      <a href="/dealer/" class="nav-link">Dashboard</a>
      <a href="/dealer/orders.html" class="nav-link active">Orders</a>
      <a href="/dealer/customers.html" class="nav-link">Customers</a>
      <a href="/dealer/commissions.html" class="nav-link">Commissions</a>
    </div>
  </nav>

  <main class="dealer-main">
    <div class="page-header">
      <h1 class="page-title">Create New Order</h1>
      <a href="/dealer/orders.html" class="btn-back">&larr; Back to Orders</a>
    </div>

    <div class="info-box">
      <div class="info-box-text">
        As a <strong id="tier-text">Bronze</strong> tier dealer, you receive exclusive wholesale pricing on all orders.
      </div>
      <div class="discount-badge-large" id="discount-badge">15% OFF</div>
    </div>

    <div class="order-layout">
      <div class="order-configurator">
        <!-- Step 1: Select Product -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">1</span> Select Product</h3>
          </div>
          <div class="card-body">
            <div class="product-grid" id="product-grid">
              <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                <div class="loading-spinner"></div>
                <p style="margin-top: 12px; color: #6b7280;">Loading products...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Customer Info -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">2</span> Customer Information</h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Select Existing Customer</label>
              <select class="form-select" id="customer-select" onchange="selectCustomer(this.value)">
                <option value="">-- New Customer --</option>
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Customer Name *</label>
                <input type="text" class="form-input" id="customer-name" required>
              </div>
              <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="customer-email">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Phone</label>
                <input type="tel" class="form-input" id="customer-phone">
              </div>
              <div class="form-group">
                <label class="form-label">Address</label>
                <input type="text" class="form-input" id="customer-address">
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Dimensions -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">3</span> Dimensions</h3>
          </div>
          <div class="card-body">
            <div class="dimension-row">
              <div class="dimension-group">
                <label class="form-label">Width</label>
                <div class="dimension-input-wrapper">
                  <input type="number" id="width-input" value="24" min="12" max="120" step="0.125" onchange="calculatePrice()">
                  <span class="unit">in</span>
                </div>
              </div>
              <div class="dimension-group">
                <label class="form-label">Height</label>
                <div class="dimension-input-wrapper">
                  <input type="number" id="height-input" value="36" min="12" max="120" step="0.125" onchange="calculatePrice()">
                  <span class="unit">in</span>
                </div>
              </div>
            </div>
            <div style="background: #f0f9f0; padding: 12px; border-radius: 8px; font-size: 13px; color: #1a1a2e;">
              <strong>Area:</strong> <span id="area-display">6.00</span> sq ft
            </div>
          </div>
        </div>

        <!-- Step 4: Fabric -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">4</span> Shade Style & Fabric</h3>
          </div>
          <div class="card-body">
            <div class="hardware-section">
              <span class="hardware-label">Light Filtering</span>
              <div class="filter-buttons" id="filter-buttons">
                <button type="button" class="filter-btn" data-value="light-filtering" onclick="selectFilter(this)">Light Filtering</button>
                <button type="button" class="filter-btn selected" data-value="blackout" onclick="selectFilter(this)">Blackout</button>
                <button type="button" class="filter-btn" data-value="semi-blackout" onclick="selectFilter(this)">Semi-Blackout</button>
              </div>
            </div>
            <div class="hardware-section">
              <span class="hardware-label">Fabric Color</span>
              <div class="fabric-grid" id="fabric-grid">
                <p style="color: #6b7280; width: 100%; text-align: center; padding: 20px;">Select a product to see available fabrics</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 5: Hardware Options -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">5</span> Hardware Options</h3>
          </div>
          <div class="card-body">
            <div class="hardware-section">
              <span class="hardware-label">Mount Type</span>
              <div class="hardware-options" id="mount-options">
                <div class="hardware-option selected" data-value="inside" onclick="selectHardware(this, 'mount')">
                  <div class="name">Inside Mount</div>
                  <div class="price">Included</div>
                </div>
                <div class="hardware-option" data-value="outside" onclick="selectHardware(this, 'mount')">
                  <div class="name">Outside Mount</div>
                  <div class="price">Included</div>
                </div>
              </div>
            </div>

            <div class="hardware-section">
              <span class="hardware-label">Control Type</span>
              <div class="hardware-options" id="control-options">
                <div class="hardware-option selected" data-value="chain" data-price="0" onclick="selectHardware(this, 'control')">
                  <div class="name">Bead Chain</div>
                  <div class="price">Included</div>
                </div>
                <div class="hardware-option" data-value="cordless" data-price="0" onclick="selectHardware(this, 'control')">
                  <div class="name">Cordless</div>
                  <div class="price">Included</div>
                </div>
                <div class="hardware-option" data-value="motorized" data-price="0" onclick="selectHardware(this, 'control')">
                  <div class="name">Motorized</div>
                  <div class="price">+Motor Cost</div>
                </div>
              </div>
            </div>

            <div class="hardware-section" id="motor-section" style="display: none;">
              <span class="hardware-label">Motor Brand</span>
              <div class="hardware-options" id="motor-options">
                <div class="hardware-option selected" data-value="aok" data-price="55" onclick="selectHardware(this, 'motor')">
                  <div class="name">AOK Motor</div>
                  <div class="price">+$55.00</div>
                </div>
                <div class="hardware-option" data-value="dooya" data-price="47" onclick="selectHardware(this, 'motor')">
                  <div class="name">Dooya Motor</div>
                  <div class="price">+$47.00</div>
                </div>
              </div>
            </div>

            <div class="hardware-section">
              <span class="hardware-label">Valance Type</span>
              <div class="hardware-options" id="valance-options">
                <div class="hardware-option selected" data-value="none" data-price="0" onclick="selectHardware(this, 'valance')">
                  <div class="name">No Valance</div>
                  <div class="price">Included</div>
                </div>
                <div class="hardware-option" data-value="fabric" data-price="2.20" data-unit="sqm" onclick="selectHardware(this, 'valance')">
                  <div class="name">Fabric Wrapped</div>
                  <div class="price">+$2.20/m²</div>
                </div>
              </div>
            </div>

            <div class="hardware-section">
              <span class="hardware-label">Bottom Rail</span>
              <div class="hardware-options" id="rail-options">
                <div class="hardware-option selected" data-value="standard" data-price="0" onclick="selectHardware(this, 'rail')">
                  <div class="name">Standard</div>
                  <div class="price">Included</div>
                </div>
                <div class="hardware-option" data-value="fabric" data-price="2.20" data-unit="sqm" onclick="selectHardware(this, 'rail')">
                  <div class="name">Fabric Wrapped</div>
                  <div class="price">+$2.20/m²</div>
                </div>
              </div>
            </div>

            <div class="hardware-section">
              <span class="hardware-label">Roller Type</span>
              <div class="hardware-options" id="roller-options">
                <div class="hardware-option selected" data-value="standard" data-price="0" onclick="selectHardware(this, 'roller')">
                  <div class="name">Standard Roll</div>
                  <div class="price">Included</div>
                </div>
                <div class="hardware-option" data-value="reverse" data-price="0" onclick="selectHardware(this, 'roller')">
                  <div class="name">Reverse Roll</div>
                  <div class="price">Free</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 6: Accessories -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">6</span> Accessories</h3>
          </div>
          <div class="card-body">
            <div class="accessory-option" data-value="smart-hub" data-price="23.50" onclick="toggleAccessory(this)">
              <div class="accessory-checkbox"><i class="fas fa-check" style="display: none;"></i></div>
              <div class="accessory-info">
                <div class="accessory-name">Smart Hub</div>
                <div class="accessory-desc">WiFi bridge for app control</div>
              </div>
              <div class="accessory-price">+$23.50</div>
            </div>
            <div class="accessory-option" data-value="usb-charger" data-price="5" onclick="toggleAccessory(this)">
              <div class="accessory-checkbox"><i class="fas fa-check" style="display: none;"></i></div>
              <div class="accessory-info">
                <div class="accessory-name">USB Charger</div>
                <div class="accessory-desc">For rechargeable motors</div>
              </div>
              <div class="accessory-price">+$5.00</div>
            </div>
            <div class="accessory-option" data-value="remote-15" data-price="15" onclick="toggleAccessory(this)">
              <div class="accessory-checkbox"><i class="fas fa-check" style="display: none;"></i></div>
              <div class="accessory-info">
                <div class="accessory-name">15-Channel Remote</div>
                <div class="accessory-desc">Control multiple blinds</div>
              </div>
              <div class="accessory-price">+$15.00</div>
            </div>
          </div>
        </div>

        <!-- Step 7: Notes -->
        <div class="form-card">
          <div class="card-header">
            <h3 class="card-title"><span class="step">7</span> Order Notes</h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Special Instructions (optional)</label>
              <textarea class="form-input" id="order-notes" rows="3" placeholder="Any special instructions for manufacturing or shipping..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Summary Sidebar -->
      <div class="order-sidebar">
        <div class="summary-card">
          <div class="summary-header">
            <h3 class="summary-title">Order Summary</h3>
          </div>
          <div class="summary-body">
            <div class="summary-product" id="summary-product">
              <img src="/images/placeholder.jpg" alt="Product" id="summary-img">
              <div class="summary-product-info">
                <div class="summary-product-name" id="summary-name">Select a product</div>
                <div class="summary-product-details" id="summary-details">--</div>
              </div>
            </div>

            <div class="summary-row">
              <span class="label">Base Price</span>
              <span class="value" id="summary-base">$0.00</span>
            </div>
            <div class="summary-row">
              <span class="label">Fabric</span>
              <span class="value" id="summary-fabric">$0.00</span>
            </div>
            <div class="summary-row">
              <span class="label">Hardware</span>
              <span class="value" id="summary-hardware">$0.00</span>
            </div>
            <div class="summary-row">
              <span class="label">Accessories</span>
              <span class="value" id="summary-accessories">$0.00</span>
            </div>
            <div class="summary-row">
              <span class="label">Retail Subtotal</span>
              <span class="value" id="summary-subtotal">$0.00</span>
            </div>
            <div class="summary-row discount">
              <span class="label">Dealer Discount (<span id="discount-percent">15</span>%)</span>
              <span class="value" id="summary-discount">-$0.00</span>
            </div>
            <div class="summary-row total">
              <span class="label">Your Price</span>
              <span class="value" id="summary-total">$0.00</span>
            </div>

            <div class="quantity-control">
              <span class="quantity-label">Quantity:</span>
              <div class="quantity-buttons">
                <button type="button" class="qty-btn" onclick="changeQty(-1)">-</button>
                <span class="qty-value" id="qty-value">1</span>
                <button type="button" class="qty-btn" onclick="changeQty(1)">+</button>
              </div>
            </div>

            <div class="btn-group">
              <button type="button" class="btn btn-primary" id="btn-add-cart" onclick="addToCart()">
                Add to Cart
              </button>
              <button type="button" class="btn btn-secondary" onclick="saveQuote()">
                Save as Quote
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Check authentication
    const token = localStorage.getItem('dealerToken');
    const user = JSON.parse(localStorage.getItem('dealerUser') || '{}');

    if (!token) {
      window.location.href = '/dealer/login.html';
    }

    // Configuration
    let discountPercent = 15;
    const discounts = { bronze: 15, silver: 20, gold: 25 };
    if (user.tier) {
      discountPercent = discounts[user.tier.toLowerCase()] || 15;
      document.getElementById('tier-badge').textContent = user.tier.charAt(0).toUpperCase() + user.tier.slice(1);
      document.getElementById('tier-badge').classList.add(user.tier.toLowerCase());
      document.getElementById('tier-text').textContent = user.tier.charAt(0).toUpperCase() + user.tier.slice(1);
      document.getElementById('discount-badge').textContent = discountPercent + '% OFF';
      document.getElementById('discount-percent').textContent = discountPercent;
    }

    // State
    let products = [];
    let customers = [];
    let selectedProduct = null;
    let selectedFabric = null;
    let quantity = 1;
    let selections = {
      mount: 'inside',
      control: 'chain',
      motor: 'aok',
      valance: 'none',
      rail: 'standard',
      roller: 'standard'
    };
    let accessories = [];

    // Load products
    async function loadProducts() {
      try {
        const response = await fetch('/api/products');
        const result = await response.json();
        products = result.data || result;

        const grid = document.getElementById('product-grid');
        grid.innerHTML = products.slice(0, 12).map(p => `
          <div class="product-card" data-id="${p.id}" onclick="selectProduct('${p.id}')">
            <img src="${p.images?.[0] || '/images/placeholder.jpg'}" alt="${p.name}" onerror="this.src='/images/placeholder.jpg'">
            <div class="name">${p.name}</div>
            <div class="price">From $${(p.basePrice || 40).toFixed(2)}</div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading products:', error);
      }
    }

    // Load customers
    async function loadCustomers() {
      try {
        const response = await fetch('/api/dealer/customers', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        customers = result.data || [];

        const select = document.getElementById('customer-select');
        select.innerHTML = '<option value="">-- New Customer --</option>' +
          customers.map(c => `<option value="${c.id}">${c.name} (${c.email || 'No email'})</option>`).join('');
      } catch (error) {
        console.error('Error loading customers:', error);
      }
    }

    // Select product
    async function selectProduct(productId) {
      selectedProduct = products.find(p => p.id === productId);

      // Update UI
      document.querySelectorAll('.product-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.id === productId);
      });

      // Update summary
      document.getElementById('summary-name').textContent = selectedProduct.name;
      document.getElementById('summary-img').src = selectedProduct.images?.[0] || '/images/placeholder.jpg';

      // Load fabrics
      await loadFabrics(selectedProduct.slug || selectedProduct.id);

      calculatePrice();
    }

    // Load fabrics for product
    async function loadFabrics(slug) {
      try {
        const response = await fetch(`/api/fabrics?category=blackout`);
        const result = await response.json();
        const fabrics = result.data || result;

        const grid = document.getElementById('fabric-grid');
        if (fabrics.length > 0) {
          grid.innerHTML = fabrics.slice(0, 30).map(f => `
            <div class="fabric-swatch" data-code="${f.code}" data-price="${f.pricePerSqM || 8}" onclick="selectFabric(this)">
              <img src="${f.image || f.imageUrl || '/images/placeholder.jpg'}" alt="${f.code}" onerror="this.src='/images/placeholder.jpg'">
              <div class="code">${f.code}</div>
            </div>
          `).join('');

          // Select first fabric
          const first = grid.querySelector('.fabric-swatch');
          if (first) selectFabric(first);
        } else {
          grid.innerHTML = '<p style="color: #6b7280; width: 100%; text-align: center; padding: 20px;">No fabrics available</p>';
        }
      } catch (error) {
        console.error('Error loading fabrics:', error);
      }
    }

    // Select fabric
    function selectFabric(el) {
      document.querySelectorAll('.fabric-swatch').forEach(s => s.classList.remove('selected'));
      el.classList.add('selected');
      selectedFabric = {
        code: el.dataset.code,
        price: parseFloat(el.dataset.price) || 8
      };
      calculatePrice();
    }

    // Select filter
    function selectFilter(btn) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      // Reload fabrics for this filter type
      const filterType = btn.dataset.value;
      loadFabricsForFilter(filterType);
    }

    async function loadFabricsForFilter(filterType) {
      try {
        const response = await fetch(`/api/fabrics?category=${filterType}`);
        const result = await response.json();
        const fabrics = result.data || result;

        const grid = document.getElementById('fabric-grid');
        if (fabrics.length > 0) {
          grid.innerHTML = fabrics.slice(0, 30).map(f => `
            <div class="fabric-swatch" data-code="${f.code}" data-price="${f.pricePerSqM || 8}" onclick="selectFabric(this)">
              <img src="${f.image || f.imageUrl || '/images/placeholder.jpg'}" alt="${f.code}" onerror="this.src='/images/placeholder.jpg'">
              <div class="code">${f.code}</div>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading fabrics:', error);
      }
    }

    // Select hardware option
    function selectHardware(el, type) {
      const container = el.parentElement;
      container.querySelectorAll('.hardware-option').forEach(o => o.classList.remove('selected'));
      el.classList.add('selected');
      selections[type] = el.dataset.value;

      // Show/hide motor options
      if (type === 'control') {
        document.getElementById('motor-section').style.display = 
          el.dataset.value === 'motorized' ? 'block' : 'none';
      }

      calculatePrice();
    }

    // Toggle accessory
    function toggleAccessory(el) {
      el.classList.toggle('selected');
      const icon = el.querySelector('.fa-check');
      icon.style.display = el.classList.contains('selected') ? 'block' : 'none';

      const value = el.dataset.value;
      if (el.classList.contains('selected')) {
        accessories.push({ value, price: parseFloat(el.dataset.price) });
      } else {
        accessories = accessories.filter(a => a.value !== value);
      }

      calculatePrice();
    }

    // Select customer
    function selectCustomer(customerId) {
      const customer = customers.find(c => c.id === customerId);
      if (customer) {
        document.getElementById('customer-name').value = customer.name || '';
        document.getElementById('customer-email').value = customer.email || '';
        document.getElementById('customer-phone').value = customer.phone || '';
        document.getElementById('customer-address').value = customer.address || '';
      } else {
        document.getElementById('customer-name').value = '';
        document.getElementById('customer-email').value = '';
        document.getElementById('customer-phone').value = '';
        document.getElementById('customer-address').value = '';
      }
    }

    // Change quantity
    function changeQty(delta) {
      quantity = Math.max(1, quantity + delta);
      document.getElementById('qty-value').textContent = quantity;
      calculatePrice();
    }

    // Calculate price
    function calculatePrice() {
      const width = parseFloat(document.getElementById('width-input').value) || 24;
      const height = parseFloat(document.getElementById('height-input').value) || 36;

      // Area in sq ft and sq m
      const sqFt = (width * height) / 144;
      const sqM = sqFt * 0.0929;

      document.getElementById('area-display').textContent = sqFt.toFixed(2);
      document.getElementById('summary-details').textContent = `${width}" x ${height}" | Qty: ${quantity}`;

      // Base price
      const basePrice = selectedProduct?.basePrice || 40;

      // Fabric price (per sq m)
      const fabricPricePerSqM = selectedFabric?.price || 8;
      const fabricPrice = fabricPricePerSqM * sqM;

      // Hardware prices
      let hardwarePrice = 0;

      // Motor
      if (selections.control === 'motorized') {
        const motorPrices = { aok: 55, dooya: 47 };
        hardwarePrice += motorPrices[selections.motor] || 55;
      }

      // Valance (per sqm pricing)
      if (selections.valance === 'fabric') {
        hardwarePrice += 2.20 * sqM;
      }

      // Bottom rail (per sqm pricing)
      if (selections.rail === 'fabric') {
        hardwarePrice += 2.20 * sqM;
      }

      // Accessories
      const accessoriesPrice = accessories.reduce((sum, a) => sum + a.price, 0);

      // Calculate totals
      const subtotal = (basePrice + fabricPrice + hardwarePrice + accessoriesPrice) * quantity;
      const discount = subtotal * (discountPercent / 100);
      const total = subtotal - discount;

      // Update summary
      document.getElementById('summary-base').textContent = formatCurrency(basePrice * quantity);
      document.getElementById('summary-fabric').textContent = formatCurrency(fabricPrice * quantity);
      document.getElementById('summary-hardware').textContent = formatCurrency(hardwarePrice * quantity);
      document.getElementById('summary-accessories').textContent = formatCurrency(accessoriesPrice * quantity);
      document.getElementById('summary-subtotal').textContent = formatCurrency(subtotal);
      document.getElementById('summary-discount').textContent = '-' + formatCurrency(discount);
      document.getElementById('summary-total').textContent = formatCurrency(total);
    }

    // Add to cart
    async function addToCart() {
      if (!selectedProduct) {
        alert('Please select a product');
        return;
      }

      const customerName = document.getElementById('customer-name').value;
      if (!customerName) {
        alert('Please enter customer name');
        return;
      }

      const width = parseFloat(document.getElementById('width-input').value);
      const height = parseFloat(document.getElementById('height-input').value);

      const orderData = {
        productId: selectedProduct.id,
        productName: selectedProduct.name,
        width,
        height,
        fabric: selectedFabric?.code,
        options: selections,
        accessories: accessories.map(a => a.value),
        quantity,
        customer: {
          name: customerName,
          email: document.getElementById('customer-email').value,
          phone: document.getElementById('customer-phone').value,
          address: document.getElementById('customer-address').value
        },
        notes: document.getElementById('order-notes').value
      };

      try {
        const response = await fetch('/api/dealer/orders', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(orderData)
        });

        const result = await response.json();

        if (result.success) {
          alert('Order created successfully!');
          window.location.href = '/dealer/orders.html';
        } else {
          alert(result.error || 'Failed to create order');
        }
      } catch (error) {
        console.error('Error creating order:', error);
        alert('Unable to create order. Please try again.');
      }
    }

    // Save as quote
    function saveQuote() {
      alert('Quote functionality coming soon!');
    }

    // Helper
    function formatCurrency(amount) {
      return '$' + (amount || 0).toFixed(2);
    }

    function logout() {
      localStorage.removeItem('dealerToken');
      localStorage.removeItem('dealerUser');
      window.location.href = '/dealer/login.html';
    }

    // Initialize
    loadProducts();
    loadCustomers();
    calculatePrice();
  </script>
</body>
</html>
