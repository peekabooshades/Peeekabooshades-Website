<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two-Factor Authentication - Security | Peekaboo Shades Admin</title>
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .security-container { display: flex; min-height: 100vh; }
        .security-sidebar { width: 260px; background: #1a1a2e; padding: 20px 0; flex-shrink: 0; }
        .security-sidebar h3 { color: #fff; padding: 0 20px; margin-bottom: 20px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .security-sidebar h3 i { color: #28a745; }
        .security-nav { list-style: none; padding: 0; margin: 0; }
        .security-nav li a { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: #a0a0a0; text-decoration: none; transition: all 0.2s; font-size: 14px; }
        .security-nav li a:hover, .security-nav li a.active { background: rgba(255,255,255,0.1); color: #fff; }
        .security-nav li a.active { border-left: 3px solid #28a745; }
        .security-content { flex: 1; padding: 30px; background: #f5f5f5; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-header h1 { margin: 0; font-size: 24px; }

        .tfa-hero {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .tfa-hero-icon {
            width: 120px;
            height: 120px;
            background: rgba(255,255,255,0.2);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .tfa-hero-content h2 { margin: 0 0 10px; font-size: 28px; }
        .tfa-hero-content p { margin: 0 0 20px; opacity: 0.9; font-size: 16px; line-height: 1.6; }

        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-size: 14px; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; }
        .btn-white { background: #fff; color: #667eea; }
        .btn-primary { background: #4a90d9; color: #fff; }
        .btn-success { background: #28a745; color: #fff; }
        .btn-danger { background: #dc3545; color: #fff; }
        .btn-secondary { background: #f0f0f0; color: #333; }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }

        .stat-card .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 22px;
        }

        .stat-card .stat-icon.enabled { background: #d4edda; color: #28a745; }
        .stat-card .stat-icon.disabled { background: #f8d7da; color: #dc3545; }
        .stat-card .stat-icon.pending { background: #fff3cd; color: #856404; }

        .stat-value { font-size: 36px; font-weight: 700; margin-bottom: 5px; }
        .stat-label { font-size: 14px; color: #888; }

        .settings-card {
            background: #fff;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .settings-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-header h3 { margin: 0; font-size: 16px; }

        .settings-body { padding: 20px; }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-item:last-child { border-bottom: none; }

        .setting-info h4 { margin: 0 0 5px; font-size: 14px; }
        .setting-info p { margin: 0; font-size: 13px; color: #888; }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input { opacity: 0; width: 0; height: 0; }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider { background-color: #28a745; }
        input:checked + .toggle-slider:before { transform: translateX(24px); }

        .users-table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th, .users-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .users-table th {
            background: #f9f9f9;
            font-weight: 600;
            font-size: 13px;
            color: #666;
        }

        .user-info { display: flex; align-items: center; gap: 12px; }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4a90d9;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-name { font-weight: 500; }
        .user-email { font-size: 13px; color: #888; }

        .tfa-status { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .tfa-status.enabled { color: #28a745; }
        .tfa-status.disabled { color: #dc3545; }

        .method-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            background: #e8f0fc;
            color: #4a90d9;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Setup Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active { display: flex; }

        .modal-content {
            background: #fff;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            overflow: hidden;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .modal-header h2 { margin: 0 0 5px; font-size: 20px; }
        .modal-header p { margin: 0; color: #888; }

        .modal-body { padding: 25px; }
        .modal-footer { padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: space-between; }

        .setup-step {
            text-align: center;
            margin-bottom: 25px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4a90d9;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 auto 15px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 12px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #888;
        }

        .secret-key {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            text-align: center;
            letter-spacing: 2px;
            margin: 15px 0;
        }

        .verify-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .verify-input input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        .verify-input input:focus {
            border-color: #4a90d9;
            outline: none;
        }

        .backup-codes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .backup-code {
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
            font-family: monospace;
            text-align: center;
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .method-option {
            padding: 20px;
            border: 2px solid #eee;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .method-option:hover { border-color: #4a90d9; }
        .method-option.selected { border-color: #4a90d9; background: #f0f7ff; }

        .method-option i { font-size: 32px; color: #4a90d9; margin-bottom: 10px; }
        .method-option h4 { margin: 0 0 5px; font-size: 14px; }
        .method-option p { margin: 0; font-size: 12px; color: #888; }
    </style>
</head>
<body>
    <div class="security-container">
        <aside class="security-sidebar">
            <h3><i class="fas fa-shield-alt"></i> Security Center</h3>
            <ul class="security-nav">
                <li><a href="index.html"><i class="fas fa-tachometer-alt"></i> Overview</a></li>
                <li><a href="users.html"><i class="fas fa-users-cog"></i> User Management</a></li>
                <li><a href="two-factor.html" class="active"><i class="fas fa-mobile-alt"></i> Two-Factor Auth</a></li>
                <li><a href="firewall.html"><i class="fas fa-fire"></i> IP Firewall</a></li>
                <li><a href="sso.html"><i class="fas fa-key"></i> SSO & Auth Providers</a></li>
                <li><a href="sessions.html"><i class="fas fa-desktop"></i> Active Sessions</a></li>
                <li><a href="api-security.html"><i class="fas fa-code"></i> API Security</a></li>
                <li><a href="audit-logs.html"><i class="fas fa-history"></i> Audit Logs</a></li>
                <li><a href="permissions.html"><i class="fas fa-lock"></i> Page Permissions</a></li>
            </ul>
            <div style="padding: 20px; margin-top: 30px;">
                <a href="../index.html" style="color: #a0a0a0; text-decoration: none; font-size: 13px;">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </aside>

        <main class="security-content">
            <div class="page-header">
                <h1><i class="fas fa-mobile-alt" style="color: #667eea;"></i> Two-Factor Authentication</h1>
            </div>

            <div class="tfa-hero">
                <div class="tfa-hero-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="tfa-hero-content">
                    <h2>Protect Your Admin Accounts</h2>
                    <p>Two-factor authentication adds an extra layer of security by requiring a second form of verification when signing in. Even if someone gets your password, they won't be able to access your account.</p>
                    <button class="btn btn-white" onclick="openSetupModal()">
                        <i class="fas fa-plus"></i> Set Up 2FA for Your Account
                    </button>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon enabled">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-value">2</div>
                    <div class="stat-label">Users with 2FA Enabled</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon disabled">
                        <i class="fas fa-times"></i>
                    </div>
                    <div class="stat-value">3</div>
                    <div class="stat-label">Users without 2FA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-value">40%</div>
                    <div class="stat-label">Adoption Rate</div>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-header">
                    <h3>2FA Policy Settings</h3>
                </div>
                <div class="settings-body">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Require 2FA for All Admins</h4>
                            <p>Force all admin users to set up two-factor authentication</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="require2FA">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Require 2FA for Sensitive Actions</h4>
                            <p>Request verification for settings changes, user management, etc.</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="require2FASensitive" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Allow Backup Codes</h4>
                            <p>Generate backup codes for account recovery</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="allowBackupCodes" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Remember Device for 30 Days</h4>
                            <p>Skip 2FA on trusted devices</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="rememberDevice" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="settings-card">
                <div class="settings-header">
                    <h3>User 2FA Status</h3>
                    <button class="btn btn-primary btn-small" onclick="enforceAllUsers()">
                        <i class="fas fa-shield-alt"></i> Enforce for All
                    </button>
                </div>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Status</th>
                            <th>Method</th>
                            <th>Last Verified</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Setup Modal -->
    <div class="modal-overlay" id="setupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Up Two-Factor Authentication</h2>
                <p>Choose your preferred verification method</p>
            </div>
            <div class="modal-body" id="setupStep1">
                <div class="methods-grid">
                    <div class="method-option selected" data-method="authenticator" onclick="selectMethod('authenticator')">
                        <i class="fas fa-mobile-alt"></i>
                        <h4>Authenticator App</h4>
                        <p>Google Authenticator, Authy, etc.</p>
                    </div>
                    <div class="method-option" data-method="sms" onclick="selectMethod('sms')">
                        <i class="fas fa-sms"></i>
                        <h4>SMS Code</h4>
                        <p>Receive codes via text message</p>
                    </div>
                    <div class="method-option" data-method="email" onclick="selectMethod('email')">
                        <i class="fas fa-envelope"></i>
                        <h4>Email Code</h4>
                        <p>Receive codes via email</p>
                    </div>
                    <div class="method-option" data-method="hardware" onclick="selectMethod('hardware')">
                        <i class="fas fa-key"></i>
                        <h4>Security Key</h4>
                        <p>YubiKey, Titan, etc.</p>
                    </div>
                </div>
            </div>
            <div class="modal-body" id="setupStep2" style="display: none;">
                <div class="setup-step">
                    <div class="step-number">1</div>
                    <h4>Scan QR Code</h4>
                    <p>Open your authenticator app and scan this code</p>
                </div>
                <div class="qr-code">
                    <span>[QR Code Image]</span>
                </div>
                <p style="text-align: center; color: #888; font-size: 13px;">Can't scan? Enter this code manually:</p>
                <div class="secret-key">JBSWY3DPEHPK3PXP</div>
            </div>
            <div class="modal-body" id="setupStep3" style="display: none;">
                <div class="setup-step">
                    <div class="step-number">2</div>
                    <h4>Verify Setup</h4>
                    <p>Enter the 6-digit code from your authenticator app</p>
                </div>
                <div class="verify-input">
                    <input type="text" maxlength="1" id="code1" oninput="moveToNext(1)">
                    <input type="text" maxlength="1" id="code2" oninput="moveToNext(2)">
                    <input type="text" maxlength="1" id="code3" oninput="moveToNext(3)">
                    <input type="text" maxlength="1" id="code4" oninput="moveToNext(4)">
                    <input type="text" maxlength="1" id="code5" oninput="moveToNext(5)">
                    <input type="text" maxlength="1" id="code6">
                </div>
            </div>
            <div class="modal-body" id="setupStep4" style="display: none;">
                <div class="setup-step">
                    <div class="step-number"><i class="fas fa-check"></i></div>
                    <h4>Save Your Backup Codes</h4>
                    <p>Store these codes safely. Each code can only be used once.</p>
                </div>
                <div class="backup-codes">
                    <div class="backup-code">A1B2-C3D4</div>
                    <div class="backup-code">E5F6-G7H8</div>
                    <div class="backup-code">I9J0-K1L2</div>
                    <div class="backup-code">M3N4-O5P6</div>
                    <div class="backup-code">Q7R8-S9T0</div>
                    <div class="backup-code">U1V2-W3X4</div>
                    <div class="backup-code">Y5Z6-A7B8</div>
                    <div class="backup-code">C9D0-E1F2</div>
                </div>
                <button class="btn btn-secondary" style="width: 100%;" onclick="downloadBackupCodes()">
                    <i class="fas fa-download"></i> Download Backup Codes
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSetupModal()">Cancel</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Continue</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let selectedMethod = 'authenticator';

        const users = [
            { id: '1', name: 'Admin User', email: 'admin@peekabooshades.com', enabled: true, method: 'Authenticator', lastVerified: '2024-06-19T10:30:00' },
            { id: '2', name: 'John Smith', email: 'john@peekabooshades.com', enabled: true, method: 'SMS', lastVerified: '2024-06-18T14:22:00' },
            { id: '3', name: 'Sarah Johnson', email: 'sarah@peekabooshades.com', enabled: false, method: null, lastVerified: null },
            { id: '4', name: 'Mike Williams', email: 'mike@peekabooshades.com', enabled: false, method: null, lastVerified: null },
            { id: '5', name: 'Emily Brown', email: 'emily@peekabooshades.com', enabled: false, method: null, lastVerified: null }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            renderUsers();
        });

        function renderUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">${user.name.split(' ').map(n => n[0]).join('')}</div>
                            <div>
                                <div class="user-name">${user.name}</div>
                                <div class="user-email">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="tfa-status ${user.enabled ? 'enabled' : 'disabled'}">
                            <i class="fas fa-${user.enabled ? 'check-circle' : 'times-circle'}"></i>
                            ${user.enabled ? 'Enabled' : 'Disabled'}
                        </span>
                    </td>
                    <td>
                        ${user.method ? `<span class="method-badge">${user.method}</span>` : '-'}
                    </td>
                    <td>${user.lastVerified ? formatDate(user.lastVerified) : 'Never'}</td>
                    <td>
                        ${user.enabled ? `
                            <button class="btn btn-secondary btn-small" onclick="reset2FA('${user.id}')">Reset</button>
                        ` : `
                            <button class="btn btn-primary btn-small" onclick="sendSetupEmail('${user.email}')">Send Setup Link</button>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', {
                month: 'short', day: 'numeric',
                hour: 'numeric', minute: '2-digit'
            });
        }

        function selectMethod(method) {
            selectedMethod = method;
            document.querySelectorAll('.method-option').forEach(m => m.classList.remove('selected'));
            document.querySelector(`[data-method="${method}"]`).classList.add('selected');
        }

        function openSetupModal() {
            currentStep = 1;
            updateModalStep();
            document.getElementById('setupModal').classList.add('active');
        }

        function closeSetupModal() {
            document.getElementById('setupModal').classList.remove('active');
        }

        function nextStep() {
            if (currentStep < 4) {
                currentStep++;
                updateModalStep();
            } else {
                // Complete setup
                closeSetupModal();
                alert('Two-factor authentication has been enabled for your account!');
            }
        }

        function updateModalStep() {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`setupStep${i}`).style.display = i === currentStep ? 'block' : 'none';
            }

            const nextBtn = document.getElementById('nextBtn');
            if (currentStep === 4) {
                nextBtn.textContent = 'Complete Setup';
            } else if (currentStep === 3) {
                nextBtn.textContent = 'Verify';
            } else {
                nextBtn.textContent = 'Continue';
            }
        }

        function moveToNext(index) {
            const current = document.getElementById(`code${index}`);
            if (current.value.length === 1 && index < 6) {
                document.getElementById(`code${index + 1}`).focus();
            }
        }

        function downloadBackupCodes() {
            const codes = 'Backup Codes for Peekaboo Shades Admin\n\nA1B2-C3D4\nE5F6-G7H8\nI9J0-K1L2\nM3N4-O5P6\nQ7R8-S9T0\nU1V2-W3X4\nY5Z6-A7B8\nC9D0-E1F2\n\nEach code can only be used once.';
            const blob = new Blob([codes], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'backup-codes.txt';
            a.click();
        }

        function reset2FA(userId) {
            if (confirm('Reset 2FA for this user? They will need to set it up again.')) {
                alert('2FA has been reset for this user');
            }
        }

        function sendSetupEmail(email) {
            alert(`Setup instructions sent to ${email}`);
        }

        function enforceAllUsers() {
            if (confirm('This will require all users to set up 2FA on their next login. Continue?')) {
                document.getElementById('require2FA').checked = true;
                alert('2FA is now required for all admin users');
            }
        }
    </script>
</body>
</html>
