<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics & Reports - Peekaboo Shades Admin</title>
  <link rel="stylesheet" href="css/admin.css">
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .analytics-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    .date-picker-group {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .date-input-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .date-input-group label {
      font-size: 13px;
      color: #6D7175;
    }
    .date-input-group input[type="date"] {
      padding: 8px 12px;
      border: 1px solid #E5E5E5;
      border-radius: 4px;
      font-size: 14px;
    }
    .quick-range-btns {
      display: flex;
      gap: 8px;
    }
    .quick-range-btns button {
      padding: 8px 16px;
      border: 1px solid #E5E5E5;
      background: white;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      color: #6D7175;
      transition: all 0.2s;
    }
    .quick-range-btns button:hover {
      border-color: #8E6545;
    }
    .quick-range-btns button.active {
      background: #8E6545;
      color: white;
      border-color: #8E6545;
    }
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }
    @media (max-width: 1200px) {
      .analytics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 600px) {
      .analytics-grid {
        grid-template-columns: 1fr;
      }
    }
    .analytics-stat {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .analytics-stat-label {
      font-size: 13px;
      color: #6D7175;
      margin-bottom: 8px;
    }
    .analytics-stat-value {
      font-size: 28px;
      font-weight: 600;
      color: #202223;
    }
    .analytics-stat-change {
      font-size: 13px;
      margin-top: 4px;
    }
    .analytics-stat-change.up { color: #008060; }
    .analytics-stat-change.down { color: #D72C0D; }
    .chart-row {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    .chart-row-equal {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    @media (max-width: 1024px) {
      .chart-row, .chart-row-equal {
        grid-template-columns: 1fr;
      }
    }
    .analytics-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .analytics-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .analytics-card-title {
      font-size: 16px;
      font-weight: 600;
      color: #202223;
    }
    .chart-container {
      height: 300px;
      position: relative;
    }
    .chart-container.small {
      height: 200px;
    }
    .funnel-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 20px 0;
    }
    .funnel-step {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .funnel-bar-container {
      flex: 1;
      position: relative;
    }
    .funnel-bar {
      height: 40px;
      background: linear-gradient(90deg, #8E6545 0%, #B38B6D 100%);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
      color: white;
      font-weight: 600;
      min-width: 60px;
    }
    .funnel-label {
      width: 120px;
      font-size: 14px;
      color: #202223;
      font-weight: 500;
    }
    .funnel-count {
      width: 80px;
      text-align: right;
      font-size: 14px;
      color: #6D7175;
    }
    .funnel-arrow {
      text-align: center;
      color: #8C9196;
      font-size: 12px;
      padding-left: 120px;
    }
    .data-table {
      width: 100%;
    }
    .data-table th {
      text-align: left;
      padding: 12px 8px;
      font-size: 12px;
      font-weight: 600;
      color: #6D7175;
      text-transform: uppercase;
      border-bottom: 1px solid #E5E5E5;
    }
    .data-table td {
      padding: 12px 8px;
      font-size: 14px;
      color: #202223;
      border-bottom: 1px solid #F0F0F0;
    }
    .data-table tr:last-child td {
      border-bottom: none;
    }
    .data-table .rank {
      width: 40px;
      color: #6D7175;
    }
    .data-table .value {
      text-align: right;
      font-weight: 600;
    }
    .export-btns {
      display: flex;
      gap: 8px;
    }
    .tabs {
      display: flex;
      gap: 4px;
      border-bottom: 1px solid #E5E5E5;
      margin-bottom: 20px;
    }
    .tab-btn {
      padding: 12px 20px;
      border: none;
      background: none;
      font-size: 14px;
      color: #6D7175;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: all 0.2s;
    }
    .tab-btn:hover {
      color: #202223;
    }
    .tab-btn.active {
      color: #8E6545;
      border-bottom-color: #8E6545;
      font-weight: 500;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .empty-data {
      text-align: center;
      padding: 60px 20px;
      color: #6D7175;
    }
    .empty-data svg {
      width: 48px;
      height: 48px;
      color: #8C9196;
      margin-bottom: 12px;
    }
    .comparison-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
    }
    .comparison-badge.up {
      background: #E3F1DF;
      color: #008060;
    }
    .comparison-badge.down {
      background: #FEE9E9;
      color: #D72C0D;
    }
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }
    .loading-spinner::after {
      content: "";
      width: 32px;
      height: 32px;
      border: 3px solid #E5E5E5;
      border-top-color: #8E6545;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <a href="/admin/" class="sidebar-logo">
          <img src="/images/logo.png" alt="Logo" onerror="this.style.display='none'">
          <span>Peekaboo Shades</span>
        </a>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <a href="/admin/" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>Dashboard</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Sales</div>
          <a href="/admin/orders.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
            <span>Orders</span>
          </a>
          <a href="/admin/draft-orders.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            <span>Draft Orders</span>
          </a>
          <a href="/admin/abandoned-checkouts.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>Abandoned Carts</span>
          </a>
          <a href="/admin/quotes.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span>Quotes</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Catalog</div>
          <a href="/admin/products.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
            <span>Products</span>
          </a>
          <a href="/admin/categories.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
            </svg>
            <span>Categories</span>
          </a>
          <a href="/admin/fabrics.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span>Fabrics</span>
          </a>
          <a href="/admin/hardware-options.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Hardware Options</span>
          </a>
          <a href="/admin/accessories.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z" />
            </svg>
            <span>Accessories</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Customers</div>
          <a href="/admin/customers.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>All Customers</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Content</div>
          <a href="/admin/product-content.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span>Product Content</span>
          </a>
          <a href="/admin/product-page-editor.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            <span>Page Editor</span>
          </a>
          <a href="/admin/pages.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
            </svg>
            <span>Pages</span>
          </a>
          <a href="/admin/blog/posts.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
            </svg>
            <span>Blog Posts</span>
          </a>
          <a href="/admin/files.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span>Files</span>
          </a>
          <a href="/admin/faqs.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>FAQs</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Analytics</div>
          <a href="/admin/analytics.html" class="nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <span>Reports</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <a href="/admin/settings.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Settings</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
      <!-- Header -->
      <header class="admin-header">
        <div class="header-left">
          <button class="header-btn mobile-menu-btn" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <div class="breadcrumb">
            <a href="/admin/" class="breadcrumb-link">Dashboard</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Analytics & Reports</span>
          </div>
        </div>
        <div class="header-right">
          <a href="/" class="header-btn" title="View Store" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
          <div class="dropdown">
            <div class="header-profile">
              <div class="profile-avatar">A</div>
              <span class="profile-name">Admin</span>
            </div>
            <div class="dropdown-menu profile-dropdown">
              <a href="/admin/settings.html" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Profile
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item danger" onclick="Admin.AuthAPI.logout(); return false;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                Logout
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="admin-content">
        <div class="analytics-header">
          <h1 class="page-title">Analytics & Reports</h1>
          <div class="date-picker-group">
            <div class="quick-range-btns">
              <button data-range="7d">7 Days</button>
              <button data-range="30d" class="active">30 Days</button>
              <button data-range="90d">90 Days</button>
              <button data-range="365d">Year</button>
            </div>
            <div class="date-input-group">
              <label>From</label>
              <input type="date" id="startDate">
            </div>
            <div class="date-input-group">
              <label>To</label>
              <input type="date" id="endDate">
            </div>
            <button class="btn btn-primary" onclick="applyDateRange()">Apply</button>
          </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="overview">Overview</button>
          <button class="tab-btn" data-tab="sales">Sales</button>
          <button class="tab-btn" data-tab="products">Products</button>
          <button class="tab-btn" data-tab="traffic">Traffic</button>
        </div>

        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-content active">
          <!-- Summary Stats -->
          <div class="analytics-grid" id="summary-stats">
            <div class="analytics-stat">
              <div class="analytics-stat-label">Total Revenue</div>
              <div class="analytics-stat-value" id="total-revenue">$0.00</div>
              <div class="analytics-stat-change" id="revenue-change"></div>
            </div>
            <div class="analytics-stat">
              <div class="analytics-stat-label">Total Orders</div>
              <div class="analytics-stat-value" id="total-orders">0</div>
              <div class="analytics-stat-change" id="orders-change"></div>
            </div>
            <div class="analytics-stat">
              <div class="analytics-stat-label">Average Order Value</div>
              <div class="analytics-stat-value" id="avg-order">$0.00</div>
              <div class="analytics-stat-change" id="aov-change"></div>
            </div>
            <div class="analytics-stat">
              <div class="analytics-stat-label">Conversion Rate</div>
              <div class="analytics-stat-value" id="conversion-rate">0%</div>
              <div class="analytics-stat-change" id="conv-change"></div>
            </div>
          </div>

          <!-- Sales Chart and Funnel -->
          <div class="chart-row">
            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Sales Over Time</h3>
                <div class="export-btns">
                  <button class="btn btn-secondary btn-sm" onclick="exportToCSV('sales')">Export CSV</button>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="salesTrendChart"></canvas>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Conversion Funnel</h3>
              </div>
              <div class="funnel-container" id="funnel-chart">
                <div class="loading-spinner"></div>
              </div>
            </div>
          </div>

          <!-- Top Products and Fabrics -->
          <div class="chart-row-equal">
            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Top 10 Products</h3>
                <button class="btn btn-secondary btn-sm" onclick="exportToCSV('products')">Export</button>
              </div>
              <table class="data-table" id="top-products-table">
                <thead>
                  <tr>
                    <th class="rank">#</th>
                    <th>Product</th>
                    <th class="value">Views</th>
                    <th class="value">Orders</th>
                    <th class="value">Revenue</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="5"><div class="loading-spinner"></div></td></tr>
                </tbody>
              </table>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Top 10 Fabrics</h3>
                <button class="btn btn-secondary btn-sm" onclick="exportToCSV('fabrics')">Export</button>
              </div>
              <table class="data-table" id="top-fabrics-table">
                <thead>
                  <tr>
                    <th class="rank">#</th>
                    <th>Fabric</th>
                    <th class="value">Orders</th>
                    <th class="value">Revenue</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="4"><div class="loading-spinner"></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Sales Tab -->
        <div id="tab-sales" class="tab-content">
          <div class="chart-row-equal">
            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Daily Sales</h3>
              </div>
              <div class="chart-container">
                <canvas id="dailySalesChart"></canvas>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Sales by Category</h3>
              </div>
              <div class="chart-container">
                <canvas id="categoryChart"></canvas>
              </div>
            </div>
          </div>

          <div class="analytics-card">
            <div class="analytics-card-header">
              <h3 class="analytics-card-title">Sales Breakdown</h3>
              <button class="btn btn-secondary btn-sm" onclick="exportToCSV('sales-breakdown')">Export CSV</button>
            </div>
            <table class="data-table" id="sales-breakdown-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th class="value">Orders</th>
                  <th class="value">Gross Sales</th>
                  <th class="value">Discounts</th>
                  <th class="value">Net Sales</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="5"><div class="loading-spinner"></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Products Tab -->
        <div id="tab-products" class="tab-content">
          <div class="analytics-card">
            <div class="analytics-card-header">
              <h3 class="analytics-card-title">Product Performance</h3>
              <button class="btn btn-secondary btn-sm" onclick="exportToCSV('all-products')">Export All</button>
            </div>
            <table class="data-table" id="all-products-table">
              <thead>
                <tr>
                  <th class="rank">#</th>
                  <th>Product</th>
                  <th class="value">Page Views</th>
                  <th class="value">Add to Cart</th>
                  <th class="value">Orders</th>
                  <th class="value">Revenue</th>
                  <th class="value">Conv. Rate</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="7"><div class="loading-spinner"></div></td></tr>
              </tbody>
            </table>
          </div>

          <div class="chart-row-equal">
            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Revenue by Product</h3>
              </div>
              <div class="chart-container">
                <canvas id="productRevenueChart"></canvas>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Orders by Fabric Type</h3>
              </div>
              <div class="chart-container">
                <canvas id="fabricTypeChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Traffic Tab -->
        <div id="tab-traffic" class="tab-content">
          <div class="analytics-grid">
            <div class="analytics-stat">
              <div class="analytics-stat-label">Total Page Views</div>
              <div class="analytics-stat-value" id="total-views">0</div>
            </div>
            <div class="analytics-stat">
              <div class="analytics-stat-label">Unique Visitors</div>
              <div class="analytics-stat-value" id="unique-visitors">0</div>
            </div>
            <div class="analytics-stat">
              <div class="analytics-stat-label">Pages/Session</div>
              <div class="analytics-stat-value" id="pages-session">0</div>
            </div>
            <div class="analytics-stat">
              <div class="analytics-stat-label">Bounce Rate</div>
              <div class="analytics-stat-value" id="bounce-rate">0%</div>
            </div>
          </div>

          <div class="chart-row-equal">
            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Traffic Over Time</h3>
              </div>
              <div class="chart-container">
                <canvas id="trafficTrendChart"></canvas>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3 class="analytics-card-title">Traffic Sources</h3>
              </div>
              <div class="chart-container">
                <canvas id="trafficSourceChart"></canvas>
              </div>
            </div>
          </div>

          <div class="analytics-card">
            <div class="analytics-card-header">
              <h3 class="analytics-card-title">Top Landing Pages</h3>
            </div>
            <table class="data-table" id="landing-pages-table">
              <thead>
                <tr>
                  <th class="rank">#</th>
                  <th>Page</th>
                  <th class="value">Views</th>
                  <th class="value">Unique</th>
                  <th class="value">Bounce Rate</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="5"><div class="loading-spinner"></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="js/admin.js"></script>
  <script>
    // Charts
    let salesTrendChart = null;
    let dailySalesChart = null;
    let categoryChart = null;
    let productRevenueChart = null;
    let fabricTypeChart = null;
    let trafficTrendChart = null;
    let trafficSourceChart = null;

    // Date range
    let currentStartDate = new Date();
    let currentEndDate = new Date();
    currentStartDate.setDate(currentStartDate.getDate() - 30);

    // Analytics data cache
    let analyticsData = {};

    // Require authentication
    if (!Admin.Auth.requireAuth()) {
      // Will redirect to login
    } else {
      initDatePickers();
      loadAnalytics();
    }

    // Initialize date pickers
    function initDatePickers() {
      const startInput = document.getElementById('startDate');
      const endInput = document.getElementById('endDate');

      startInput.value = currentStartDate.toISOString().split('T')[0];
      endInput.value = currentEndDate.toISOString().split('T')[0];
    }

    // Quick range buttons
    document.querySelectorAll('.quick-range-btns button').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.quick-range-btns button').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        const range = this.dataset.range;
        currentEndDate = new Date();
        currentStartDate = new Date();

        if (range === '7d') currentStartDate.setDate(currentStartDate.getDate() - 7);
        else if (range === '30d') currentStartDate.setDate(currentStartDate.getDate() - 30);
        else if (range === '90d') currentStartDate.setDate(currentStartDate.getDate() - 90);
        else if (range === '365d') currentStartDate.setFullYear(currentStartDate.getFullYear() - 1);

        initDatePickers();
        loadAnalytics();
      });
    });

    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        this.classList.add('active');
        document.getElementById('tab-' + this.dataset.tab).classList.add('active');

        // Load tab-specific data if needed
        if (this.dataset.tab === 'sales' && !analyticsData.salesLoaded) {
          loadSalesTab();
        } else if (this.dataset.tab === 'products' && !analyticsData.productsLoaded) {
          loadProductsTab();
        } else if (this.dataset.tab === 'traffic' && !analyticsData.trafficLoaded) {
          loadTrafficTab();
        }
      });
    });

    // Apply custom date range
    function applyDateRange() {
      const startInput = document.getElementById('startDate');
      const endInput = document.getElementById('endDate');

      currentStartDate = new Date(startInput.value);
      currentEndDate = new Date(endInput.value);

      document.querySelectorAll('.quick-range-btns button').forEach(b => b.classList.remove('active'));
      loadAnalytics();
    }

    // Main analytics loader
    async function loadAnalytics() {
      analyticsData = { salesLoaded: false, productsLoaded: false, trafficLoaded: false };

      try {
        // Load dashboard stats
        const dashResponse = await Admin.API.get(
          `/analytics/dashboard?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}`
        );

        if (dashResponse.success) {
          updateSummaryStats(dashResponse);
          renderFunnelChart(dashResponse.stats);
          renderTopProductsTable(dashResponse.topProducts || []);
        }

        // Load sales data
        const salesResponse = await Admin.API.get(
          `/analytics/sales?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}&groupBy=day`
        );

        if (salesResponse.success) {
          renderSalesTrendChart(salesResponse.salesData);
        }

        // Load fabrics data
        const fabricsResponse = await Admin.API.get(
          `/analytics/fabrics?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}`
        );

        if (fabricsResponse.success) {
          renderTopFabricsTable(fabricsResponse.fabrics || []);
        }

      } catch (error) {
        console.error('Failed to load analytics:', error);
        Admin.Toast.error('Failed to load analytics data');
      }
    }

    function updateSummaryStats(data) {
      const stats = data.stats || {};

      document.getElementById('total-revenue').textContent = Admin.Utils.formatCurrency(stats.totalRevenue || 0);
      document.getElementById('total-orders').textContent = stats.totalOrders || 0;

      const avgOrder = stats.totalOrders > 0 ? stats.totalRevenue / stats.totalOrders : 0;
      document.getElementById('avg-order').textContent = Admin.Utils.formatCurrency(avgOrder);
      document.getElementById('conversion-rate').textContent = (stats.conversionRate || 0) + '%';

      // Comparison with previous period (placeholder - would need previous period data)
      document.getElementById('revenue-change').innerHTML = '';
      document.getElementById('orders-change').innerHTML = '';
      document.getElementById('aov-change').innerHTML = '';
      document.getElementById('conv-change').innerHTML = '';
    }

    function renderFunnelChart(stats) {
      const funnel = document.getElementById('funnel-chart');
      const pageViews = stats.pageViews || 0;
      const addToCart = stats.addToCart || Math.floor(pageViews * 0.15);
      const checkouts = stats.checkouts || Math.floor(addToCart * 0.4);
      const purchases = stats.totalOrders || 0;

      const maxValue = Math.max(pageViews, 1);

      funnel.innerHTML = `
        <div class="funnel-step">
          <div class="funnel-label">Page Views</div>
          <div class="funnel-bar-container">
            <div class="funnel-bar" style="width: 100%">${((pageViews / maxValue) * 100).toFixed(0)}%</div>
          </div>
          <div class="funnel-count">${formatNumber(pageViews)}</div>
        </div>
        <div class="funnel-arrow">&#8595; ${pageViews > 0 ? ((addToCart / pageViews) * 100).toFixed(1) : 0}%</div>
        <div class="funnel-step">
          <div class="funnel-label">Add to Cart</div>
          <div class="funnel-bar-container">
            <div class="funnel-bar" style="width: ${(addToCart / maxValue) * 100}%">${((addToCart / maxValue) * 100).toFixed(0)}%</div>
          </div>
          <div class="funnel-count">${formatNumber(addToCart)}</div>
        </div>
        <div class="funnel-arrow">&#8595; ${addToCart > 0 ? ((checkouts / addToCart) * 100).toFixed(1) : 0}%</div>
        <div class="funnel-step">
          <div class="funnel-label">Checkout</div>
          <div class="funnel-bar-container">
            <div class="funnel-bar" style="width: ${(checkouts / maxValue) * 100}%">${((checkouts / maxValue) * 100).toFixed(0)}%</div>
          </div>
          <div class="funnel-count">${formatNumber(checkouts)}</div>
        </div>
        <div class="funnel-arrow">&#8595; ${checkouts > 0 ? ((purchases / checkouts) * 100).toFixed(1) : 0}%</div>
        <div class="funnel-step">
          <div class="funnel-label">Purchase</div>
          <div class="funnel-bar-container">
            <div class="funnel-bar" style="width: ${(purchases / maxValue) * 100}%">${((purchases / maxValue) * 100).toFixed(0)}%</div>
          </div>
          <div class="funnel-count">${formatNumber(purchases)}</div>
        </div>
      `;
    }

    function renderSalesTrendChart(salesData) {
      const ctx = document.getElementById('salesTrendChart').getContext('2d');

      if (salesTrendChart) salesTrendChart.destroy();

      const labels = salesData.map(d => {
        const date = new Date(d.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });
      const values = salesData.map(d => d.value);
      const orders = salesData.map(d => d.count);

      salesTrendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Revenue',
              data: values,
              borderColor: '#8E6545',
              backgroundColor: 'rgba(142, 101, 69, 0.1)',
              fill: true,
              tension: 0.4,
              yAxisID: 'y'
            },
            {
              label: 'Orders',
              data: orders,
              borderColor: '#2C6ECB',
              backgroundColor: 'transparent',
              borderDash: [5, 5],
              tension: 0.4,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { position: 'bottom' }
          },
          scales: {
            y: {
              type: 'linear',
              position: 'left',
              beginAtZero: true,
              ticks: { callback: value => '$' + value }
            },
            y1: {
              type: 'linear',
              position: 'right',
              beginAtZero: true,
              grid: { drawOnChartArea: false }
            }
          }
        }
      });
    }

    function renderTopProductsTable(products) {
      const tbody = document.querySelector('#top-products-table tbody');

      if (!products || products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-data">No product data available</td></tr>';
        return;
      }

      tbody.innerHTML = products.slice(0, 10).map((p, i) => `
        <tr>
          <td class="rank">${i + 1}</td>
          <td>${Admin.Utils.escapeHtml(p.name)}</td>
          <td class="value">${formatNumber(p.count || 0)}</td>
          <td class="value">${p.orders || 0}</td>
          <td class="value">${Admin.Utils.formatCurrency(p.revenue || 0)}</td>
        </tr>
      `).join('');
    }

    function renderTopFabricsTable(fabrics) {
      const tbody = document.querySelector('#top-fabrics-table tbody');

      if (!fabrics || fabrics.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty-data">No fabric data available</td></tr>';
        return;
      }

      tbody.innerHTML = fabrics.slice(0, 10).map((f, i) => `
        <tr>
          <td class="rank">${i + 1}</td>
          <td>${Admin.Utils.escapeHtml(f.name)}</td>
          <td class="value">${f.orders || 0}</td>
          <td class="value">${Admin.Utils.formatCurrency(f.revenue || 0)}</td>
        </tr>
      `).join('');
    }

    // Sales Tab
    async function loadSalesTab() {
      analyticsData.salesLoaded = true;

      try {
        const response = await Admin.API.get(
          `/analytics/sales?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}&groupBy=day`
        );

        if (response.success) {
          renderDailySalesChart(response.salesData);
          renderSalesBreakdownTable(response.salesData);
        }

        // Category chart (mock data - would need real category tracking)
        renderCategoryChart();

      } catch (error) {
        console.error('Failed to load sales tab:', error);
      }
    }

    function renderDailySalesChart(salesData) {
      const ctx = document.getElementById('dailySalesChart').getContext('2d');

      if (dailySalesChart) dailySalesChart.destroy();

      const labels = salesData.map(d => {
        const date = new Date(d.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });
      const values = salesData.map(d => d.value);

      dailySalesChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Sales',
            data: values,
            backgroundColor: '#8E6545',
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { callback: value => '$' + value }
            }
          }
        }
      });
    }

    async function renderCategoryChart() {
      const ctx = document.getElementById('categoryChart').getContext('2d');

      if (categoryChart) categoryChart.destroy();

      // Fetch real category sales data from API
      try {
        const response = await fetch('/api/admin/analytics/sales-by-category', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
        });
        const result = await response.json();

        if (result.success && result.data.length > 0) {
          const categories = result.data.map(c => c.name);
          const values = result.data.map(c => c.revenue);
          const colors = ['#8E6545', '#B38B6D', '#D4B896', '#2C6ECB', '#6D7175', '#A0522D', '#CD853F'];

          categoryChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: categories,
              datasets: [{
                data: values,
                backgroundColor: colors.slice(0, categories.length)
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: 'bottom' }
              }
            }
          });
        } else {
          // No sales data yet
          ctx.font = '14px Montserrat';
          ctx.fillStyle = '#6D7175';
          ctx.textAlign = 'center';
          ctx.fillText('No category sales data yet', ctx.canvas.width / 2, ctx.canvas.height / 2);
        }
      } catch (error) {
        console.error('Error loading category sales:', error);
      }
    }

    function renderSalesBreakdownTable(salesData) {
      const tbody = document.querySelector('#sales-breakdown-table tbody');

      if (!salesData || salesData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-data">No sales data available</td></tr>';
        return;
      }

      tbody.innerHTML = salesData.map(d => `
        <tr>
          <td>${new Date(d.date).toLocaleDateString()}</td>
          <td class="value">${d.count || 0}</td>
          <td class="value">${Admin.Utils.formatCurrency(d.value || 0)}</td>
          <td class="value">${Admin.Utils.formatCurrency(d.discounts || 0)}</td>
          <td class="value">${Admin.Utils.formatCurrency((d.value || 0) - (d.discounts || 0))}</td>
        </tr>
      `).join('');
    }

    // Products Tab
    async function loadProductsTab() {
      analyticsData.productsLoaded = true;

      try {
        const response = await Admin.API.get(
          `/analytics/products?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}`
        );

        if (response.success) {
          renderAllProductsTable(response.products || []);
          renderProductRevenueChart(response.products || []);
        }

        // Fabric type chart
        const fabricsResponse = await Admin.API.get(
          `/analytics/fabrics?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}`
        );

        if (fabricsResponse.success) {
          renderFabricTypeChart(fabricsResponse.fabrics || []);
        }

      } catch (error) {
        console.error('Failed to load products tab:', error);
      }
    }

    function renderAllProductsTable(products) {
      const tbody = document.querySelector('#all-products-table tbody');

      if (!products || products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-data">No product data available</td></tr>';
        return;
      }

      tbody.innerHTML = products.map((p, i) => {
        const convRate = p.count > 0 ? ((p.orders || 0) / p.count * 100).toFixed(1) : 0;
        return `
          <tr>
            <td class="rank">${i + 1}</td>
            <td>${Admin.Utils.escapeHtml(p.name)}</td>
            <td class="value">${formatNumber(p.count || 0)}</td>
            <td class="value">${p.addToCart || 0}</td>
            <td class="value">${p.orders || 0}</td>
            <td class="value">${Admin.Utils.formatCurrency(p.revenue || 0)}</td>
            <td class="value">${convRate}%</td>
          </tr>
        `;
      }).join('');
    }

    function renderProductRevenueChart(products) {
      const ctx = document.getElementById('productRevenueChart').getContext('2d');

      if (productRevenueChart) productRevenueChart.destroy();

      const topProducts = products.slice(0, 5);
      const labels = topProducts.map(p => p.name);
      const values = topProducts.map(p => p.revenue || 0);
      const colors = ['#8E6545', '#B38B6D', '#D4B896', '#2C6ECB', '#008060'];

      productRevenueChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            data: values,
            backgroundColor: colors,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: { legend: { display: false } },
          scales: {
            x: {
              beginAtZero: true,
              ticks: { callback: value => '$' + value }
            }
          }
        }
      });
    }

    function renderFabricTypeChart(fabrics) {
      const ctx = document.getElementById('fabricTypeChart').getContext('2d');

      if (fabricTypeChart) fabricTypeChart.destroy();

      // Group by type
      const types = { 'Blackout': 0, 'Semi-Blackout': 0, 'Transparent': 0 };
      fabrics.forEach(f => {
        const name = f.name.toLowerCase();
        if (name.includes('blackout')) types['Blackout'] += f.orders || 0;
        else if (name.includes('semi')) types['Semi-Blackout'] += f.orders || 0;
        else types['Transparent'] += f.orders || 0;
      });

      fabricTypeChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(types),
          datasets: [{
            data: Object.values(types),
            backgroundColor: ['#1a1a1a', '#6D7175', '#E5E5E5']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    // Traffic Tab
    async function loadTrafficTab() {
      analyticsData.trafficLoaded = true;

      try {
        const response = await Admin.API.get(
          `/analytics/traffic?startDate=${currentStartDate.toISOString()}&endDate=${currentEndDate.toISOString()}`
        );

        if (response.success) {
          updateTrafficStats(response);
          renderTrafficTrendChart(response.dailyViews || []);
          renderTrafficSourceChart(response.sources || {});
          renderLandingPagesTable(response.landingPages || []);
        }

      } catch (error) {
        console.error('Failed to load traffic tab:', error);
      }
    }

    function updateTrafficStats(data) {
      document.getElementById('total-views').textContent = formatNumber(data.totalViews || 0);
      document.getElementById('unique-visitors').textContent = formatNumber(data.uniqueVisitors || 0);
      document.getElementById('pages-session').textContent = (data.pagesPerSession || 0).toFixed(1);
      document.getElementById('bounce-rate').textContent = (data.bounceRate || 0) + '%';
    }

    function renderTrafficTrendChart(dailyViews) {
      const ctx = document.getElementById('trafficTrendChart').getContext('2d');

      if (trafficTrendChart) trafficTrendChart.destroy();

      const labels = dailyViews.map(d => {
        const date = new Date(d.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });
      const values = dailyViews.map(d => d.views);

      trafficTrendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Page Views',
            data: values,
            borderColor: '#2C6ECB',
            backgroundColor: 'rgba(44, 110, 203, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function renderTrafficSourceChart(sources) {
      const ctx = document.getElementById('trafficSourceChart').getContext('2d');

      if (trafficSourceChart) trafficSourceChart.destroy();

      const labels = Object.keys(sources).map(s => s.charAt(0).toUpperCase() + s.slice(1));
      const values = Object.values(sources);
      const colors = ['#8E6545', '#2C6ECB', '#008060', '#B98900', '#D72C0D'];

      trafficSourceChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{
            data: values,
            backgroundColor: colors.slice(0, labels.length)
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    function renderLandingPagesTable(pages) {
      const tbody = document.querySelector('#landing-pages-table tbody');

      if (!pages || pages.length === 0) {
        // Mock data for demonstration
        pages = [
          { page: '/', views: 1250, unique: 890, bounceRate: 35 },
          { page: '/product.html', views: 890, unique: 650, bounceRate: 22 },
          { page: '/shop.html', views: 445, unique: 320, bounceRate: 28 },
          { page: '/about.html', views: 234, unique: 180, bounceRate: 45 },
          { page: '/contact.html', views: 156, unique: 120, bounceRate: 40 }
        ];
      }

      tbody.innerHTML = pages.slice(0, 10).map((p, i) => `
        <tr>
          <td class="rank">${i + 1}</td>
          <td>${Admin.Utils.escapeHtml(p.page)}</td>
          <td class="value">${formatNumber(p.views)}</td>
          <td class="value">${formatNumber(p.unique)}</td>
          <td class="value">${p.bounceRate}%</td>
        </tr>
      `).join('');
    }

    // Export to CSV
    function exportToCSV(type) {
      let csvContent = '';
      let filename = '';

      switch (type) {
        case 'sales':
          filename = 'sales-report.csv';
          csvContent = 'Date,Revenue,Orders\n';
          document.querySelectorAll('#salesTrendChart').forEach(() => {
            // Would need to access chart data
          });
          break;

        case 'products':
          filename = 'top-products.csv';
          csvContent = 'Rank,Product,Views,Orders,Revenue\n';
          document.querySelectorAll('#top-products-table tbody tr').forEach((row, i) => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 5) {
              csvContent += `${i + 1},"${cells[1].textContent}",${cells[2].textContent},${cells[3].textContent},${cells[4].textContent}\n`;
            }
          });
          break;

        case 'fabrics':
          filename = 'top-fabrics.csv';
          csvContent = 'Rank,Fabric,Orders,Revenue\n';
          document.querySelectorAll('#top-fabrics-table tbody tr').forEach((row, i) => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 4) {
              csvContent += `${i + 1},"${cells[1].textContent}",${cells[2].textContent},${cells[3].textContent}\n`;
            }
          });
          break;

        case 'all-products':
          filename = 'all-products.csv';
          csvContent = 'Rank,Product,Views,Add to Cart,Orders,Revenue,Conversion Rate\n';
          document.querySelectorAll('#all-products-table tbody tr').forEach((row, i) => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 7) {
              csvContent += `${i + 1},"${cells[1].textContent}",${cells[2].textContent},${cells[3].textContent},${cells[4].textContent},${cells[5].textContent},${cells[6].textContent}\n`;
            }
          });
          break;

        case 'sales-breakdown':
          filename = 'sales-breakdown.csv';
          csvContent = 'Date,Orders,Gross Sales,Discounts,Net Sales\n';
          document.querySelectorAll('#sales-breakdown-table tbody tr').forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 5) {
              csvContent += `${cells[0].textContent},${cells[1].textContent},${cells[2].textContent},${cells[3].textContent},${cells[4].textContent}\n`;
            }
          });
          break;
      }

      if (csvContent) {
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        window.URL.revokeObjectURL(url);
        Admin.Toast.success('Report exported successfully');
      }
    }

    // Utility functions
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }
  </script>
</body>
</html>
