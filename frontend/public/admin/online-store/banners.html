<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banners - Peekaboo Shades Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/admin.css">
    <style>
        .banners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        .banner-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .banner-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .banner-preview {
            position: relative;
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            overflow: hidden;
        }
        .banner-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .banner-preview .no-image {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
        }
        .banner-preview .no-image i {
            font-size: 48px;
            margin-bottom: 8px;
        }
        .banner-order {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .banner-status {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .banner-status.active {
            background: #d4edda;
            color: #155724;
        }
        .banner-status.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        .banner-content {
            padding: 20px;
        }
        .banner-content h3 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .banner-content p {
            margin: 0 0 16px 0;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        .banner-meta {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #888;
        }
        .banner-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .banner-actions {
            display: flex;
            gap: 8px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }
        .banner-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .btn-edit {
            background: #f0f0f0;
            color: #333;
        }
        .btn-edit:hover {
            background: #e0e0e0;
        }
        .btn-toggle {
            background: #fff3cd;
            color: #856404;
        }
        .btn-toggle:hover {
            background: #ffeeba;
        }
        .btn-delete {
            background: #fee;
            color: #c00;
        }
        .btn-delete:hover {
            background: #fdd;
        }
        .add-banner-card {
            background: #f9f9f9;
            border: 2px dashed #ddd;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .add-banner-card:hover {
            border-color: #8E6545;
            background: #faf8f6;
        }
        .add-banner-card i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 16px;
        }
        .add-banner-card:hover i {
            color: #8E6545;
        }
        .add-banner-card span {
            font-size: 16px;
            color: #999;
            font-weight: 500;
        }
        .add-banner-card:hover span {
            color: #8E6545;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        .modal-close:hover {
            color: #333;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid #eee;
            background: #f9f9f9;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .image-preview-box {
            width: 100%;
            height: 180px;
            background: #f5f5f5;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .image-preview-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-preview-box.empty i {
            font-size: 36px;
            color: #ccc;
            margin-bottom: 8px;
        }
        .image-preview-box.empty span {
            font-size: 13px;
            color: #999;
        }
        .color-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .color-row input[type="color"] {
            width: 50px;
            height: 40px;
            padding: 2px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        .color-row input[type="text"] {
            flex: 1;
        }
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 26px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        .toggle-switch input:checked + .toggle-slider {
            background-color: #8E6545;
        }
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        .empty-state {
            text-align: center;
            padding: 60px 40px;
            background: white;
            border-radius: 12px;
        }
        .empty-state i {
            font-size: 64px;
            color: #ddd;
            margin-bottom: 20px;
        }
        .empty-state h3 {
            margin: 0 0 12px 0;
            font-size: 20px;
            color: #333;
        }
        .empty-state p {
            margin: 0 0 24px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="logo">
                    <i class="fas fa-store"></i>
                    <span>Peekaboo Admin</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <a href="../index.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>

                <div class="nav-section-title">Catalog</div>
                <a href="../products.html" class="nav-item">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="../categories.html" class="nav-item">
                    <i class="fas fa-tags"></i>
                    <span>Categories</span>
                </a>

                <div class="nav-section-title">Sales</div>
                <a href="../orders.html" class="nav-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="../quotes.html" class="nav-item">
                    <i class="fas fa-file-invoice"></i>
                    <span>Quotes</span>
                </a>

                <div class="nav-section-title">Online Store</div>
                <a href="themes.html" class="nav-item">
                    <i class="fas fa-palette"></i>
                    <span>Themes</span>
                </a>
                <a href="homepage.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Homepage</span>
                </a>
                <a href="navigation.html" class="nav-item">
                    <i class="fas fa-bars"></i>
                    <span>Navigation</span>
                </a>
                <a href="banners.html" class="nav-item active">
                    <i class="fas fa-images"></i>
                    <span>Banners</span>
                </a>
                <a href="shop-settings.html" class="nav-item">
                    <i class="fas fa-store"></i>
                    <span>Shop Settings</span>
                </a>

                <div class="nav-section-title">Content</div>
                <a href="../faqs.html" class="nav-item">
                    <i class="fas fa-question-circle"></i>
                    <span>FAQs</span>
                </a>

                <div class="nav-section-title">Settings</div>
                <a href="../settings.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <h1>Banners & Hero Slides</h1>
                    <p class="subtitle">Manage homepage slider and promotional banners</p>
                </div>
                <div class="header-right">
                    <a href="/" target="_blank" class="btn btn-secondary">
                        <i class="fas fa-external-link-alt"></i> View Store
                    </a>
                    <button class="btn btn-primary" onclick="openModal()">
                        <i class="fas fa-plus"></i> Add Banner
                    </button>
                </div>
            </header>

            <div class="content-body">
                <div id="bannersContainer" class="banners-grid">
                    <!-- Banners will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Banner Modal -->
    <div id="bannerModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Banner</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bannerForm">
                    <input type="hidden" id="bannerId">

                    <div class="form-group">
                        <label>Banner Image</label>
                        <div class="image-preview-box empty" id="imagePreview">
                            <i class="fas fa-image"></i>
                            <span>Enter image URL below</span>
                        </div>
                        <input type="text" id="bannerImage" class="form-control" placeholder="https://example.com/banner.jpg" onchange="updateImagePreview()">
                        <small class="form-text">Recommended size: 1920x800 pixels</small>
                    </div>

                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="bannerTitle" class="form-control" placeholder="Banner headline text">
                    </div>

                    <div class="form-group">
                        <label>Subtitle / Description</label>
                        <textarea id="bannerSubtitle" class="form-control" rows="2" placeholder="Optional description text"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Button Text</label>
                            <input type="text" id="bannerButtonText" class="form-control" placeholder="Shop Now">
                        </div>
                        <div class="form-group">
                            <label>Button Link</label>
                            <input type="text" id="bannerButtonLink" class="form-control" placeholder="/shop">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Text Color</label>
                            <div class="color-row">
                                <input type="color" id="bannerTextColor" value="#ffffff" onchange="document.getElementById('textColorHex').value = this.value">
                                <input type="text" id="textColorHex" class="form-control" value="#ffffff" onchange="document.getElementById('bannerTextColor').value = this.value">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Overlay Color</label>
                            <div class="color-row">
                                <input type="color" id="bannerOverlayColor" value="#000000" onchange="document.getElementById('overlayColorHex').value = this.value">
                                <input type="text" id="overlayColorHex" class="form-control" value="#000000" onchange="document.getElementById('bannerOverlayColor').value = this.value">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Overlay Opacity</label>
                            <input type="range" id="bannerOverlayOpacity" min="0" max="100" value="30" class="form-control" oninput="document.getElementById('opacityValue').textContent = this.value + '%'">
                            <small class="form-text"><span id="opacityValue">30%</span></small>
                        </div>
                        <div class="form-group">
                            <label>Sort Order</label>
                            <input type="number" id="bannerOrder" class="form-control" value="0" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="bannerActive" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Active (visible on website)</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveBanner()">
                    <i class="fas fa-save"></i> Save Banner
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="../js/admin.js"></script>
    <script>
        let banners = [];
        let editingBannerId = null;

        // Load banners
        async function loadBanners() {
            try {
                const response = await fetch('/api/site-content/hero-slides');
                if (response.ok) {
                    const data = await response.json();
                    banners = data.heroSlides || [];
                }
                renderBanners();
            } catch (error) {
                console.error('Error loading banners:', error);
                showToast('Error loading banners', 'error');
            }
        }

        // Render banners
        function renderBanners() {
            const container = document.getElementById('bannersContainer');

            if (banners.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-images"></i>
                        <h3>No Banners Yet</h3>
                        <p>Create your first homepage banner to showcase promotions and featured content.</p>
                        <button class="btn btn-primary" onclick="openModal()">
                            <i class="fas fa-plus"></i> Add First Banner
                        </button>
                    </div>
                `;
                return;
            }

            // Sort by order
            const sortedBanners = [...banners].sort((a, b) => (a.order || 0) - (b.order || 0));

            container.innerHTML = sortedBanners.map((banner, index) => `
                <div class="banner-card">
                    <div class="banner-preview">
                        ${banner.image ?
                            `<img src="${escapeHtml(banner.image)}" alt="${escapeHtml(banner.title)}" onerror="this.parentElement.innerHTML='<div class=\\'no-image\\'><i class=\\'fas fa-image\\'></i><span>Image not found</span></div>'">` :
                            `<div class="no-image"><i class="fas fa-image"></i><span>No image</span></div>`
                        }
                        <span class="banner-order">#${index + 1}</span>
                        <span class="banner-status ${banner.active !== false ? 'active' : 'inactive'}">
                            ${banner.active !== false ? 'Active' : 'Inactive'}
                        </span>
                    </div>
                    <div class="banner-content">
                        <h3>${escapeHtml(banner.title) || 'Untitled Banner'}</h3>
                        <p>${escapeHtml(banner.subtitle) || 'No description'}</p>
                        <div class="banner-meta">
                            ${banner.buttonText ? `<span><i class="fas fa-link"></i> ${escapeHtml(banner.buttonText)}</span>` : ''}
                            ${banner.buttonLink ? `<span><i class="fas fa-external-link-alt"></i> ${escapeHtml(banner.buttonLink)}</span>` : ''}
                        </div>
                        <div class="banner-actions">
                            <button class="btn-edit" onclick="editBanner('${banner.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-toggle" onclick="toggleBanner('${banner.id}')">
                                <i class="fas fa-${banner.active !== false ? 'eye-slash' : 'eye'}"></i>
                                ${banner.active !== false ? 'Hide' : 'Show'}
                            </button>
                            <button class="btn-delete" onclick="deleteBanner('${banner.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Open modal for new banner
        function openModal(bannerId = null) {
            editingBannerId = bannerId;
            const modal = document.getElementById('bannerModal');
            const form = document.getElementById('bannerForm');
            const title = document.getElementById('modalTitle');

            form.reset();
            document.getElementById('imagePreview').innerHTML = '<i class="fas fa-image"></i><span>Enter image URL below</span>';
            document.getElementById('imagePreview').classList.add('empty');

            if (bannerId) {
                const banner = banners.find(b => b.id === bannerId);
                if (banner) {
                    title.textContent = 'Edit Banner';
                    document.getElementById('bannerId').value = banner.id;
                    document.getElementById('bannerImage').value = banner.image || '';
                    document.getElementById('bannerTitle').value = banner.title || '';
                    document.getElementById('bannerSubtitle').value = banner.subtitle || '';
                    document.getElementById('bannerButtonText').value = banner.buttonText || '';
                    document.getElementById('bannerButtonLink').value = banner.buttonLink || '';
                    document.getElementById('bannerTextColor').value = banner.textColor || '#ffffff';
                    document.getElementById('textColorHex').value = banner.textColor || '#ffffff';
                    document.getElementById('bannerOverlayColor').value = banner.overlayColor || '#000000';
                    document.getElementById('overlayColorHex').value = banner.overlayColor || '#000000';
                    document.getElementById('bannerOverlayOpacity').value = (banner.overlayOpacity || 0.3) * 100;
                    document.getElementById('opacityValue').textContent = ((banner.overlayOpacity || 0.3) * 100) + '%';
                    document.getElementById('bannerOrder').value = banner.order || 0;
                    document.getElementById('bannerActive').checked = banner.active !== false;
                    updateImagePreview();
                }
            } else {
                title.textContent = 'Add New Banner';
                document.getElementById('bannerOrder').value = banners.length;
            }

            modal.classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('bannerModal').classList.remove('show');
            editingBannerId = null;
        }

        // Update image preview
        function updateImagePreview() {
            const url = document.getElementById('bannerImage').value;
            const preview = document.getElementById('imagePreview');

            if (url) {
                preview.innerHTML = `<img src="${escapeHtml(url)}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-exclamation-triangle\\'></i><span>Invalid image URL</span>'; this.parentElement.classList.add('empty');">`;
                preview.classList.remove('empty');
            } else {
                preview.innerHTML = '<i class="fas fa-image"></i><span>Enter image URL below</span>';
                preview.classList.add('empty');
            }
        }

        // Save banner
        async function saveBanner() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = '../login.html';
                return;
            }

            const bannerData = {
                id: editingBannerId || `slide-${Date.now()}`,
                image: document.getElementById('bannerImage').value,
                title: document.getElementById('bannerTitle').value,
                subtitle: document.getElementById('bannerSubtitle').value,
                buttonText: document.getElementById('bannerButtonText').value,
                buttonLink: document.getElementById('bannerButtonLink').value,
                textColor: document.getElementById('bannerTextColor').value,
                overlayColor: document.getElementById('bannerOverlayColor').value,
                overlayOpacity: parseInt(document.getElementById('bannerOverlayOpacity').value) / 100,
                order: parseInt(document.getElementById('bannerOrder').value) || 0,
                active: document.getElementById('bannerActive').checked
            };

            try {
                if (editingBannerId) {
                    // Update existing
                    const index = banners.findIndex(b => b.id === editingBannerId);
                    if (index !== -1) {
                        banners[index] = bannerData;
                    }
                } else {
                    // Add new
                    banners.push(bannerData);
                }

                const response = await fetch('/api/admin/site-content/hero-slides', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(banners)
                });

                if (!response.ok) {
                    throw new Error('Failed to save banner');
                }

                showToast('Banner saved successfully!', 'success');
                closeModal();
                renderBanners();
            } catch (error) {
                console.error('Error saving banner:', error);
                showToast('Error saving banner: ' + error.message, 'error');
            }
        }

        // Edit banner
        function editBanner(id) {
            openModal(id);
        }

        // Toggle banner active status
        async function toggleBanner(id) {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = '../login.html';
                return;
            }

            const banner = banners.find(b => b.id === id);
            if (banner) {
                banner.active = banner.active === false ? true : false;

                try {
                    const response = await fetch('/api/admin/site-content/hero-slides', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(banners)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to update banner');
                    }

                    showToast(`Banner ${banner.active ? 'activated' : 'hidden'}`, 'success');
                    renderBanners();
                } catch (error) {
                    console.error('Error toggling banner:', error);
                    showToast('Error updating banner', 'error');
                }
            }
        }

        // Delete banner
        async function deleteBanner(id) {
            if (!confirm('Are you sure you want to delete this banner?')) {
                return;
            }

            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = '../login.html';
                return;
            }

            banners = banners.filter(b => b.id !== id);

            try {
                const response = await fetch('/api/admin/site-content/hero-slides', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(banners)
                });

                if (!response.ok) {
                    throw new Error('Failed to delete banner');
                }

                showToast('Banner deleted', 'success');
                renderBanners();
            } catch (error) {
                console.error('Error deleting banner:', error);
                showToast('Error deleting banner', 'error');
                loadBanners(); // Reload to restore state
            }
        }

        // Escape HTML
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;');
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadBanners();
        });

        // Close modal on outside click
        document.getElementById('bannerModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });
    </script>
</body>
</html>
