<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Details - Peekaboo Shades Admin</title>
  <link rel="stylesheet" href="css/admin.css">
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <style>
    .customer-header {
      display: flex;
      align-items: flex-start;
      gap: 24px;
      margin-bottom: 24px;
    }
    .customer-avatar-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #8E6545;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 28px;
      flex-shrink: 0;
    }
    .customer-header-info {
      flex: 1;
    }
    .customer-header-name {
      font-size: 24px;
      font-weight: 600;
      color: #202223;
      margin-bottom: 4px;
    }
    .customer-header-email {
      color: #6D7175;
      margin-bottom: 12px;
    }
    .customer-header-meta {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }
    .customer-meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #6D7175;
    }
    .customer-meta-item svg {
      width: 16px;
      height: 16px;
    }
    .customer-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
    }
    @media (max-width: 1024px) {
      .customer-layout {
        grid-template-columns: 1fr;
      }
    }
    .customer-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }
    .customer-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid #E5E5E5;
    }
    .customer-section-title {
      font-size: 16px;
      font-weight: 600;
      color: #202223;
    }
    .customer-section-body {
      padding: 20px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-box {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      text-align: center;
    }
    .stat-box-value {
      font-size: 28px;
      font-weight: 600;
      color: #202223;
    }
    .stat-box-label {
      font-size: 13px;
      color: #6D7175;
      margin-top: 4px;
    }
    .info-table {
      width: 100%;
      border-collapse: collapse;
      border: 2px solid #1a1a2e;
    }
    .info-table th,
    .info-table td {
      padding: 12px 16px;
      text-align: left;
      border: 1px solid #ddd;
      font-size: 14px;
    }
    .info-table th {
      background: #1a1a2e;
      color: white;
      font-weight: 600;
      width: 40%;
    }
    .info-table td {
      background: white;
      color: #202223;
    }
    .address-table {
      width: 100%;
      border-collapse: collapse;
      border: 2px solid #1a1a2e;
      margin-bottom: 16px;
    }
    .address-table th,
    .address-table td {
      padding: 10px 14px;
      text-align: left;
      border: 1px solid #ddd;
      font-size: 13px;
    }
    .address-table th {
      background: #1a1a2e;
      color: white;
      font-weight: 600;
    }
    .address-table td {
      background: white;
      color: #202223;
    }
    .customer-tags-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .customer-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: #F6F6F7;
      border-radius: 4px;
      font-size: 13px;
      color: #6D7175;
    }
    .customer-tag .remove-tag {
      cursor: pointer;
      opacity: 0.6;
    }
    .customer-tag .remove-tag:hover {
      opacity: 1;
    }
    .add-tag-input {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .add-tag-input input {
      flex: 1;
    }
    .timeline {
      padding: 0;
      margin: 0;
      list-style: none;
    }
    .timeline-item {
      display: flex;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid #F0F0F0;
    }
    .timeline-item:last-child {
      border-bottom: none;
    }
    .timeline-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .timeline-icon.order { background: #E3F1DF; color: #008060; }
    .timeline-icon.quote { background: #FFF5EA; color: #B98900; }
    .timeline-icon.note { background: #E8F4FD; color: #2C6ECB; }
    .timeline-content {
      flex: 1;
    }
    .timeline-title {
      font-size: 14px;
      font-weight: 500;
      color: #202223;
      margin-bottom: 2px;
    }
    .timeline-desc {
      font-size: 13px;
      color: #6D7175;
    }
    .timeline-time {
      font-size: 12px;
      color: #8C9196;
      white-space: nowrap;
    }
    .note-input {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .note-input textarea {
      flex: 1;
      resize: vertical;
    }
    .orders-mini-table th,
    .orders-mini-table td {
      padding: 10px 8px;
      font-size: 13px;
    }
    .empty-section {
      text-align: center;
      padding: 40px 20px;
      color: #6D7175;
    }
    .customer-type-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 500;
    }
    .customer-type-badge.retail { background: #E8F4FD; color: #2C6ECB; }
    .customer-type-badge.designer { background: #F3E8FF; color: #7C3AED; }
    .customer-type-badge.contractor { background: #FFF5EA; color: #B98900; }
    .address-card {
      padding: 16px;
      background: #F6F6F7;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    .address-card:last-child {
      margin-bottom: 0;
    }
    .address-label {
      font-size: 12px;
      font-weight: 600;
      color: #6D7175;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .address-text {
      font-size: 14px;
      color: #202223;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <a href="/admin/" class="sidebar-logo">
          <img src="/images/peekabooshades_logo.jpeg" alt="Peekaboo Shades" style="height: 32px; width: auto; border-radius: 6px;">
          <span>Peekaboo Shades</span>
        </a>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <a href="/admin/" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>Dashboard</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Sales</div>
          <a href="/admin/orders.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
            <span>Orders</span>
          </a>
          <a href="/admin/draft-orders.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            <span>Draft Orders</span>
          </a>
          <a href="/admin/abandoned-checkouts.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>Abandoned Carts</span>
          </a>
          <a href="/admin/quotes.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span>Quotes</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Catalog</div>
          <a href="/admin/products.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
            <span>Products</span>
          </a>
          <a href="/admin/categories.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
            </svg>
            <span>Categories</span>
          </a>
          <a href="/admin/fabrics.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span>Fabrics</span>
          </a>
          <a href="/admin/hardware-options.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Hardware Options</span>
          </a>
          <a href="/admin/accessories.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z" />
            </svg>
            <span>Accessories</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Customers</div>
          <a href="/admin/customers.html" class="nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>All Customers</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Content</div>
          <a href="/admin/product-content.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span>Product Content</span>
          </a>
          <a href="/admin/product-page-editor.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            <span>Page Editor</span>
          </a>
          <a href="/admin/pages.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
            </svg>
            <span>Pages</span>
          </a>
          <a href="/admin/blog/posts.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
            </svg>
            <span>Blog Posts</span>
          </a>
          <a href="/admin/files.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span>Files</span>
          </a>
          <a href="/admin/faqs.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>FAQs</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Analytics</div>
          <a href="/admin/analytics.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <span>Reports</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <a href="/admin/settings.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Settings</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
      <!-- Header -->
      <header class="admin-header">
        <div class="header-left">
          <button class="header-btn mobile-menu-btn" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <div class="breadcrumb">
            <a href="/admin/" class="breadcrumb-link">Dashboard</a>
            <span class="breadcrumb-separator">/</span>
            <a href="/admin/customers.html" class="breadcrumb-link">Customers</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current" id="breadcrumb-name">Loading...</span>
          </div>
        </div>
        <div class="header-right">
          <a href="/" class="header-btn" title="View Store" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
          <div class="dropdown">
            <div class="header-profile">
              <div class="profile-avatar">A</div>
              <span class="profile-name">Admin</span>
            </div>
            <div class="dropdown-menu profile-dropdown">
              <a href="/admin/settings.html" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Profile
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item danger" onclick="Admin.AuthAPI.logout(); return false;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                Logout
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="admin-content" id="customerContent">
        <!-- Loading state -->
        <div style="text-align: center; padding: 60px;">
          <div style="font-size: 16px; color: #6D7175;">Loading customer...</div>
        </div>
      </div>
    </main>
  </div>

  <script src="js/admin.js"></script>
  <script>
    let customer = null;
    let customerId = null;

    // Require authentication
    if (!Admin.Auth.requireAuth()) {
      // Will redirect to login
    } else {
      const urlParams = new URLSearchParams(window.location.search);
      customerId = urlParams.get('id');

      if (!customerId) {
        window.location.href = '/admin/customers.html';
      } else {
        loadCustomer();
      }
    }

    async function loadCustomer() {
      try {
        const response = await Admin.API.get(`/customers/${customerId}`);

        if (response.success) {
          customer = response.customer;
          renderCustomer();
        } else {
          Admin.Toast.error('Customer not found');
          window.location.href = '/admin/customers.html';
        }
      } catch (error) {
        console.error('Failed to load customer:', error);
        Admin.Toast.error('Failed to load customer');
      }
    }

    function renderCustomer() {
      const initials = getInitials(customer.firstName, customer.lastName);
      const fullName = `${customer.firstName || ''} ${customer.lastName || ''}`.trim();

      document.getElementById('breadcrumb-name').textContent = fullName;
      document.title = `${fullName} - Peekaboo Shades Admin`;

      const content = document.getElementById('customerContent');
      content.innerHTML = `
        <!-- Customer Header -->
        <div class="customer-header">
          <div class="customer-avatar-large">${initials}</div>
          <div class="customer-header-info">
            <div class="customer-header-name">${Admin.Utils.escapeHtml(fullName)}</div>
            <div class="customer-header-email">${Admin.Utils.escapeHtml(customer.email)}</div>
            <div class="customer-header-meta">
              <span class="customer-type-badge ${customer.type || 'retail'}">
                ${capitalizeFirst(customer.type || 'retail')}
              </span>
              ${customer.phone ? `
                <div class="customer-meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                  ${Admin.Utils.escapeHtml(customer.phone)}
                </div>
              ` : ''}
              ${customer.companyName ? `
                <div class="customer-meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                  </svg>
                  ${Admin.Utils.escapeHtml(customer.companyName)}
                </div>
              ` : ''}
              <div class="customer-meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Customer since ${Admin.Utils.formatDate(customer.createdAt)}
              </div>
            </div>
          </div>
          <div class="customer-header-actions">
            <button class="btn btn-secondary" onclick="editCustomer()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              Edit
            </button>
            <button class="btn btn-danger" onclick="deleteCustomer()">Delete</button>
          </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-box-value">${customer.totalOrders || 0}</div>
            <div class="stat-box-label">Total Orders</div>
          </div>
          <div class="stat-box">
            <div class="stat-box-value">${Admin.Utils.formatCurrency(customer.totalSpent || 0)}</div>
            <div class="stat-box-label">Total Spent</div>
          </div>
          <div class="stat-box">
            <div class="stat-box-value">${customer.totalOrders > 0 ? Admin.Utils.formatCurrency((customer.totalSpent || 0) / customer.totalOrders) : '$0.00'}</div>
            <div class="stat-box-label">Avg Order Value</div>
          </div>
        </div>

        <!-- Two Column Layout -->
        <div class="customer-layout">
          <!-- Left Column -->
          <div>
            <!-- Orders Section -->
            <div class="customer-section">
              <div class="customer-section-header">
                <h3 class="customer-section-title">Order History</h3>
                <a href="/admin/draft-orders.html?customer=${customerId}" class="btn btn-primary btn-sm">Create Order</a>
              </div>
              <div class="customer-section-body">
                <div id="orders-list">
                  <div class="empty-section">Loading orders...</div>
                </div>
              </div>
            </div>

            <!-- Timeline Section -->
            <div class="customer-section">
              <div class="customer-section-header">
                <h3 class="customer-section-title">Activity Timeline</h3>
              </div>
              <div class="customer-section-body">
                <div class="note-input">
                  <textarea class="form-input" id="noteInput" placeholder="Add a note about this customer..." rows="2"></textarea>
                  <button class="btn btn-primary" onclick="addNote()">Add Note</button>
                </div>
                <ul class="timeline" id="timeline">
                  <li class="empty-section">No activity yet</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <!-- Contact Info -->
            <div class="customer-section">
              <div class="customer-section-header">
                <h3 class="customer-section-title">Contact Information</h3>
                <button class="btn btn-secondary btn-sm" onclick="editContact()">Edit</button>
              </div>
              <div class="customer-section-body">
                <table class="info-table">
                  <tr>
                    <th>Email</th>
                    <td>${Admin.Utils.escapeHtml(customer.email)}</td>
                  </tr>
                  <tr>
                    <th>Phone</th>
                    <td>${customer.phone ? Admin.Utils.escapeHtml(customer.phone) : '-'}</td>
                  </tr>
                  <tr>
                    <th>Company</th>
                    <td>${customer.companyName ? Admin.Utils.escapeHtml(customer.companyName) : '-'}</td>
                  </tr>
                  <tr>
                    <th>Type</th>
                    <td>${capitalizeFirst(customer.type || 'retail')}</td>
                  </tr>
                  <tr>
                    <th>Customer Since</th>
                    <td>${Admin.Utils.formatDate(customer.createdAt)}</td>
                  </tr>
                </table>
              </div>
            </div>

            <!-- Tags -->
            <div class="customer-section">
              <div class="customer-section-header">
                <h3 class="customer-section-title">Tags</h3>
              </div>
              <div class="customer-section-body">
                <div class="customer-tags-list" id="tags-list">
                  ${(customer.tags || []).map(tag => `
                    <span class="customer-tag">
                      ${Admin.Utils.escapeHtml(tag)}
                      <span class="remove-tag" onclick="removeTag('${tag}')">&times;</span>
                    </span>
                  `).join('') || '<span style="color: #6D7175;">No tags</span>'}
                </div>
                <div class="add-tag-input">
                  <input type="text" class="form-input" id="newTag" placeholder="Add a tag...">
                  <button class="btn btn-secondary btn-sm" onclick="addTag()">Add</button>
                </div>
              </div>
            </div>

            <!-- Notes -->
            <div class="customer-section">
              <div class="customer-section-header">
                <h3 class="customer-section-title">Notes</h3>
              </div>
              <div class="customer-section-body">
                <p style="color: ${customer.notes ? '#202223' : '#6D7175'}; margin: 0; white-space: pre-wrap;">
                  ${customer.notes ? Admin.Utils.escapeHtml(customer.notes) : 'No notes'}
                </p>
              </div>
            </div>

            <!-- Addresses -->
            <div class="customer-section">
              <div class="customer-section-header">
                <h3 class="customer-section-title">Addresses</h3>
                <button class="btn btn-secondary btn-sm" onclick="addAddress()">Add</button>
              </div>
              <div class="customer-section-body" id="addresses-list">
                ${renderAddresses(customer.addresses || [])}
              </div>
            </div>
          </div>
        </div>
      `;

      // Load orders
      loadCustomerOrders();
      // Build timeline
      buildTimeline();
    }

    async function loadCustomerOrders() {
      try {
        // Get orders for this customer
        const response = await Admin.API.get(`/orders?customerId=${customerId}`);
        const ordersList = document.getElementById('orders-list');

        if (response.success && response.orders && response.orders.length > 0) {
          ordersList.innerHTML = `
            <table class="admin-table orders-mini-table">
              <thead>
                <tr>
                  <th>Order</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th style="text-align: right;">Total</th>
                </tr>
              </thead>
              <tbody>
                ${response.orders.map(order => `
                  <tr>
                    <td>
                      <a href="/admin/orders.html?id=${order.id}" style="color: var(--admin-primary);">
                        #${order.order_number || order.id.slice(0, 8)}
                      </a>
                    </td>
                    <td>${Admin.Utils.formatDate(order.created_at)}</td>
                    <td>
                      <span class="badge badge-${getStatusBadgeClass(order.status)}">
                        ${capitalizeFirst(order.status)}
                      </span>
                    </td>
                    <td style="text-align: right;">${Admin.Utils.formatCurrency(order.total || 0)}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        } else {
          ordersList.innerHTML = '<div class="empty-section">No orders yet</div>';
        }
      } catch (error) {
        console.error('Failed to load orders:', error);
      }
    }

    function buildTimeline() {
      const timeline = document.getElementById('timeline');
      const events = [];

      // Add customer creation
      events.push({
        type: 'note',
        title: 'Customer created',
        desc: `Account created`,
        time: customer.createdAt
      });

      // Sort by date
      events.sort((a, b) => new Date(b.time) - new Date(a.time));

      if (events.length === 0) {
        timeline.innerHTML = '<li class="empty-section">No activity yet</li>';
        return;
      }

      timeline.innerHTML = events.map(event => `
        <li class="timeline-item">
          <div class="timeline-icon ${event.type}">
            ${getTimelineIcon(event.type)}
          </div>
          <div class="timeline-content">
            <div class="timeline-title">${Admin.Utils.escapeHtml(event.title)}</div>
            <div class="timeline-desc">${Admin.Utils.escapeHtml(event.desc)}</div>
          </div>
          <div class="timeline-time">${timeAgo(event.time)}</div>
        </li>
      `).join('');
    }

    function getTimelineIcon(type) {
      const icons = {
        order: '<svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>',
        quote: '<svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>',
        note: '<svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>'
      };
      return icons[type] || icons.note;
    }

    function renderAddresses(addresses) {
      if (!addresses || addresses.length === 0) {
        return '<div class="empty-section">No addresses</div>';
      }

      return `
        <table class="address-table">
          <thead>
            <tr>
              <th>#</th>
              <th>TYPE</th>
              <th>NAME</th>
              <th>ADDRESS</th>
              <th>CITY</th>
              <th>STATE</th>
              <th>ZIP</th>
              <th>COUNTRY</th>
              <th>PHONE</th>
            </tr>
          </thead>
          <tbody>
            ${addresses.map((addr, i) => `
              <tr>
                <td>${i + 1}</td>
                <td>${(addr.type || 'shipping').toUpperCase()}${addr.default ? ' (Default)' : ''}</td>
                <td>${Admin.Utils.escapeHtml((addr.firstName || '') + ' ' + (addr.lastName || ''))}</td>
                <td>${Admin.Utils.escapeHtml(addr.address1 || addr.street || '')}${addr.address2 ? ', ' + Admin.Utils.escapeHtml(addr.address2) : ''}</td>
                <td>${Admin.Utils.escapeHtml(addr.city || '-')}</td>
                <td>${Admin.Utils.escapeHtml(addr.state || '-')}</td>
                <td>${Admin.Utils.escapeHtml(addr.zip || '-')}</td>
                <td>${Admin.Utils.escapeHtml(addr.country || 'US')}</td>
                <td>${Admin.Utils.escapeHtml(addr.phone || '-')}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    async function addTag() {
      const input = document.getElementById('newTag');
      const tag = input.value.trim();
      if (!tag) return;

      const tags = customer.tags || [];
      if (tags.includes(tag)) {
        Admin.Toast.error('Tag already exists');
        return;
      }

      tags.push(tag);

      try {
        const response = await Admin.API.put(`/customers/${customerId}`, { tags });
        if (response.success) {
          customer.tags = tags;
          input.value = '';
          loadCustomer();
          Admin.Toast.success('Tag added');
        }
      } catch (error) {
        Admin.Toast.error('Failed to add tag');
      }
    }

    async function removeTag(tag) {
      const tags = (customer.tags || []).filter(t => t !== tag);

      try {
        const response = await Admin.API.put(`/customers/${customerId}`, { tags });
        if (response.success) {
          customer.tags = tags;
          loadCustomer();
          Admin.Toast.success('Tag removed');
        }
      } catch (error) {
        Admin.Toast.error('Failed to remove tag');
      }
    }

    async function addNote() {
      const input = document.getElementById('noteInput');
      const note = input.value.trim();
      if (!note) return;

      try {
        const response = await Admin.API.post(`/customers/${customerId}/notes`, { text: note });
        if (response.success) {
          input.value = '';
          loadCustomer();
          Admin.Toast.success('Note added');
        }
      } catch (error) {
        Admin.Toast.error('Failed to add note');
      }
    }

    function editCustomer() {
      // Redirect to customers page with edit action
      window.location.href = `/admin/customers.html?edit=${customerId}`;
    }

    function editContact() {
      editCustomer();
    }

    function addAddress() {
      Admin.Toast.info('Address management would open here');
    }

    async function deleteCustomer() {
      if (!confirm('Are you sure you want to delete this customer? This cannot be undone.')) return;

      try {
        const response = await Admin.API.delete(`/customers/${customerId}`);
        if (response.success) {
          Admin.Toast.success('Customer deleted');
          window.location.href = '/admin/customers.html';
        } else {
          Admin.Toast.error(response.error || 'Failed to delete customer');
        }
      } catch (error) {
        Admin.Toast.error('Failed to delete customer');
      }
    }

    function getInitials(firstName, lastName) {
      return ((firstName || '').charAt(0) + (lastName || '').charAt(0)).toUpperCase() || '?';
    }

    function capitalizeFirst(str) {
      return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
    }

    function getStatusBadgeClass(status) {
      const classes = {
        pending: 'warning',
        processing: 'info',
        shipped: 'info',
        delivered: 'success',
        cancelled: 'error'
      };
      return classes[status] || 'neutral';
    }

    function timeAgo(date) {
      const seconds = Math.floor((new Date() - new Date(date)) / 1000);
      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
      if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
      if (seconds < 604800) return Math.floor(seconds / 86400) + 'd ago';
      return Admin.Utils.formatDate(date);
    }
  </script>
</body>
</html>
