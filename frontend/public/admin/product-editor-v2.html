<!DOCTYPE html>
<!-- VERSION 2.0 - Updated with separate configurator elements -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Product Page Editor v2.0 - Peekaboo Shades Admin</title>
  <link rel="stylesheet" href="css/admin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f6f6f7;
      overflow: hidden;
    }

    /* Top Header Bar */
    .editor-header {
      height: 56px;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .editor-header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #fff;
      text-decoration: none;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .back-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    .editor-title {
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .editor-title .page-name {
      color: #b5b5b5;
    }

    .editor-header-center {
      display: flex;
      align-items: center;
      gap: 4px;
      background: #2a2a2a;
      border-radius: 8px;
      padding: 4px;
    }

    .view-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: #888;
      font-size: 13px;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .view-btn.active {
      background: #404040;
      color: #fff;
    }

    .view-btn:hover:not(.active) {
      color: #fff;
    }

    .editor-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .preview-link {
      color: #888;
      font-size: 13px;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .preview-link:hover {
      color: #fff;
      background: rgba(255,255,255,0.1);
    }

    .save-status {
      color: #888;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .save-status.saving { color: #f5a623; }
    .save-status.saved { color: #50c878; }

    .save-btn {
      padding: 8px 20px;
      background: #008060;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .save-btn:hover {
      background: #006e52;
    }

    .save-btn:disabled {
      background: #404040;
      cursor: not-allowed;
    }

    /* Main Layout */
    .editor-layout {
      display: flex;
      height: calc(100vh - 56px);
      margin-top: 56px;
    }

    /* Left Sidebar - Sections */
    .sections-sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e1e3e5;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #e1e3e5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sidebar-title {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .add-section-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: #f6f6f7;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #637381;
      transition: all 0.2s;
    }

    .add-section-btn:hover {
      background: #e1e3e5;
      color: #1a1a1a;
    }

    .sections-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .section-group {
      margin-bottom: 8px;
    }

    .section-group-header {
      font-size: 11px;
      font-weight: 600;
      color: #637381;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 8px 12px;
    }

    .section-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #f9fafb;
      border: 1px solid transparent;
      border-radius: 8px;
      margin-bottom: 4px;
      cursor: grab;
      transition: all 0.2s;
      user-select: none;
    }

    .section-item:hover {
      background: #f1f2f4;
      border-color: #c9cccf;
    }

    .section-item.active {
      background: #f4f0ff;
      border-color: #8b5cf6;
    }

    .section-item.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
    }

    .section-item.drag-over {
      border-color: #008060;
      border-style: dashed;
    }

    .section-icon {
      width: 36px;
      height: 36px;
      background: #fff;
      border: 1px solid #e1e3e5;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #637381;
      flex-shrink: 0;
    }

    .section-item.active .section-icon {
      background: #8b5cf6;
      border-color: #8b5cf6;
      color: #fff;
    }

    .section-details {
      flex: 1;
      min-width: 0;
    }

    .section-name {
      font-size: 13px;
      font-weight: 500;
      color: #1a1a1a;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .section-type {
      font-size: 11px;
      color: #637381;
    }

    .section-actions {
      display: flex;
      align-items: center;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .section-item:hover .section-actions {
      opacity: 1;
    }

    .section-action-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      border-radius: 4px;
      cursor: pointer;
      color: #637381;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-action-btn:hover {
      background: #e1e3e5;
      color: #1a1a1a;
    }

    .section-action-btn.visibility {
      opacity: 1 !important;
    }

    .section-action-btn.visibility.hidden {
      color: #c9cccf;
    }

    /* Center - Preview */
    .preview-container {
      flex: 1;
      background: #e1e3e5;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
      overflow: auto;
    }

    .preview-frame-wrapper {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: width 0.3s ease;
      position: relative;
    }

    .preview-frame-wrapper.desktop {
      width: 100%;
      max-width: 1200px;
    }

    .preview-frame-wrapper.tablet {
      width: 768px;
    }

    .preview-frame-wrapper.mobile {
      width: 375px;
    }

    .preview-iframe {
      width: 100%;
      height: calc(100vh - 160px);
      border: none;
      display: block;
    }

    .preview-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .section-highlight {
      position: absolute;
      border: 2px solid #8b5cf6;
      background: rgba(139, 92, 246, 0.1);
      pointer-events: none;
      transition: all 0.2s;
      border-radius: 4px;
    }

    /* Right Sidebar - Properties */
    .properties-sidebar {
      width: 320px;
      background: #fff;
      border-left: 1px solid #e1e3e5;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .properties-header {
      padding: 16px;
      border-bottom: 1px solid #e1e3e5;
    }

    .properties-title {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
    }

    .properties-subtitle {
      font-size: 12px;
      color: #637381;
    }

    .properties-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .property-section {
      margin-bottom: 24px;
    }

    .property-section-title {
      font-size: 12px;
      font-weight: 600;
      color: #637381;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .property-field {
      margin-bottom: 16px;
    }

    .property-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #1a1a1a;
      margin-bottom: 6px;
    }

    .property-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #c9cccf;
      border-radius: 6px;
      font-size: 13px;
      transition: border-color 0.2s;
    }

    .property-input:focus {
      outline: none;
      border-color: #8b5cf6;
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
    }

    .property-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .property-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: #f9fafb;
      border-radius: 6px;
    }

    .toggle-label {
      font-size: 13px;
      color: #1a1a1a;
    }

    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #c9cccf;
      border-radius: 24px;
      transition: 0.3s;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
    }

    .toggle-switch input:checked + .toggle-slider {
      background: #008060;
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }

    /* Image Upload */
    .image-upload-area {
      border: 2px dashed #c9cccf;
      border-radius: 8px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #f9fafb;
    }

    .image-upload-area:hover {
      border-color: #8b5cf6;
      background: #f4f0ff;
    }

    .image-upload-area.has-image {
      padding: 8px;
      border-style: solid;
    }

    .image-upload-area img {
      max-width: 100%;
      border-radius: 4px;
    }

    .upload-icon {
      width: 48px;
      height: 48px;
      background: #e1e3e5;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      color: #637381;
    }

    .upload-text {
      font-size: 13px;
      color: #637381;
      margin-bottom: 4px;
    }

    .upload-hint {
      font-size: 11px;
      color: #8c9196;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #637381;
    }

    .empty-state-icon {
      width: 64px;
      height: 64px;
      background: #f6f6f7;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 24px;
    }

    .empty-state-title {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 8px;
    }

    .empty-state-text {
      font-size: 13px;
      line-height: 1.5;
    }

    /* Color Picker */
    .color-picker-wrapper {
      display: flex;
      gap: 8px;
    }

    .color-picker-wrapper input[type="color"] {
      width: 48px;
      height: 40px;
      padding: 2px;
      border: 1px solid #c9cccf;
      border-radius: 6px;
      cursor: pointer;
    }

    .color-picker-wrapper input[type="text"] {
      flex: 1;
    }

    /* Add Section Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 12px;
      width: 100%;
      max-width: 600px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e1e3e5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #637381;
    }

    .modal-close:hover {
      background: #f6f6f7;
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .section-templates-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .section-template {
      border: 1px solid #e1e3e5;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .section-template:hover {
      border-color: #8b5cf6;
      background: #f4f0ff;
    }

    .template-icon {
      width: 48px;
      height: 48px;
      background: #f6f6f7;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      color: #637381;
      font-size: 20px;
    }

    .template-name {
      font-size: 14px;
      font-weight: 500;
      color: #1a1a1a;
      margin-bottom: 4px;
    }

    .template-desc {
      font-size: 12px;
      color: #637381;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 3000;
    }

    .toast {
      background: #1a1a1a;
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease;
    }

    .toast.success { background: #008060; }
    .toast.error { background: #d72c0d; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .properties-sidebar {
        width: 280px;
      }
    }

    /* ==========================================
       VISUAL LAYOUT BUILDER STYLES
       ========================================== */
    .preview-mode-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      justify-content: center;
    }

    .preview-mode-btn {
      padding: 10px 20px;
      border: 2px solid #e1e3e5;
      background: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .preview-mode-btn.active {
      border-color: #8b5cf6;
      background: #f4f0ff;
      color: #8b5cf6;
    }

    .preview-mode-btn:hover:not(.active) {
      border-color: #c9cccf;
      background: #f9fafb;
    }

    /* Layout Builder Container */
    .layout-builder {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 24px;
      max-width: 1000px;
      margin: 0 auto;
      min-height: 600px;
    }

    .layout-builder-header {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px dashed #e1e3e5;
    }

    .layout-builder-header h2 {
      margin: 0 0 8px 0;
      font-size: 18px;
      color: #1a1a1a;
    }

    .layout-builder-header p {
      margin: 0;
      font-size: 13px;
      color: #637381;
    }

    /* Two Column Layout */
    .layout-columns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      min-height: 500px;
    }

    .layout-column {
      background: #f9fafb;
      border: 2px dashed #c9cccf;
      border-radius: 12px;
      padding: 16px;
      min-height: 400px;
      transition: all 0.2s;
    }

    .layout-column.drag-over {
      border-color: #8b5cf6;
      background: #f4f0ff;
    }

    .layout-column-full {
      grid-column: 1 / -1;
      min-height: 200px;
      margin-top: 24px;
    }

    .layout-column-header {
      text-align: center;
      padding: 12px;
      margin-bottom: 16px;
      background: #fff;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      color: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .layout-column-header i {
      color: #8b5cf6;
    }

    /* Draggable Elements */
    .layout-element {
      background: #fff;
      border: 2px solid #e1e3e5;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: grab;
      transition: all 0.2s;
      position: relative;
    }

    .layout-element:hover {
      border-color: #8b5cf6;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
    }

    .layout-element.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
      cursor: grabbing;
    }

    .layout-element.selected {
      border-color: #8b5cf6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
    }

    .layout-element-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .layout-element-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #8b5cf6, #6d28d9);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 16px;
    }

    .layout-element-info {
      flex: 1;
    }

    .layout-element-name {
      font-weight: 600;
      font-size: 14px;
      color: #1a1a1a;
      margin-bottom: 2px;
    }

    .layout-element-desc {
      font-size: 12px;
      color: #637381;
    }

    .layout-element-actions {
      display: flex;
      gap: 4px;
    }

    .layout-element-action {
      width: 32px;
      height: 32px;
      border: none;
      background: #f6f6f7;
      border-radius: 6px;
      cursor: pointer;
      color: #637381;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .layout-element-action:hover {
      background: #8b5cf6;
      color: #fff;
    }

    .layout-element-action.delete:hover {
      background: #d72c0d;
    }

    /* Element Preview */
    .layout-element-preview {
      background: #f9fafb;
      border-radius: 6px;
      padding: 12px;
      margin-top: 12px;
      font-size: 12px;
      color: #637381;
    }

    /* Select Shades Preview */
    .select-shades-preview {
      background: linear-gradient(135deg, #f8f6f3, #f0ebe4);
      border: 1px solid #e0d5c7;
      border-radius: 8px;
      padding: 16px;
    }

    .select-shades-preview .btn-preview {
      background: #8E6545;
      color: #fff;
      padding: 12px 24px;
      border-radius: 6px;
      text-align: center;
      font-weight: 500;
      margin-bottom: 12px;
    }

    .select-shades-preview .options-preview {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .select-shades-preview .option-item {
      background: #fff;
      border: 1px solid #e0d5c7;
      border-radius: 6px;
      padding: 10px 12px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Empty Column Placeholder */
    .column-placeholder {
      text-align: center;
      padding: 40px 20px;
      color: #8c9196;
      font-size: 13px;
    }

    .column-placeholder i {
      font-size: 32px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    /* Edit Panel Overlay */
    .edit-panel-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .edit-panel-overlay.active {
      display: flex;
    }

    .edit-panel {
      background: #fff;
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .edit-panel-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e1e3e5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .edit-panel-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .edit-panel-title i {
      color: #8b5cf6;
    }

    .edit-panel-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .edit-panel-footer {
      padding: 16px 24px;
      border-top: 1px solid #e1e3e5;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .edit-panel-btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .edit-panel-btn.cancel {
      background: #f6f6f7;
      border: 1px solid #c9cccf;
      color: #1a1a1a;
    }

    .edit-panel-btn.cancel:hover {
      background: #e1e3e5;
    }

    .edit-panel-btn.save {
      background: #8b5cf6;
      border: none;
      color: #fff;
    }

    .edit-panel-btn.save:hover {
      background: #7c3aed;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="editor-header">
    <div class="editor-header-left">
      <a href="/admin/" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        <span>Exit</span>
      </a>
      <div class="editor-title">
        <i class="fas fa-file-alt"></i>
        <span class="page-name">Product Page</span>
      </div>
    </div>

    <div class="editor-header-center">
      <button class="view-btn active" data-view="desktop" onclick="setPreviewDevice('desktop')">
        <i class="fas fa-desktop"></i>
        Desktop
      </button>
      <button class="view-btn" data-view="tablet" onclick="setPreviewDevice('tablet')">
        <i class="fas fa-tablet-alt"></i>
        Tablet
      </button>
      <button class="view-btn" data-view="mobile" onclick="setPreviewDevice('mobile')">
        <i class="fas fa-mobile-alt"></i>
        Mobile
      </button>
    </div>

    <div class="editor-header-right">
      <span class="save-status" id="saveStatus">
        <i class="fas fa-check-circle"></i>
        Saved
      </span>
      <a href="#" target="_blank" class="preview-link">
        <i class="fas fa-external-link-alt"></i>
        View Page
      </a>
      <button class="save-btn" id="saveBtn" onclick="saveAllChanges()">
        Save
      </button>
    </div>
  </header>

  <!-- Main Layout -->
  <div class="editor-layout">
    <!-- Left Sidebar - Sections -->
    <aside class="sections-sidebar">
      <div class="sidebar-header">
        <span class="sidebar-title">Sections</span>
        <button class="add-section-btn" onclick="openAddSectionModal()" title="Add section">
          <i class="fas fa-plus"></i>
        </button>
      </div>
      <div class="sections-list" id="sectionsList">
        <!-- Sections rendered by JS -->
      </div>
    </aside>

    <!-- Center - Preview -->
    <main class="preview-container">
      <!-- Mode Toggle -->
      <div class="preview-mode-toggle">
        <button class="preview-mode-btn active" data-mode="builder" onclick="setPreviewMode('builder')">
          <i class="fas fa-th-large"></i>
          Layout Builder
        </button>
        <button class="preview-mode-btn" data-mode="preview" onclick="setPreviewMode('preview')">
          <i class="fas fa-eye"></i>
          Live Preview
        </button>
      </div>

      <!-- Layout Builder (Drag & Drop) -->
      <div class="layout-builder" id="layoutBuilder">
        <div class="layout-builder-header">
          <h2><i class="fas fa-arrows-alt"></i> Drag & Drop Layout Builder</h2>
          <p>Drag elements between columns to position them. Click Edit to customize each element.</p>
        </div>

        <div class="layout-columns">
          <!-- Left Column (Gallery Side) -->
          <div class="layout-column" id="leftColumn" data-column="left"
               ondragover="handleColumnDragOver(event)" ondragleave="handleColumnDragLeave(event)" ondrop="handleColumnDrop(event, 'left')">
            <div class="layout-column-header">
              <i class="fas fa-images"></i>
              Left Column (Gallery Side)
            </div>
            <div class="column-elements" id="leftColumnElements">
              <!-- Elements will be rendered here -->
            </div>
          </div>

          <!-- Right Column (Configurator Side) -->
          <div class="layout-column" id="rightColumn" data-column="right"
               ondragover="handleColumnDragOver(event)" ondragleave="handleColumnDragLeave(event)" ondrop="handleColumnDrop(event, 'right')">
            <div class="layout-column-header">
              <i class="fas fa-sliders-h"></i>
              Right Column (Configurator Side)
            </div>
            <div class="column-elements" id="rightColumnElements">
              <!-- Elements will be rendered here -->
            </div>
          </div>
        </div>

        <!-- Bottom Section (Full Width - Product Details, FAQs, etc.) -->
        <div class="layout-column layout-column-full" id="bottomColumn" data-column="bottom"
             ondragover="handleColumnDragOver(event)" ondragleave="handleColumnDragLeave(event)" ondrop="handleColumnDrop(event, 'bottom')">
          <div class="layout-column-header">
            <i class="fas fa-layer-group"></i>
            Bottom Section (Product Details, Catalogs, FAQs, Related Products)
          </div>
          <div class="column-elements" id="bottomColumnElements">
            <!-- Bottom elements will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Live Preview (iframe) -->
      <div class="preview-frame-wrapper desktop" id="previewFrame" style="display: none;">
        <iframe
          src=""
          class="preview-iframe"
          id="previewIframe"
          onload="onPreviewLoad()">
        </iframe>
      </div>
    </main>

    <!-- Right Sidebar - Properties -->
    <aside class="properties-sidebar">
      <div class="properties-header">
        <div class="properties-title" id="propertiesTitle">Page Settings</div>
        <div class="properties-subtitle" id="propertiesSubtitle">Edit your product page</div>
      </div>
      <div class="properties-content" id="propertiesContent">
        <!-- Properties rendered by JS -->
      </div>
    </aside>
  </div>

  <!-- Add Section Modal -->
  <div class="modal-overlay" id="addSectionModal">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">Add Section</span>
        <button class="modal-close" onclick="closeAddSectionModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="section-templates-grid" id="sectionTemplates">
          <!-- Templates rendered by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Element Panel -->
  <div class="edit-panel-overlay" id="editPanelOverlay" onclick="closeEditPanel(event)">
    <div class="edit-panel" onclick="event.stopPropagation()">
      <div class="edit-panel-header">
        <div class="edit-panel-title" id="editPanelTitle">
          <i class="fas fa-edit"></i>
          Edit Element
        </div>
        <button class="modal-close" onclick="closeEditPanel()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="edit-panel-body" id="editPanelBody">
        <!-- Edit form will be rendered here -->
      </div>
      <div class="edit-panel-footer">
        <button class="edit-panel-btn cancel" onclick="closeEditPanel()">Cancel</button>
        <button class="edit-panel-btn save" onclick="saveElementChanges()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="js/admin.js"></script>
  <script>
    // Get product slug from URL parameters
    function getProductSlug() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('slug') || 'affordable-custom-roller-blinds';
    }

    // Page State
    let pageData = {
      slug: getProductSlug(),
      sections: [],
      layout: {
        galleryPosition: 'left',      // 'left' or 'right'
        configuratorStyle: 'dropdown', // 'dropdown', 'expanded', 'sidebar'
        showBreadcrumbs: true,
        stickyConfigurator: true,
        mobileLayout: 'stacked'       // 'stacked' or 'tabbed'
      },
      styles: {
        // Page Background
        pageBackground: '#F6F1EB',

        // Typography
        titleFont: 'Cormorant Garamond',
        titleSize: '28px',
        titleColor: '#8E6545',
        titleWeight: '600',

        bodyFont: 'Montserrat',
        bodySize: '14px',
        bodyColor: '#666666',

        // Price Styling
        priceSize: '32px',
        priceColor: '#8E6545',
        priceWeight: '700',

        // Button Styling
        buttonBackground: '#8E6545',
        buttonColor: '#FFFFFF',
        buttonBorderRadius: '6px',
        buttonPadding: '12px 24px',

        // Select Shades Dropdown
        selectShadesBackground: '#FFFFFF',
        selectShadesBorder: '1px solid #E0D5C7',
        selectShadesBorderRadius: '8px',

        // Configurator Options
        optionBackground: '#FFFFFF',
        optionBorder: '1px solid #E0D5C7',
        optionBorderRadius: '8px',
        optionPadding: '20px',

        // Gallery
        galleryWidth: '500px',
        galleryBorderRadius: '12px',

        // Spacing
        sectionSpacing: '24px',
        elementSpacing: '16px'
      }
    };
    let selectedSectionId = null;
    let hasUnsavedChanges = false;
    let draggedSection = null;
    let currentPreviewMode = 'builder';
    let draggedElement = null;
    let editingElement = null;

    // Layout Elements Definition - Complete list matching live product page
    const layoutElements = [
      // ===== LEFT COLUMN - Product Images =====
      {
        id: 'gallery',
        name: 'Product Gallery',
        description: 'Main product images - Click Edit to upload',
        icon: 'fa-images',
        column: 'left',
        order: 1,
        fixed: false,
        settings: {
          images: []
        }
      },

      // ===== RIGHT COLUMN - Configurator Section =====
      {
        id: 'selectShades',
        name: 'Select Your Shades',
        description: 'Main dropdown button with configurator options',
        icon: 'fa-hand-pointer',
        column: 'right',
        order: 1,
        settings: {
          buttonText: 'Select your shades',
          buttonColor: '#8E6545',
          buttonTextColor: '#FFFFFF',
          expanded: false,
          showOptions: ['dimensions', 'roomLabel', 'shadeStyle']
        }
      },
      {
        id: 'productTitle',
        name: 'Product Title',
        description: 'Product name and description',
        icon: 'fa-heading',
        column: 'right',
        order: 2,
        settings: {
          title: 'Affordable Custom Roller Blinds & Shades',
          description: 'Discover our selection of premium roller blinds'
        }
      },
      {
        id: 'price',
        name: 'Price Display',
        description: 'Product price and calculation',
        icon: 'fa-dollar-sign',
        column: 'right',
        order: 3,
        settings: {
          showOriginalPrice: true,
          showDiscount: true,
          currency: 'USD'
        }
      },
      {
        id: 'features',
        name: 'Feature Badges',
        description: 'Product feature highlights',
        icon: 'fa-check-circle',
        column: 'right',
        order: 4,
        settings: {
          badges: ['Energy Efficient', 'Custom Sizes', 'Easy Install']
        }
      },
      {
        id: 'trustBadges',
        name: 'Trust Badges',
        description: 'Warranty, shipping, returns info',
        icon: 'fa-shield-alt',
        column: 'right',
        order: 5,
        settings: {
          showShipping: true,
          showWarranty: true,
          showReturns: true
        }
      },
      // ===== CONFIGURATOR OPTIONS - Individual Elements =====
      {
        id: 'dimensions',
        name: 'Dimensions (Width & Height)',
        description: 'Width and Height input fields',
        icon: 'fa-ruler-combined',
        column: 'right',
        order: 6,
        settings: {
          sectionTitle: 'Dimensions',
          widthLabel: 'Width',
          heightLabel: 'Height',
          unit: 'inches',
          minWidth: 12,
          maxWidth: 96,
          minHeight: 12,
          maxHeight: 120,
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          labelFontFamily: 'inherit',
          labelFontSize: '13px',
          labelColor: '#666666',
          inputBgColor: '#ffffff',
          inputBorderColor: '#E8E4E0',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'roomLabel',
        name: 'Room Label',
        description: 'Room name/label input field',
        icon: 'fa-tag',
        column: 'right',
        order: 7,
        settings: {
          sectionTitle: 'Room Label',
          placeholder: 'e.g., Living Room, Bedroom',
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          inputFontSize: '14px',
          inputBgColor: '#ffffff',
          inputBorderColor: '#E8E4E0',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'shadeStyle',
        name: 'Shade Style Options',
        description: 'Shade style selection with prices',
        icon: 'fa-palette',
        column: 'right',
        order: 8,
        settings: {
          sectionTitle: 'Shade Style',
          options: [
            { name: 'Light Filtering', price: 0 },
            { name: 'Room Darkening', price: 15 },
            { name: 'Blackout', price: 25 }
          ],
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          optionFontFamily: 'inherit',
          optionFontSize: '13px',
          optionColor: '#333333',
          optionBgColor: '#ffffff',
          optionBorderColor: '#E8E4E0',
          optionHoverBgColor: '#f5f5f5',
          selectedBgColor: '#8E6545',
          selectedTextColor: '#ffffff',
          priceFontSize: '12px',
          priceColor: '#8E6545',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'mountType',
        name: 'Mount Type Options',
        description: 'Inside/Outside mount selection',
        icon: 'fa-expand-arrows-alt',
        column: 'right',
        order: 9,
        settings: {
          sectionTitle: 'Mount Type',
          options: [
            { name: 'Inside Mount', description: 'Fits inside window frame' },
            { name: 'Outside Mount', description: 'Mounts on wall above window' }
          ],
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          optionFontFamily: 'inherit',
          optionFontSize: '13px',
          optionColor: '#333333',
          descriptionFontSize: '11px',
          descriptionColor: '#888888',
          optionBgColor: '#ffffff',
          optionBorderColor: '#E8E4E0',
          selectedBgColor: '#8E6545',
          selectedTextColor: '#ffffff',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'controlType',
        name: 'Control Type Options',
        description: 'Manual/Cordless/Motorized control options',
        icon: 'fa-cogs',
        column: 'right',
        order: 10,
        settings: {
          sectionTitle: 'Control Type',
          options: [
            { name: 'Bead Chain (Manual)', price: 0 },
            { name: 'Cordless', price: 20 },
            { name: 'Motorized', price: 75 }
          ],
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          optionFontFamily: 'inherit',
          optionFontSize: '13px',
          optionColor: '#333333',
          optionBgColor: '#ffffff',
          optionBorderColor: '#E8E4E0',
          selectedBgColor: '#8E6545',
          selectedTextColor: '#ffffff',
          priceFontSize: '12px',
          priceColor: '#8E6545',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'hardwareType',
        name: 'Hardware Type Options',
        description: 'Hardware/valance selection',
        icon: 'fa-tools',
        column: 'right',
        order: 11,
        settings: {
          sectionTitle: 'Hardware Type',
          options: [
            { name: 'Standard Valance', price: 0 },
            { name: 'Fabric Wrapped', price: 15 },
            { name: 'No Valance', price: -5 }
          ],
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          optionFontFamily: 'inherit',
          optionFontSize: '13px',
          optionColor: '#333333',
          optionBgColor: '#ffffff',
          optionBorderColor: '#E8E4E0',
          selectedBgColor: '#8E6545',
          selectedTextColor: '#ffffff',
          priceFontSize: '12px',
          priceColor: '#8E6545',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'accessories',
        name: 'Accessories Options',
        description: 'Additional accessories and add-ons',
        icon: 'fa-puzzle-piece',
        column: 'right',
        order: 12,
        settings: {
          sectionTitle: 'Accessories',
          options: [
            { name: 'Hold Down Brackets', price: 5 },
            { name: 'Extension Brackets', price: 8 },
            { name: 'Cord Tensioner', price: 3 }
          ],
          multiSelect: true,
          // Typography & Styling
          titleFontFamily: 'inherit',
          titleFontSize: '14px',
          titleFontWeight: '600',
          titleColor: '#333333',
          optionFontFamily: 'inherit',
          optionFontSize: '13px',
          optionColor: '#333333',
          optionBgColor: '#ffffff',
          optionBorderColor: '#E8E4E0',
          checkboxColor: '#8E6545',
          priceFontSize: '12px',
          priceColor: '#8E6545',
          sectionBgColor: 'transparent'
        }
      },
      {
        id: 'addToCart',
        name: 'Add to Cart Button',
        description: 'Main purchase button',
        icon: 'fa-shopping-cart',
        column: 'right',
        order: 13,
        settings: {
          buttonText: 'Add to Cart',
          buttonColor: '#8E6545',
          buttonTextColor: '#FFFFFF'
        }
      },
      {
        id: 'requestQuote',
        name: 'Request for Quote',
        description: 'Request a custom quote button',
        icon: 'fa-file-invoice',
        column: 'right',
        order: 14,
        settings: {
          buttonText: 'Request for Quote',
          buttonColor: '#4A5568',
          buttonTextColor: '#FFFFFF',
          showIcon: true
        }
      },
      {
        id: 'buyWithShopPay',
        name: 'Buy with Shop Pay',
        description: 'Express checkout with Shop Pay',
        icon: 'fa-credit-card',
        column: 'right',
        order: 15,
        settings: {
          enabled: true,
          showApplePay: true,
          showGooglePay: true,
          showPayPal: true
        }
      },
      {
        id: 'quantity',
        name: 'Quantity Selector',
        description: 'Select product quantity',
        icon: 'fa-sort-numeric-up',
        column: 'right',
        order: 16,
        settings: {
          minQuantity: 1,
          maxQuantity: 100,
          defaultQuantity: 1
        }
      },
      {
        id: 'deliveryInfo',
        name: 'Delivery Information',
        description: 'Shipping and delivery details',
        icon: 'fa-truck',
        column: 'right',
        order: 17,
        settings: {
          showEstimate: true,
          showFreeShipping: true,
          estimateText: 'Estimated delivery: 5-7 business days',
          freeShippingText: 'Free shipping on orders over $99'
        }
      },

      // ===== BOTTOM SECTIONS - Product Details Area =====
      {
        id: 'productDetails',
        name: 'Product Details',
        description: 'Features, Care Instructions, Warranty',
        icon: 'fa-info-circle',
        column: 'bottom',
        order: 1,
        settings: {
          sectionTitle: 'Product Details',
          featuresTitle: 'Features',
          features: [
            'Custom-made to your exact measurements',
            'Premium quality materials',
            'Easy to install with included hardware',
            'Child-safe cordless options available',
            'Energy efficient design'
          ],
          careTitle: 'Care Instructions',
          careText: 'Dust regularly with a soft cloth or vacuum with brush attachment. Spot clean with mild soap and water. Do not machine wash or dry clean.',
          warrantyTitle: 'Warranty',
          warrantyText: 'All products come with a standard 1-year warranty. Extended 3-year warranty available at checkout.'
        }
      },
      {
        id: 'productCatalogs',
        name: 'Product Catalogs',
        description: 'Valance Options, Bottom Rail, Control Systems, Configuration',
        icon: 'fa-book-open',
        column: 'bottom',
        order: 2,
        settings: {
          sectionTitle: 'Product Catalogs',
          productFeaturesTitle: 'Product Features',
          productFeaturesText: 'The eco-friendly and durable fabric is made into a variety of shading effects: transparent, semi-blackout, and full blackout, with unique design and functions of insulation, dust-proof, shading and light filtering, which is becoming a new favorite in home decoration.',
          valanceTitle: 'Available Valance Options',
          valanceOptions: [
            { name: 'Fabric Wrapped SA', desc: 'Square design with exclusive controller' },
            { name: 'Square V1', desc: 'Exclusive controller with mount code' },
            { name: 'Square V2', desc: 'Standard square valance' },
            { name: 'Fabric Wrapped V3', desc: 'Premium fabric wrapped finish' },
            { name: 'Fabric Inserted S1', desc: 'Curved white design' },
            { name: 'Curve White S2', desc: 'Minimalist curved design' },
            { name: 'Fabric Wrapped S3', desc: 'Burliness finish option' }
          ],
          sideCoverColors: 'White, Gray, Black',
          bottomRailTitle: 'Bottom Rail Options',
          bottomRailOptions: [
            { name: 'Type A', desc: 'Streamlined water-drop design' },
            { name: 'Beam Simple Rolling', desc: 'Clean minimalist beam' },
            { name: 'Fabric Inserted Z1', desc: 'Day & night blinds compatible' },
            { name: 'End Cap Free Z2', desc: 'Day & night blinds compatible' },
            { name: 'Fabric Wrapped Z3', desc: 'Available in White, Brown, Black' }
          ],
          controlSystemsTitle: 'Control Systems',
          controlSystems: [
            { name: 'Bead Chain', desc: 'Plastic or metal options' },
            { name: 'Cordless', desc: 'Child-safe operation' },
            { name: 'Bead Chain with Wand', desc: '2 in 1 control system' },
            { name: 'Retractable Wand', desc: 'Space-saving design' },
            { name: 'Motorized (APP)', desc: 'Smart home compatible' },
            { name: 'Cordless-Motorized', desc: 'Premium automation' }
          ],
          configFeaturesTitle: 'Configuration Features',
          configFeatures: [
            { name: 'Rectangular', desc: 'Standard window shape' },
            { name: 'Sloping Cill', desc: 'Fabric cut at an angle (Note: blind cannot be fully retracted)' },
            { name: 'Multiple Linked', desc: 'Single motor operates two or more blinds' },
            { name: 'Forward Roll', desc: 'Fabric rolls off the back, closest to glazing' },
            { name: 'Reverse Roll', desc: 'Fabric rolls off the front, extra clearance for window handles' }
          ],
          lightBlockerTitle: 'Light Blocker Options',
          lightBlockerOptions: [
            { name: 'Aluminium U Shape', desc: 'White, Gray, Black' },
            { name: 'Adhesive L Shape', desc: 'White, Beige, Grey, Black' }
          ]
        }
      },
      {
        id: 'productTypeSpecs',
        name: 'Product Type Specifications',
        description: 'Specifications table with product types',
        icon: 'fa-table',
        column: 'bottom',
        order: 3,
        settings: {
          sectionTitle: 'Product Type Specifications',
          tableHeaders: ['Type', 'Products', 'Control System', 'Width', 'Light Gap', 'Installation'],
          tableRows: [
            ['Simple', 'Roller Blinds, Shangri-la Blinds', 'Bead Chain Manual', '0.3~1.5m', '~3.3cm', 'Most walls'],
            ['Curved Plus', 'Roller Blinds, Zebra Blinds, Shangri-la Blinds', 'Bead Chain Manual', '0.3~1.8m', '~4.5cm', 'All walls']
          ]
        }
      },
      {
        id: 'sizeChart',
        name: 'Customizable Size Chart',
        description: 'Size specifications table',
        icon: 'fa-ruler-combined',
        column: 'bottom',
        order: 4,
        settings: {
          sectionTitle: 'Customizable Size Chart',
          tableHeaders: ['Valance Type', 'Width (cm)', 'Height (cm)', 'Fabric Deduction'],
          tableRows: [
            ['Simple Rolling (Bead Chain)', '50-230', '50-300', '-2.7cm'],
            ['Simple Rolling (Cordless 38 tube)', '30-230', '50-250', '-2.7cm'],
            ['Curved Plus (Bead Chain)', '50-230', '50-430', '-2.5cm'],
            ['S1 Fabric Inserted', '50-230', '50-260', '-2.5cm'],
            ['V2 Square Valance', '50-230', '50-320', '-2.3cm'],
            ['S2/S3 Curved Fabric Wrapped', '50-230', '50-350', '-2.8cm'],
            ['Z1 Day & Night Valance', '50-230', '50-260', '-2.3cm'],
            ['Z2 Square Day & Night', '50-230', '50-320', '-3.3cm'],
            ['Z3 Day & Night Valance', '50-230', '50-250', '-2.3cm']
          ],
          noteText: 'Max height limits are tested with thicker fabric. Thinner fabric allows for greater height. The minimum width for AM28 motorized is 65cm.'
        }
      },
      {
        id: 'faqSection',
        name: 'FAQ Section',
        description: 'Frequently Asked Questions',
        icon: 'fa-question-circle',
        column: 'bottom',
        order: 5,
        settings: {
          sectionTitle: 'Frequently Asked Questions (FAQ)',
          subtitle: 'We have answers to all your Questions',
          faqs: [
            {
              question: 'How do I measure my window for the right fit?',
              answer: 'Measure the width and height of your window opening in inches. For inside mount, measure the exact opening. For outside mount, add 2-3 inches on each side for optimal coverage and light blockage. We recommend measuring at three points and using the smallest measurement for inside mount.'
            },
            {
              question: 'Are the blinds easy to install?',
              answer: 'Yes! All our blinds come with easy-to-follow installation instructions and mounting hardware. Most customers complete installation in 15-30 minutes per window.'
            },
            {
              question: 'What is your return policy?',
              answer: 'We offer a 30-day satisfaction guarantee on all products. If you\'re not completely satisfied, you can return unused items in original packaging for a full refund.'
            }
          ]
        }
      },
      {
        id: 'exploreTrends',
        name: 'Explore Latest Trends',
        description: 'Related products section',
        icon: 'fa-th-large',
        column: 'bottom',
        order: 6,
        settings: {
          sectionTitle: 'Explore Latest Trends',
          subtitle: 'You May Also Like',
          showProducts: true,
          maxProducts: 4
        }
      },

      // ===== LEGACY ELEMENTS FOR COMPATIBILITY =====
      {
        id: 'reviews',
        name: 'Customer Reviews',
        description: 'Product ratings and reviews',
        icon: 'fa-star',
        column: 'bottom',
        order: 7,
        settings: {
          showRating: true,
          showCount: true
        }
      }
    ];

    // Update preview links with current slug
    function updatePreviewLinks() {
      const slug = pageData.slug;
      const previewLink = document.querySelector('.preview-link');
      const previewIframe = document.getElementById('previewIframe');
      const editorTitle = document.querySelector('.editor-title .page-name');

      if (previewLink) previewLink.href = `/product/${slug}`;
      if (previewIframe) previewIframe.src = `/product/${slug}?preview=true`;
      if (editorTitle) editorTitle.textContent = slug;
    }

    // Section Templates
    const sectionTemplates = [
      {
        type: 'hero',
        name: 'Hero Banner',
        description: 'Large banner with image and text',
        icon: 'fa-image',
        defaultData: {
          title: 'Hero Section',
          subtitle: 'Add your headline here',
          backgroundImage: '',
          buttonText: 'Shop Now',
          buttonLink: '#'
        }
      },
      {
        type: 'product-title',
        name: 'Product Title',
        description: 'Product name and description',
        icon: 'fa-heading',
        defaultData: {
          title: 'Product Name',
          description: 'Product description goes here'
        }
      },
      {
        type: 'image-gallery',
        name: 'Image Gallery',
        description: 'Product image gallery',
        icon: 'fa-images',
        defaultData: {
          images: []
        }
      },
      {
        type: 'features',
        name: 'Features',
        description: 'List of product features',
        icon: 'fa-list-check',
        defaultData: {
          title: 'Features',
          items: [
            { icon: 'fa-check', text: 'Feature 1' },
            { icon: 'fa-check', text: 'Feature 2' },
            { icon: 'fa-check', text: 'Feature 3' }
          ]
        }
      },
      {
        type: 'trust-badges',
        name: 'Trust Badges',
        description: 'Trust and guarantee badges',
        icon: 'fa-shield-halved',
        defaultData: {
          items: [
            { icon: 'fa-truck', text: 'Free Shipping' },
            { icon: 'fa-shield-alt', text: '5 Year Warranty' },
            { icon: 'fa-undo', text: 'Easy Returns' }
          ]
        }
      },
      {
        type: 'text-block',
        name: 'Text Block',
        description: 'Rich text content area',
        icon: 'fa-align-left',
        defaultData: {
          content: 'Add your content here...'
        }
      },
      {
        type: 'cta-banner',
        name: 'CTA Banner',
        description: 'Call-to-action banner',
        icon: 'fa-bullhorn',
        defaultData: {
          title: 'Ready to Order?',
          subtitle: 'Get your custom blinds today',
          buttonText: 'Get Started',
          buttonLink: '#',
          backgroundColor: '#8E6545'
        }
      },
      {
        type: 'faq',
        name: 'FAQ Section',
        description: 'Frequently asked questions',
        icon: 'fa-circle-question',
        defaultData: {
          title: 'Frequently Asked Questions',
          items: [
            { question: 'Question 1?', answer: 'Answer 1' },
            { question: 'Question 2?', answer: 'Answer 2' }
          ]
        }
      }
    ];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      Admin.Auth.requireAuth();
      loadPageData();
      renderSectionTemplates();
      setupKeyboardShortcuts();
      // Note: renderLayoutBuilder is now called from loadPageData after data is loaded
    });

    // Load page data
    async function loadPageData() {
      try {
        updatePreviewLinks();
        const response = await Admin.API.get(`/product-page-sections/${pageData.slug}`);
        if (response.success && response.sections) {
          pageData.sections = response.sections;
        } else {
          // Load default sections if none exist
          pageData.sections = getDefaultSections();
        }
        // Load layout settings if they exist
        if (response.layout) {
          pageData.layout = { ...pageData.layout, ...response.layout };
        }
        // Load CSS styles if they exist
        if (response.styles) {
          pageData.styles = { ...pageData.styles, ...response.styles };
        }
        renderSectionsList();
        renderDefaultProperties();
        // Render layout builder after data is loaded so deleted states are preserved
        renderLayoutBuilder();
      } catch (error) {
        console.error('Failed to load page data:', error);
        pageData.sections = getDefaultSections();
        renderSectionsList();
        renderDefaultProperties();
        // Still render layout builder even on error
        renderLayoutBuilder();
      }
    }

    // Get default sections for a new page
    function getDefaultSections() {
      return [
        {
          id: 'section-' + Date.now() + '-1',
          type: 'product-title',
          name: 'Product Title',
          isVisible: true,
          data: {
            title: 'Affordable Custom Roller Blinds & shades',
            description: 'Discover our selection! Roller blinds offer a clean and sleek line that complements any home style.'
          }
        },
        {
          id: 'section-' + Date.now() + '-2',
          type: 'image-gallery',
          name: 'Product Gallery',
          isVisible: true,
          data: {
            images: []
          }
        },
        {
          id: 'section-' + Date.now() + '-3',
          type: 'features',
          name: 'Product Features',
          isVisible: true,
          data: {
            title: 'Features',
            items: [
              { icon: 'fa-check', text: 'Energy Efficient' },
              { icon: 'fa-check', text: 'Custom Sizes' },
              { icon: 'fa-check', text: 'Easy Installation' }
            ]
          }
        },
        {
          id: 'section-' + Date.now() + '-4',
          type: 'trust-badges',
          name: 'Trust Badges',
          isVisible: true,
          data: {
            items: [
              { icon: 'fa-truck', text: 'Free Shipping' },
              { icon: 'fa-shield-alt', text: '5 Year Warranty' },
              { icon: 'fa-undo', text: 'Easy Returns' }
            ]
          }
        }
      ];
    }

    // Render sections list
    function renderSectionsList() {
      const container = document.getElementById('sectionsList');

      if (pageData.sections.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-layer-group"></i></div>
            <div class="empty-state-title">No sections yet</div>
            <div class="empty-state-text">Click the + button to add your first section</div>
          </div>
        `;
        return;
      }

      container.innerHTML = pageData.sections.map(section => {
        const template = sectionTemplates.find(t => t.type === section.type) || {};
        return `
          <div class="section-item ${selectedSectionId === section.id ? 'active' : ''} ${!section.isVisible ? 'hidden-section' : ''}"
               data-id="${section.id}"
               draggable="true"
               onclick="selectSection('${section.id}')"
               ondragstart="handleDragStart(event, '${section.id}')"
               ondragover="handleDragOver(event)"
               ondrop="handleDrop(event, '${section.id}')"
               ondragend="handleDragEnd(event)">
            <div class="section-icon">
              <i class="fas ${template.icon || 'fa-square'}"></i>
            </div>
            <div class="section-details">
              <div class="section-name">${escapeHtml(section.name)}</div>
              <div class="section-type">${template.name || section.type}</div>
            </div>
            <div class="section-actions">
              <button class="section-action-btn visibility ${!section.isVisible ? 'hidden' : ''}"
                      onclick="event.stopPropagation(); toggleSectionVisibility('${section.id}')"
                      title="${section.isVisible ? 'Hide' : 'Show'}">
                <i class="fas ${section.isVisible ? 'fa-eye' : 'fa-eye-slash'}"></i>
              </button>
              <button class="section-action-btn"
                      onclick="event.stopPropagation(); duplicateSection('${section.id}')"
                      title="Duplicate">
                <i class="fas fa-copy"></i>
              </button>
              <button class="section-action-btn"
                      onclick="event.stopPropagation(); deleteSection('${section.id}')"
                      title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Section selection
    function selectSection(sectionId) {
      selectedSectionId = sectionId;
      renderSectionsList();
      renderSectionProperties(sectionId);
      highlightSectionInPreview(sectionId);
    }

    // Render section properties
    function renderSectionProperties(sectionId) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (!section) return;

      const template = sectionTemplates.find(t => t.type === section.type);

      document.getElementById('propertiesTitle').textContent = section.name;
      document.getElementById('propertiesSubtitle').textContent = template?.name || section.type;

      const container = document.getElementById('propertiesContent');
      let html = '';

      // Section name
      html += `
        <div class="property-section">
          <div class="property-section-title">Section Settings</div>
          <div class="property-field">
            <label class="property-label">Section Name</label>
            <input type="text" class="property-input" value="${escapeHtml(section.name)}"
                   onchange="updateSectionName('${section.id}', this.value)">
          </div>
          <div class="property-toggle">
            <span class="toggle-label">Visible on page</span>
            <label class="toggle-switch">
              <input type="checkbox" ${section.isVisible ? 'checked' : ''}
                     onchange="toggleSectionVisibility('${section.id}')">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      `;

      // Type-specific properties
      html += '<div class="property-section">';
      html += '<div class="property-section-title">Content</div>';

      switch (section.type) {
        case 'product-title':
          html += `
            <div class="property-field">
              <label class="property-label">Title</label>
              <input type="text" class="property-input" value="${escapeHtml(section.data?.title || '')}"
                     onchange="updateSectionData('${section.id}', 'title', this.value)">
            </div>
            <div class="property-field">
              <label class="property-label">Description</label>
              <textarea class="property-input property-textarea"
                        onchange="updateSectionData('${section.id}', 'description', this.value)">${escapeHtml(section.data?.description || '')}</textarea>
            </div>
          `;
          break;

        case 'image-gallery':
          html += `
            <div class="property-field">
              <label class="property-label">Main Image</label>
              <div class="image-upload-area ${section.data?.mainImage ? 'has-image' : ''}"
                   onclick="uploadImage('${section.id}', 'mainImage')">
                ${section.data?.mainImage
                  ? `<img src="${section.data.mainImage}" alt="Main image">`
                  : `<div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                     <div class="upload-text">Click to upload</div>
                     <div class="upload-hint">JPG, PNG up to 5MB</div>`
                }
              </div>
            </div>
            <div class="property-field">
              <label class="property-label">Gallery Images</label>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                ${[0,1,2,3].map(i => `
                  <div class="image-upload-area ${section.data?.images?.[i] ? 'has-image' : ''}"
                       style="padding: 12px; min-height: 80px;"
                       onclick="uploadGalleryImage('${section.id}', ${i})">
                    ${section.data?.images?.[i]
                      ? `<img src="${section.data.images[i]}" alt="Gallery ${i+1}">`
                      : `<i class="fas fa-plus" style="color: #ccc;"></i>`
                    }
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          break;

        case 'features':
          html += `
            <div class="property-field">
              <label class="property-label">Section Title</label>
              <input type="text" class="property-input" value="${escapeHtml(section.data?.title || '')}"
                     onchange="updateSectionData('${section.id}', 'title', this.value)">
            </div>
            <div class="property-field">
              <label class="property-label">Feature Items</label>
              <div id="featureItems-${section.id}">
                ${(section.data?.items || []).map((item, i) => `
                  <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <input type="text" class="property-input" style="flex: 1;"
                           value="${escapeHtml(item.text)}"
                           placeholder="Feature text"
                           onchange="updateFeatureItem('${section.id}', ${i}, this.value)">
                    <button class="section-action-btn" onclick="removeFeatureItem('${section.id}', ${i})">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                `).join('')}
              </div>
              <button class="add-section-btn" style="width: 100%; margin-top: 8px;"
                      onclick="addFeatureItem('${section.id}')">
                <i class="fas fa-plus"></i> Add Feature
              </button>
            </div>
          `;
          break;

        case 'trust-badges':
          html += `
            <div class="property-field">
              <label class="property-label">Trust Badges</label>
              <div id="trustBadges-${section.id}">
                ${(section.data?.items || []).map((item, i) => `
                  <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
                    <select class="property-input" style="width: 100px;"
                            onchange="updateTrustBadge('${section.id}', ${i}, 'icon', this.value)">
                      <option value="fa-truck" ${item.icon === 'fa-truck' ? 'selected' : ''}>Truck</option>
                      <option value="fa-shield-alt" ${item.icon === 'fa-shield-alt' ? 'selected' : ''}>Shield</option>
                      <option value="fa-undo" ${item.icon === 'fa-undo' ? 'selected' : ''}>Return</option>
                      <option value="fa-check" ${item.icon === 'fa-check' ? 'selected' : ''}>Check</option>
                      <option value="fa-star" ${item.icon === 'fa-star' ? 'selected' : ''}>Star</option>
                      <option value="fa-heart" ${item.icon === 'fa-heart' ? 'selected' : ''}>Heart</option>
                    </select>
                    <input type="text" class="property-input" style="flex: 1;"
                           value="${escapeHtml(item.text)}"
                           onchange="updateTrustBadge('${section.id}', ${i}, 'text', this.value)">
                    <button class="section-action-btn" onclick="removeTrustBadge('${section.id}', ${i})">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                `).join('')}
              </div>
              <button class="add-section-btn" style="width: 100%; margin-top: 8px;"
                      onclick="addTrustBadge('${section.id}')">
                <i class="fas fa-plus"></i> Add Badge
              </button>
            </div>
          `;
          break;

        case 'text-block':
          html += `
            <div class="property-field">
              <label class="property-label">Content</label>
              <textarea class="property-input property-textarea" style="min-height: 200px;"
                        onchange="updateSectionData('${section.id}', 'content', this.value)">${escapeHtml(section.data?.content || '')}</textarea>
            </div>
          `;
          break;

        case 'cta-banner':
          html += `
            <div class="property-field">
              <label class="property-label">Title</label>
              <input type="text" class="property-input" value="${escapeHtml(section.data?.title || '')}"
                     onchange="updateSectionData('${section.id}', 'title', this.value)">
            </div>
            <div class="property-field">
              <label class="property-label">Subtitle</label>
              <input type="text" class="property-input" value="${escapeHtml(section.data?.subtitle || '')}"
                     onchange="updateSectionData('${section.id}', 'subtitle', this.value)">
            </div>
            <div class="property-field">
              <label class="property-label">Button Text</label>
              <input type="text" class="property-input" value="${escapeHtml(section.data?.buttonText || '')}"
                     onchange="updateSectionData('${section.id}', 'buttonText', this.value)">
            </div>
            <div class="property-field">
              <label class="property-label">Button Link</label>
              <input type="text" class="property-input" value="${escapeHtml(section.data?.buttonLink || '')}"
                     onchange="updateSectionData('${section.id}', 'buttonLink', this.value)">
            </div>
            <div class="property-field">
              <label class="property-label">Background Color</label>
              <div class="color-picker-wrapper">
                <input type="color" value="${section.data?.backgroundColor || '#8E6545'}"
                       onchange="updateSectionData('${section.id}', 'backgroundColor', this.value)">
                <input type="text" class="property-input" value="${section.data?.backgroundColor || '#8E6545'}"
                       onchange="updateSectionData('${section.id}', 'backgroundColor', this.value)">
              </div>
            </div>
          `;
          break;

        default:
          html += '<p style="color: #637381; font-size: 13px;">No editable properties for this section type.</p>';
      }

      html += '</div>';
      container.innerHTML = html;
    }

    // Render default properties (no section selected)
    function renderDefaultProperties() {
      document.getElementById('propertiesTitle').textContent = 'Page Layout';
      document.getElementById('propertiesSubtitle').textContent = 'Configure the overall page structure';

      // Ensure elementPositions defaults
      if (!pageData.layout.elementPositions) {
        pageData.layout.elementPositions = {
          selectShades: { align: 'left', order: 1 },
          productTitle: { align: 'left', order: 2 },
          price: { align: 'left', order: 3 },
          features: { align: 'left', order: 4 },
          trustBadges: { align: 'left', order: 5 },
          configurator: { align: 'left', order: 6 }
        };
      }
      const positions = pageData.layout.elementPositions;

      const container = document.getElementById('propertiesContent');
      container.innerHTML = `
        <!-- Layout Settings -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-columns" style="margin-right: 6px;"></i>
            Main Layout
          </div>

          <div class="property-field">
            <label class="property-label">Gallery Position</label>
            <select class="property-input" onchange="updateLayout('galleryPosition', this.value)">
              <option value="left" ${pageData.layout.galleryPosition === 'left' ? 'selected' : ''}>Left Side (Gallery Left, Configurator Right)</option>
              <option value="right" ${pageData.layout.galleryPosition === 'right' ? 'selected' : ''}>Right Side (Gallery Right, Configurator Left)</option>
            </select>
            <div style="font-size: 11px; color: #637381; margin-top: 4px;">
              <strong>Left Side</strong> = Images on left, "Select your shades" on right<br>
              <strong>Right Side</strong> = Images on right, "Select your shades" on left
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Configurator Style</label>
            <select class="property-input" onchange="updateLayout('configuratorStyle', this.value)">
              <option value="dropdown" ${pageData.layout.configuratorStyle === 'dropdown' ? 'selected' : ''}>Dropdown (Select your shades)</option>
              <option value="expanded" ${pageData.layout.configuratorStyle === 'expanded' ? 'selected' : ''}>Always Expanded</option>
              <option value="tabs" ${pageData.layout.configuratorStyle === 'tabs' ? 'selected' : ''}>Tabbed Steps</option>
            </select>
          </div>
        </div>

        <!-- Element Position Controls -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-arrows-alt" style="margin-right: 6px;"></i>
            Element Positions (Drag to Reorder)
          </div>

          <div id="elementOrderList" style="background: #f9fafb; border-radius: 8px; overflow: hidden;">
            ${renderElementOrderList(positions)}
          </div>

          <div style="font-size: 11px; color: #637381; margin-top: 8px;">
            Drag elements to reorder. Use alignment buttons to position left, center, or right.
          </div>
        </div>

        <!-- Individual Element Alignment -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-align-left" style="margin-right: 6px;"></i>
            Element Alignment
          </div>

          <div class="property-field">
            <label class="property-label">"Select your shades" Button</label>
            <div style="display: flex; gap: 4px;">
              <button class="property-input ${positions.selectShades?.align === 'left' ? 'active-btn' : ''}"
                      style="flex: 1; cursor: pointer; ${positions.selectShades?.align === 'left' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('selectShades', 'left')">
                <i class="fas fa-align-left"></i> Left
              </button>
              <button class="property-input ${positions.selectShades?.align === 'center' ? 'active-btn' : ''}"
                      style="flex: 1; cursor: pointer; ${positions.selectShades?.align === 'center' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('selectShades', 'center')">
                <i class="fas fa-align-center"></i> Center
              </button>
              <button class="property-input ${positions.selectShades?.align === 'right' ? 'active-btn' : ''}"
                      style="flex: 1; cursor: pointer; ${positions.selectShades?.align === 'right' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('selectShades', 'right')">
                <i class="fas fa-align-right"></i> Right
              </button>
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Configurator Options (Width, Room, Shade Style)</label>
            <div style="display: flex; gap: 4px;">
              <button class="property-input ${positions.configurator?.align === 'left' ? 'active-btn' : ''}"
                      style="flex: 1; cursor: pointer; ${positions.configurator?.align === 'left' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('configurator', 'left')">
                <i class="fas fa-align-left"></i> Left
              </button>
              <button class="property-input ${positions.configurator?.align === 'center' ? 'active-btn' : ''}"
                      style="flex: 1; cursor: pointer; ${positions.configurator?.align === 'center' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('configurator', 'center')">
                <i class="fas fa-align-center"></i> Center
              </button>
              <button class="property-input ${positions.configurator?.align === 'right' ? 'active-btn' : ''}"
                      style="flex: 1; cursor: pointer; ${positions.configurator?.align === 'right' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('configurator', 'right')">
                <i class="fas fa-align-right"></i> Right
              </button>
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Price Display</label>
            <div style="display: flex; gap: 4px;">
              <button class="property-input"
                      style="flex: 1; cursor: pointer; ${positions.price?.align === 'left' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('price', 'left')">
                <i class="fas fa-align-left"></i> Left
              </button>
              <button class="property-input"
                      style="flex: 1; cursor: pointer; ${positions.price?.align === 'center' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('price', 'center')">
                <i class="fas fa-align-center"></i> Center
              </button>
              <button class="property-input"
                      style="flex: 1; cursor: pointer; ${positions.price?.align === 'right' ? 'background: #8b5cf6; color: white;' : ''}"
                      onclick="updateElementAlign('price', 'right')">
                <i class="fas fa-align-right"></i> Right
              </button>
            </div>
          </div>
        </div>

        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-toggle-on" style="margin-right: 6px;"></i>
            Display Options
          </div>

          <div class="property-toggle">
            <span class="toggle-label">Show Breadcrumbs</span>
            <label class="toggle-switch">
              <input type="checkbox" ${pageData.layout.showBreadcrumbs ? 'checked' : ''}
                     onchange="updateLayout('showBreadcrumbs', this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="property-toggle" style="margin-top: 8px;">
            <span class="toggle-label">Sticky Configurator</span>
            <label class="toggle-switch">
              <input type="checkbox" ${pageData.layout.stickyConfigurator ? 'checked' : ''}
                     onchange="updateLayout('stickyConfigurator', this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-mobile-alt" style="margin-right: 6px;"></i>
            Mobile Layout
          </div>

          <div class="property-field">
            <label class="property-label">Mobile Display</label>
            <select class="property-input" onchange="updateLayout('mobileLayout', this.value)">
              <option value="stacked" ${pageData.layout.mobileLayout === 'stacked' ? 'selected' : ''}>Stacked (Gallery then Configurator)</option>
              <option value="tabbed" ${pageData.layout.mobileLayout === 'tabbed' ? 'selected' : ''}>Tabbed Navigation</option>
            </select>
          </div>
        </div>

        <!-- CSS STYLING SECTION -->
        <div class="property-section" style="border-top: 2px solid #8b5cf6; padding-top: 16px; margin-top: 16px;">
          <div class="property-section-title" style="color: #8b5cf6;">
            <i class="fas fa-paint-brush" style="margin-right: 6px;"></i>
            CSS Styling
          </div>

          <!-- Page Background -->
          <div class="property-field">
            <label class="property-label">Page Background Color</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.pageBackground || '#F6F1EB'}"
                     onchange="updateStyle('pageBackground', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.pageBackground || '#F6F1EB'}"
                     onchange="updateStyle('pageBackground', this.value)">
            </div>
          </div>
        </div>

        <!-- Typography -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-font" style="margin-right: 6px;"></i>
            Typography
          </div>

          <div class="property-field">
            <label class="property-label">Title Font Family</label>
            <select class="property-input" onchange="updateStyle('titleFont', this.value)">
              <option value="Cormorant Garamond" ${pageData.styles?.titleFont === 'Cormorant Garamond' ? 'selected' : ''}>Cormorant Garamond</option>
              <option value="Playfair Display" ${pageData.styles?.titleFont === 'Playfair Display' ? 'selected' : ''}>Playfair Display</option>
              <option value="Montserrat" ${pageData.styles?.titleFont === 'Montserrat' ? 'selected' : ''}>Montserrat</option>
              <option value="Roboto" ${pageData.styles?.titleFont === 'Roboto' ? 'selected' : ''}>Roboto</option>
              <option value="Open Sans" ${pageData.styles?.titleFont === 'Open Sans' ? 'selected' : ''}>Open Sans</option>
              <option value="Lato" ${pageData.styles?.titleFont === 'Lato' ? 'selected' : ''}>Lato</option>
              <option value="Poppins" ${pageData.styles?.titleFont === 'Poppins' ? 'selected' : ''}>Poppins</option>
            </select>
          </div>

          <div class="property-field">
            <label class="property-label">Title Size</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="16" max="48" value="${parseInt(pageData.styles?.titleSize) || 28}"
                     style="flex: 1;" onchange="updateStyle('titleSize', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.titleSize || '28px'}"
                     onchange="updateStyle('titleSize', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Title Color</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.titleColor || '#8E6545'}"
                     onchange="updateStyle('titleColor', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.titleColor || '#8E6545'}"
                     onchange="updateStyle('titleColor', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Title Weight</label>
            <select class="property-input" onchange="updateStyle('titleWeight', this.value)">
              <option value="400" ${pageData.styles?.titleWeight === '400' ? 'selected' : ''}>Normal (400)</option>
              <option value="500" ${pageData.styles?.titleWeight === '500' ? 'selected' : ''}>Medium (500)</option>
              <option value="600" ${pageData.styles?.titleWeight === '600' ? 'selected' : ''}>Semi-Bold (600)</option>
              <option value="700" ${pageData.styles?.titleWeight === '700' ? 'selected' : ''}>Bold (700)</option>
            </select>
          </div>

          <div class="property-field">
            <label class="property-label">Body Font Family</label>
            <select class="property-input" onchange="updateStyle('bodyFont', this.value)">
              <option value="Montserrat" ${pageData.styles?.bodyFont === 'Montserrat' ? 'selected' : ''}>Montserrat</option>
              <option value="Roboto" ${pageData.styles?.bodyFont === 'Roboto' ? 'selected' : ''}>Roboto</option>
              <option value="Open Sans" ${pageData.styles?.bodyFont === 'Open Sans' ? 'selected' : ''}>Open Sans</option>
              <option value="Lato" ${pageData.styles?.bodyFont === 'Lato' ? 'selected' : ''}>Lato</option>
              <option value="Poppins" ${pageData.styles?.bodyFont === 'Poppins' ? 'selected' : ''}>Poppins</option>
            </select>
          </div>

          <div class="property-field">
            <label class="property-label">Body Size</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="12" max="20" value="${parseInt(pageData.styles?.bodySize) || 14}"
                     style="flex: 1;" onchange="updateStyle('bodySize', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.bodySize || '14px'}"
                     onchange="updateStyle('bodySize', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Body Color</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.bodyColor || '#666666'}"
                     onchange="updateStyle('bodyColor', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.bodyColor || '#666666'}"
                     onchange="updateStyle('bodyColor', this.value)">
            </div>
          </div>
        </div>

        <!-- Price Styling -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-dollar-sign" style="margin-right: 6px;"></i>
            Price Styling
          </div>

          <div class="property-field">
            <label class="property-label">Price Size</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="20" max="48" value="${parseInt(pageData.styles?.priceSize) || 32}"
                     style="flex: 1;" onchange="updateStyle('priceSize', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.priceSize || '32px'}"
                     onchange="updateStyle('priceSize', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Price Color</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.priceColor || '#8E6545'}"
                     onchange="updateStyle('priceColor', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.priceColor || '#8E6545'}"
                     onchange="updateStyle('priceColor', this.value)">
            </div>
          </div>
        </div>

        <!-- Button Styling -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-square" style="margin-right: 6px;"></i>
            Button Styling
          </div>

          <div class="property-field">
            <label class="property-label">Button Background</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.buttonBackground || '#8E6545'}"
                     onchange="updateStyle('buttonBackground', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.buttonBackground || '#8E6545'}"
                     onchange="updateStyle('buttonBackground', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Button Text Color</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.buttonColor || '#FFFFFF'}"
                     onchange="updateStyle('buttonColor', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.buttonColor || '#FFFFFF'}"
                     onchange="updateStyle('buttonColor', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Button Border Radius</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="0" max="24" value="${parseInt(pageData.styles?.buttonBorderRadius) || 6}"
                     style="flex: 1;" onchange="updateStyle('buttonBorderRadius', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.buttonBorderRadius || '6px'}"
                     onchange="updateStyle('buttonBorderRadius', this.value)">
            </div>
          </div>
        </div>

        <!-- Element Sizes -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-expand-arrows-alt" style="margin-right: 6px;"></i>
            Element Sizes
          </div>

          <div class="property-field">
            <label class="property-label">Gallery Width</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="300" max="700" value="${parseInt(pageData.styles?.galleryWidth) || 500}"
                     style="flex: 1;" onchange="updateStyle('galleryWidth', this.value + 'px')">
              <input type="text" class="property-input" style="width: 80px;" value="${pageData.styles?.galleryWidth || '500px'}"
                     onchange="updateStyle('galleryWidth', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Gallery Border Radius</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="0" max="24" value="${parseInt(pageData.styles?.galleryBorderRadius) || 12}"
                     style="flex: 1;" onchange="updateStyle('galleryBorderRadius', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.galleryBorderRadius || '12px'}"
                     onchange="updateStyle('galleryBorderRadius', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Option Box Border Radius</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="0" max="16" value="${parseInt(pageData.styles?.optionBorderRadius) || 8}"
                     style="flex: 1;" onchange="updateStyle('optionBorderRadius', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.optionBorderRadius || '8px'}"
                     onchange="updateStyle('optionBorderRadius', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Option Box Padding</label>
            <input type="text" class="property-input" value="${pageData.styles?.optionPadding || '20px'}"
                   onchange="updateStyle('optionPadding', this.value)" placeholder="e.g., 20px or 16px 24px">
          </div>
        </div>

        <!-- Spacing -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-arrows-alt-v" style="margin-right: 6px;"></i>
            Spacing
          </div>

          <div class="property-field">
            <label class="property-label">Section Spacing</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="8" max="48" value="${parseInt(pageData.styles?.sectionSpacing) || 24}"
                     style="flex: 1;" onchange="updateStyle('sectionSpacing', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.sectionSpacing || '24px'}"
                     onchange="updateStyle('sectionSpacing', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Element Spacing</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="4" max="32" value="${parseInt(pageData.styles?.elementSpacing) || 16}"
                     style="flex: 1;" onchange="updateStyle('elementSpacing', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.elementSpacing || '16px'}"
                     onchange="updateStyle('elementSpacing', this.value)">
            </div>
          </div>
        </div>

        <!-- Select Shades Box Styling -->
        <div class="property-section">
          <div class="property-section-title">
            <i class="fas fa-list-dropdown" style="margin-right: 6px;"></i>
            "Select your shades" Box
          </div>

          <div class="property-field">
            <label class="property-label">Background Color</label>
            <div class="color-picker-wrapper">
              <input type="color" value="${pageData.styles?.selectShadesBackground || '#FFFFFF'}"
                     onchange="updateStyle('selectShadesBackground', this.value)">
              <input type="text" class="property-input" value="${pageData.styles?.selectShadesBackground || '#FFFFFF'}"
                     onchange="updateStyle('selectShadesBackground', this.value)">
            </div>
          </div>

          <div class="property-field">
            <label class="property-label">Border</label>
            <input type="text" class="property-input" value="${pageData.styles?.selectShadesBorder || '1px solid #E0D5C7'}"
                   onchange="updateStyle('selectShadesBorder', this.value)" placeholder="e.g., 1px solid #E0D5C7">
          </div>

          <div class="property-field">
            <label class="property-label">Border Radius</label>
            <div style="display: flex; gap: 8px;">
              <input type="range" min="0" max="20" value="${parseInt(pageData.styles?.selectShadesBorderRadius) || 8}"
                     style="flex: 1;" onchange="updateStyle('selectShadesBorderRadius', this.value + 'px')">
              <input type="text" class="property-input" style="width: 70px;" value="${pageData.styles?.selectShadesBorderRadius || '8px'}"
                     onchange="updateStyle('selectShadesBorderRadius', this.value)">
            </div>
          </div>
        </div>

        <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; margin-top: 16px;">
          <div style="font-size: 12px; color: #166534; font-weight: 500; margin-bottom: 4px;">
            <i class="fas fa-check-circle"></i> Changes Applied
          </div>
          <div style="font-size: 11px; color: #166534;">
            All style changes are applied in real-time to the preview. Click <strong>Save</strong> to make them permanent.
          </div>
        </div>
      `;

      // Setup drag and drop for element order
      setupElementOrderDragDrop();
    }

    // Update style function
    function updateStyle(key, value) {
      if (!pageData.styles) pageData.styles = {};
      pageData.styles[key] = value;
      markUnsaved();
      updatePreview();
    }

    // Render element order list for drag and drop
    function renderElementOrderList(positions) {
      const elements = [
        { key: 'selectShades', name: 'Select your shades', icon: 'fa-list-dropdown' },
        { key: 'productTitle', name: 'Product Title', icon: 'fa-heading' },
        { key: 'price', name: 'Price Display', icon: 'fa-dollar-sign' },
        { key: 'features', name: 'Feature Badges', icon: 'fa-check-circle' },
        { key: 'trustBadges', name: 'Trust Badges', icon: 'fa-shield-alt' },
        { key: 'configurator', name: 'Configurator Options', icon: 'fa-sliders-h' }
      ];

      // Sort by order
      elements.sort((a, b) => (positions[a.key]?.order || 99) - (positions[b.key]?.order || 99));

      return elements.map((el, idx) => `
        <div class="element-order-item"
             draggable="true"
             data-key="${el.key}"
             style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-bottom: 1px solid #e1e3e5; cursor: grab; background: white;">
          <i class="fas fa-grip-vertical" style="color: #c9cccf;"></i>
          <i class="fas ${el.icon}" style="color: #8b5cf6; width: 16px;"></i>
          <span style="flex: 1; font-size: 13px;">${el.name}</span>
          <div style="display: flex; gap: 2px;">
            <button onclick="moveElementOrder('${el.key}', 'up')" style="border: none; background: none; cursor: pointer; padding: 4px;" title="Move up">
              <i class="fas fa-chevron-up" style="color: #637381; font-size: 10px;"></i>
            </button>
            <button onclick="moveElementOrder('${el.key}', 'down')" style="border: none; background: none; cursor: pointer; padding: 4px;" title="Move down">
              <i class="fas fa-chevron-down" style="color: #637381; font-size: 10px;"></i>
            </button>
          </div>
        </div>
      `).join('');
    }

    // Setup drag and drop for element ordering
    function setupElementOrderDragDrop() {
      const list = document.getElementById('elementOrderList');
      if (!list) return;

      let draggedItem = null;

      list.querySelectorAll('.element-order-item').forEach(item => {
        item.addEventListener('dragstart', (e) => {
          draggedItem = item;
          item.style.opacity = '0.5';
          e.dataTransfer.effectAllowed = 'move';
        });

        item.addEventListener('dragend', (e) => {
          item.style.opacity = '1';
          draggedItem = null;
        });

        item.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        });

        item.addEventListener('drop', (e) => {
          e.preventDefault();
          if (draggedItem && draggedItem !== item) {
            const allItems = [...list.querySelectorAll('.element-order-item')];
            const fromIndex = allItems.indexOf(draggedItem);
            const toIndex = allItems.indexOf(item);

            // Update order in pageData
            const keys = allItems.map(i => i.dataset.key);
            const [movedKey] = keys.splice(fromIndex, 1);
            keys.splice(toIndex, 0, movedKey);

            // Update order numbers
            keys.forEach((key, idx) => {
              if (!pageData.layout.elementPositions[key]) {
                pageData.layout.elementPositions[key] = {};
              }
              pageData.layout.elementPositions[key].order = idx + 1;
            });

            markUnsaved();
            renderDefaultProperties();
            updatePreview();
          }
        });
      });
    }

    // Move element order up/down
    function moveElementOrder(key, direction) {
      const positions = pageData.layout.elementPositions;
      const elements = Object.keys(positions).sort((a, b) => (positions[a]?.order || 99) - (positions[b]?.order || 99));
      const currentIndex = elements.indexOf(key);

      if (direction === 'up' && currentIndex > 0) {
        // Swap with previous
        const prevKey = elements[currentIndex - 1];
        const tempOrder = positions[key].order;
        positions[key].order = positions[prevKey].order;
        positions[prevKey].order = tempOrder;
      } else if (direction === 'down' && currentIndex < elements.length - 1) {
        // Swap with next
        const nextKey = elements[currentIndex + 1];
        const tempOrder = positions[key].order;
        positions[key].order = positions[nextKey].order;
        positions[nextKey].order = tempOrder;
      }

      markUnsaved();
      renderDefaultProperties();
      updatePreview();
    }

    // Update element alignment
    async function updateElementAlign(elementKey, align) {
      if (!pageData.layout.elementPositions) {
        pageData.layout.elementPositions = {};
      }
      if (!pageData.layout.elementPositions[elementKey]) {
        pageData.layout.elementPositions[elementKey] = { order: 99 };
      }
      pageData.layout.elementPositions[elementKey].align = align;
      renderDefaultProperties();
      updatePreview();

      // Auto-save to server
      await saveAllChanges();
      showToast(`${elementKey} aligned to ${align}`, 'success');
    }

    // Update layout settings
    function updateLayout(key, value) {
      pageData.layout[key] = value;
      markUnsaved();
      updatePreview();
    }

    // Update section data
    function updateSectionName(sectionId, value) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section) {
        section.name = value;
        markUnsaved();
        renderSectionsList();
      }
    }

    function updateSectionData(sectionId, key, value) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section) {
        if (!section.data) section.data = {};
        section.data[key] = value;
        markUnsaved();
        updatePreview();
      }
    }

    function toggleSectionVisibility(sectionId) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section) {
        section.isVisible = !section.isVisible;
        markUnsaved();
        renderSectionsList();
        if (selectedSectionId === sectionId) {
          renderSectionProperties(sectionId);
        }
        updatePreview();
      }
    }

    // Feature items
    function updateFeatureItem(sectionId, index, value) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section && section.data?.items?.[index]) {
        section.data.items[index].text = value;
        markUnsaved();
        updatePreview();
      }
    }

    function addFeatureItem(sectionId) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section) {
        if (!section.data.items) section.data.items = [];
        section.data.items.push({ icon: 'fa-check', text: 'New Feature' });
        markUnsaved();
        renderSectionProperties(sectionId);
        updatePreview();
      }
    }

    function removeFeatureItem(sectionId, index) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section && section.data?.items) {
        section.data.items.splice(index, 1);
        markUnsaved();
        renderSectionProperties(sectionId);
        updatePreview();
      }
    }

    // Trust badges
    function updateTrustBadge(sectionId, index, key, value) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section && section.data?.items?.[index]) {
        section.data.items[index][key] = value;
        markUnsaved();
        updatePreview();
      }
    }

    function addTrustBadge(sectionId) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section) {
        if (!section.data.items) section.data.items = [];
        section.data.items.push({ icon: 'fa-check', text: 'New Badge' });
        markUnsaved();
        renderSectionProperties(sectionId);
        updatePreview();
      }
    }

    function removeTrustBadge(sectionId, index) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section && section.data?.items) {
        section.data.items.splice(index, 1);
        markUnsaved();
        renderSectionProperties(sectionId);
        updatePreview();
      }
    }

    // Image upload
    async function uploadImage(sectionId, field) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('image', file);

        try {
          const response = await fetch('/api/admin/upload', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${Admin.Auth.getToken()}` },
            body: formData
          });
          const result = await response.json();
          if (result.success) {
            updateSectionData(sectionId, field, result.url);
            renderSectionProperties(sectionId);
            showToast('Image uploaded successfully', 'success');
          }
        } catch (error) {
          showToast('Failed to upload image', 'error');
        }
      };
      input.click();
    }

    async function uploadGalleryImage(sectionId, index) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('image', file);

        try {
          const response = await fetch('/api/admin/upload', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${Admin.Auth.getToken()}` },
            body: formData
          });
          const result = await response.json();
          if (result.success) {
            const section = pageData.sections.find(s => s.id === sectionId);
            if (section) {
              if (!section.data.images) section.data.images = [];
              section.data.images[index] = result.url;
              markUnsaved();
              renderSectionProperties(sectionId);
              updatePreview();
              showToast('Image uploaded successfully', 'success');
            }
          }
        } catch (error) {
          showToast('Failed to upload image', 'error');
        }
      };
      input.click();
    }

    // Drag and drop
    function handleDragStart(e, sectionId) {
      draggedSection = sectionId;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      e.target.closest('.section-item')?.classList.add('drag-over');
    }

    function handleDrop(e, targetSectionId) {
      e.preventDefault();
      e.target.closest('.section-item')?.classList.remove('drag-over');

      if (draggedSection && draggedSection !== targetSectionId) {
        const fromIndex = pageData.sections.findIndex(s => s.id === draggedSection);
        const toIndex = pageData.sections.findIndex(s => s.id === targetSectionId);

        if (fromIndex > -1 && toIndex > -1) {
          const [moved] = pageData.sections.splice(fromIndex, 1);
          pageData.sections.splice(toIndex, 0, moved);
          markUnsaved();
          renderSectionsList();
          updatePreview();
        }
      }
    }

    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      document.querySelectorAll('.section-item').forEach(el => el.classList.remove('drag-over'));
      draggedSection = null;
    }

    // Section actions
    function duplicateSection(sectionId) {
      const section = pageData.sections.find(s => s.id === sectionId);
      if (section) {
        const newSection = JSON.parse(JSON.stringify(section));
        newSection.id = 'section-' + Date.now();
        newSection.name = section.name + ' (Copy)';
        const index = pageData.sections.findIndex(s => s.id === sectionId);
        pageData.sections.splice(index + 1, 0, newSection);
        markUnsaved();
        renderSectionsList();
        updatePreview();
        showToast('Section duplicated', 'success');
      }
    }

    function deleteSection(sectionId) {
      if (!confirm('Are you sure you want to delete this section?')) return;

      const index = pageData.sections.findIndex(s => s.id === sectionId);
      if (index > -1) {
        pageData.sections.splice(index, 1);
        if (selectedSectionId === sectionId) {
          selectedSectionId = null;
          renderDefaultProperties();
        }
        markUnsaved();
        renderSectionsList();
        updatePreview();
        showToast('Section deleted', 'success');
      }
    }

    // Add section modal
    function openAddSectionModal() {
      document.getElementById('addSectionModal').classList.add('active');
    }

    function closeAddSectionModal() {
      document.getElementById('addSectionModal').classList.remove('active');
    }

    function renderSectionTemplates() {
      const container = document.getElementById('sectionTemplates');
      container.innerHTML = sectionTemplates.map(template => `
        <div class="section-template" onclick="addSection('${template.type}')">
          <div class="template-icon"><i class="fas ${template.icon}"></i></div>
          <div class="template-name">${template.name}</div>
          <div class="template-desc">${template.description}</div>
        </div>
      `).join('');
    }

    function addSection(type) {
      const template = sectionTemplates.find(t => t.type === type);
      if (!template) return;

      const newSection = {
        id: 'section-' + Date.now(),
        type: type,
        name: template.name,
        isVisible: true,
        data: JSON.parse(JSON.stringify(template.defaultData))
      };

      pageData.sections.push(newSection);
      markUnsaved();
      renderSectionsList();
      closeAddSectionModal();
      selectSection(newSection.id);
      updatePreview();
      showToast('Section added', 'success');
    }

    // Preview
    function setPreviewDevice(device) {
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === device);
      });
      document.getElementById('previewFrame').className = 'preview-frame-wrapper ' + device;
    }

    function onPreviewLoad() {
      updatePreview();
    }

    function updatePreview() {
      const iframe = document.getElementById('previewIframe');
      try {
        // Send section data to the preview iframe
        iframe.contentWindow.postMessage({
          type: 'UPDATE_PAGE_SECTIONS',
          sections: pageData.sections
        }, '*');
      } catch (e) {
        console.log('Could not update preview:', e);
      }
    }

    function highlightSectionInPreview(sectionId) {
      const iframe = document.getElementById('previewIframe');
      try {
        iframe.contentWindow.postMessage({
          type: 'HIGHLIGHT_SECTION',
          sectionId: sectionId
        }, '*');
      } catch (e) {
        console.log('Could not highlight section:', e);
      }
    }

    // Save
    function markUnsaved() {
      hasUnsavedChanges = true;
      const status = document.getElementById('saveStatus');
      status.innerHTML = '<i class="fas fa-circle" style="font-size: 8px;"></i> Unsaved changes';
      status.className = 'save-status';
    }

    async function saveAllChanges() {
      const btn = document.getElementById('saveBtn');
      const status = document.getElementById('saveStatus');

      btn.disabled = true;
      btn.textContent = 'Saving...';
      status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
      status.className = 'save-status saving';

      try {
        const response = await Admin.API.put(`/product-page-sections/${pageData.slug}`, {
          sections: pageData.sections,
          layout: pageData.layout,
          styles: pageData.styles
        });

        if (response.success) {
          hasUnsavedChanges = false;
          status.innerHTML = '<i class="fas fa-check-circle"></i> Saved';
          status.className = 'save-status saved';
          showToast('Changes saved successfully', 'success');

          // Reload the preview to show saved changes
          document.getElementById('previewIframe').src = document.getElementById('previewIframe').src;
        } else {
          throw new Error(response.error || 'Save failed');
        }
      } catch (error) {
        status.innerHTML = '<i class="fas fa-exclamation-circle"></i> Save failed';
        status.className = 'save-status';
        showToast('Failed to save changes', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Save';
      }
    }

    // Keyboard shortcuts
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          saveAllChanges();
        }
      });
    }

    // Toast
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        <span>${message}</span>
      `;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Utility
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    // Warn before leaving with unsaved changes
    // ==========================================
    // LAYOUT BUILDER FUNCTIONS
    // ==========================================

    // Set preview mode (builder or preview)
    function setPreviewMode(mode) {
      currentPreviewMode = mode;
      document.querySelectorAll('.preview-mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });

      const layoutBuilder = document.getElementById('layoutBuilder');
      const previewFrame = document.getElementById('previewFrame');

      if (mode === 'builder') {
        layoutBuilder.style.display = 'block';
        previewFrame.style.display = 'none';
      } else {
        layoutBuilder.style.display = 'none';
        previewFrame.style.display = 'block';
        // Reload preview iframe
        const iframe = document.getElementById('previewIframe');
        if (iframe.src) {
          iframe.src = iframe.src;
        }
      }
    }

    // Render the layout builder
    function renderLayoutBuilder() {
      // Load saved element positions from pageData
      if (pageData.layout.elements) {
        layoutElements.forEach(el => {
          const saved = pageData.layout.elements.find(s => s.id === el.id);
          if (saved) {
            el.column = saved.column || el.column;
            el.order = saved.order || el.order;
            el.hidden = saved.hidden || false;
            el.deleted = saved.deleted || false;
            el.settings = { ...el.settings, ...saved.settings };
          }
        });
      }

      renderColumnElements('left');
      renderColumnElements('right');
      renderColumnElements('bottom');

      // DEBUG: Log all right column elements
      console.log('=== RIGHT COLUMN ELEMENTS ===');
      const rightElements = layoutElements.filter(el => el.column === 'right' && !el.deleted);
      console.log('Total right column elements:', rightElements.length);
      rightElements.forEach(el => console.log(' - ' + el.id + ': ' + el.name));
    }

    // Render elements in a column
    function renderColumnElements(column) {
      const container = document.getElementById(column + 'ColumnElements');
      const elements = layoutElements
        .filter(el => el.column === column && !el.deleted)
        .sort((a, b) => a.order - b.order);

      if (elements.length === 0) {
        container.innerHTML = `
          <div class="column-placeholder">
            <i class="fas fa-arrow-down"></i>
            <div>Drop elements here</div>
          </div>
        `;
        return;
      }

      container.innerHTML = elements.map(el => renderLayoutElement(el)).join('');

      // Add deleted elements section if any exist
      const deletedElements = layoutElements.filter(el => el.deleted);
      if (deletedElements.length > 0 && column === 'right') {
        const deletedHtml = `
          <div style="margin-top: 20px; padding: 16px; background: #fef2f2; border: 1px dashed #fca5a5; border-radius: 8px;">
            <div style="font-size: 12px; font-weight: 600; color: #dc2626; margin-bottom: 10px;">
              <i class="fas fa-trash-restore"></i> Deleted Elements (Click to Restore)
            </div>
            ${deletedElements.map(el => `
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: #fff; border-radius: 4px; margin-bottom: 6px; cursor: pointer;"
                   onclick="restoreElement('${el.id}')">
                <i class="fas ${el.icon}" style="color: #dc2626;"></i>
                <span style="font-size: 13px; color: #666;">${el.name}</span>
                <button style="margin-left: auto; border: none; background: #22c55e; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">
                  Restore
                </button>
              </div>
            `).join('')}
          </div>
        `;
        container.innerHTML += deletedHtml;
      }
    }

    // Render a single layout element
    function renderLayoutElement(element) {
      const isFixed = element.fixed === true;
      const isHidden = element.hidden === true;
      const previewHtml = getElementPreview(element);

      return `
        <div class="layout-element ${isFixed ? 'fixed' : ''} ${isHidden ? 'hidden-element' : ''}"
             data-id="${element.id}"
             draggable="${!isFixed}"
             ondragstart="handleElementDragStart(event, '${element.id}')"
             ondragend="handleElementDragEnd(event)"
             ondragover="handleElementDragOver(event)"
             ondrop="handleElementDrop(event, '${element.id}')"
             style="${isHidden ? 'opacity: 0.5;' : ''}">
          <div class="layout-element-header">
            <div class="layout-element-icon">
              <i class="fas ${element.icon}"></i>
            </div>
            <div class="layout-element-info">
              <div class="layout-element-name">${element.name}</div>
              <div class="layout-element-desc">${element.description}</div>
            </div>
            <div class="layout-element-actions">
              <button class="layout-element-action" onclick="event.stopPropagation(); openEditPanel('${element.id}')" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              ${!isFixed ? `
                <button class="layout-element-action" onclick="event.stopPropagation(); moveToOtherColumn('${element.id}')" title="Move to other column">
                  <i class="fas fa-arrows-alt-h"></i>
                </button>
                <button class="layout-element-action" onclick="event.stopPropagation(); toggleElementVisibility('${element.id}')" title="${isHidden ? 'Show' : 'Hide'}">
                  <i class="fas ${isHidden ? 'fa-eye-slash' : 'fa-eye'}"></i>
                </button>
                <button class="layout-element-action delete" onclick="event.stopPropagation(); deleteElement('${element.id}')" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              ` : ''}
            </div>
          </div>
          ${previewHtml}
        </div>
      `;
    }

    // Get preview HTML for an element
    function getElementPreview(element) {
      switch (element.id) {
        case 'selectShades':
          const btnColor = element.settings.buttonColor || '#8E6545';
          const btnTextColor = element.settings.buttonTextColor || '#FFFFFF';
          const btnText = element.settings.buttonText || 'Select your shades';
          const showOpts = element.settings.showOptions || ['dimensions', 'roomLabel', 'shadeStyle'];
          return `
            <div class="layout-element-preview" style="padding: 0;">
              <div style="background: linear-gradient(135deg, #f8f6f3, #f0ebe4); border: 1px solid #e0d5c7; border-radius: 8px; padding: 16px;">
                <!-- Main Dropdown Button -->
                <div style="background: ${btnColor}; color: ${btnTextColor}; padding: 14px 20px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <span>${btnText}</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <!-- Collapsible Options -->
                <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">
                  ${showOpts.includes('dimensions') ? `
                    <div style="background: #fff; border: 1px solid #e0d5c7; border-radius: 6px; padding: 12px 14px; display: flex; align-items: center; justify-content: space-between; font-size: 13px;">
                      <span style="color: #333;"><i class="fas fa-ruler-combined" style="color: ${btnColor}; margin-right: 8px;"></i> Width X Height</span>
                      <i class="fas fa-chevron-down" style="color: #999;"></i>
                    </div>
                  ` : ''}
                  ${showOpts.includes('roomLabel') ? `
                    <div style="background: #fff; border: 1px solid #e0d5c7; border-radius: 6px; padding: 12px 14px; display: flex; align-items: center; justify-content: space-between; font-size: 13px;">
                      <span style="color: #333;"><i class="fas fa-tag" style="color: ${btnColor}; margin-right: 8px;"></i> Room Label</span>
                      <i class="fas fa-chevron-down" style="color: #999;"></i>
                    </div>
                  ` : ''}
                  ${showOpts.includes('shadeStyle') ? `
                    <div style="background: #fff; border: 1px solid #e0d5c7; border-radius: 6px; padding: 12px 14px; display: flex; align-items: center; justify-content: space-between; font-size: 13px;">
                      <span style="color: #333;"><i class="fas fa-palette" style="color: ${btnColor}; margin-right: 8px;"></i> Shade Style</span>
                      <i class="fas fa-chevron-down" style="color: #999;"></i>
                    </div>
                  ` : ''}
                </div>
              </div>
            </div>
          `;
        case 'gallery':
          const galleryImages = element.settings.images || [];
          return `
            <div class="layout-element-preview" style="padding: 12px;">
              <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                ${galleryImages.length > 0 ? galleryImages.map((img, i) => `
                  <div style="width: 60px; height: 60px; border-radius: 6px; overflow: hidden; border: 1px solid #ddd;">
                    <img src="${img}" style="width: 100%; height: 100%; object-fit: cover;" alt="Gallery ${i+1}">
                  </div>
                `).join('') : `
                  <div style="text-align: center; color: #999;">
                    <i class="fas fa-images" style="font-size: 28px; margin-bottom: 8px;"></i>
                    <div style="font-size: 12px;">Click Edit to upload images</div>
                  </div>
                `}
              </div>
            </div>
          `;
        case 'productTitle':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 16px; font-weight: 600; color: #8E6545; margin-bottom: 4px;">Product Title</div>
              <div style="font-size: 12px; color: #666;">Product description text...</div>
            </div>
          `;
        case 'price':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 24px; font-weight: 700; color: #8E6545;">$49.99</div>
            </div>
          `;
        case 'features':
          return `
            <div class="layout-element-preview">
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <span style="background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                  <i class="fas fa-check"></i> Energy Efficient
                </span>
                <span style="background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                  <i class="fas fa-check"></i> Custom Sizes
                </span>
              </div>
            </div>
          `;
        case 'trustBadges':
          return `
            <div class="layout-element-preview">
              <div style="display: flex; gap: 12px;">
                <span style="font-size: 11px;"><i class="fas fa-truck" style="color: #8b5cf6;"></i> Free Shipping</span>
                <span style="font-size: 11px;"><i class="fas fa-shield-alt" style="color: #8b5cf6;"></i> 5 Year Warranty</span>
              </div>
            </div>
          `;
        case 'dimensions':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px; color: #666; display: flex; gap: 16px;">
                <div><i class="fas fa-ruler-horizontal" style="color: #8E6545;"></i> Width: <span style="color: #333;">24"</span></div>
                <div><i class="fas fa-ruler-vertical" style="color: #8E6545;"></i> Height: <span style="color: #333;">36"</span></div>
              </div>
            </div>
          `;
        case 'roomLabel':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px; color: #666;">
                <i class="fas fa-tag" style="color: #8E6545; margin-right: 6px;"></i>
                <span>Room Label: </span><span style="color: #333; font-style: italic;">Living Room</span>
              </div>
            </div>
          `;
        case 'shadeStyle':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 6px;"><i class="fas fa-palette" style="color: #8E6545; margin-right: 6px;"></i>Shade Style</div>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                  <span style="background: #8E6545; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Light Filtering</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Room Darkening</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Blackout</span>
                </div>
              </div>
            </div>
          `;
        case 'mountType':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 6px;"><i class="fas fa-expand-arrows-alt" style="color: #8E6545; margin-right: 6px;"></i>Mount Type</div>
                <div style="display: flex; gap: 6px;">
                  <span style="background: #8E6545; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Inside Mount</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Outside Mount</span>
                </div>
              </div>
            </div>
          `;
        case 'controlType':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 6px;"><i class="fas fa-cogs" style="color: #8E6545; margin-right: 6px;"></i>Control Type</div>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                  <span style="background: #8E6545; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Bead Chain</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Cordless +$20</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Motorized +$75</span>
                </div>
              </div>
            </div>
          `;
        case 'hardwareType':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 6px;"><i class="fas fa-tools" style="color: #8E6545; margin-right: 6px;"></i>Hardware Type</div>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                  <span style="background: #8E6545; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Standard Valance</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;">Fabric Wrapped</span>
                </div>
              </div>
            </div>
          `;
        case 'accessories':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 6px;"><i class="fas fa-puzzle-piece" style="color: #8E6545; margin-right: 6px;"></i>Accessories</div>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;"><i class="far fa-square" style="margin-right: 4px;"></i>Hold Down Brackets +$5</span>
                  <span style="background: #f5f5f5; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 11px;"><i class="far fa-square" style="margin-right: 4px;"></i>Extension Brackets +$8</span>
                </div>
              </div>
            </div>
          `;
        case 'addToCart':
          return `
            <div class="layout-element-preview">
              <div style="background: ${element.settings.buttonColor || '#8E6545'}; color: ${element.settings.buttonTextColor || '#fff'}; padding: 12px 24px; border-radius: 6px; text-align: center; font-weight: 500;">
                <i class="fas fa-shopping-cart" style="margin-right: 8px;"></i>
                ${element.settings.buttonText || 'Add to Cart'}
              </div>
            </div>
          `;

        case 'requestQuote':
          return `
            <div class="layout-element-preview">
              <div style="background: ${element.settings.buttonColor || '#4A5568'}; color: ${element.settings.buttonTextColor || '#fff'}; padding: 12px 24px; border-radius: 6px; text-align: center; font-weight: 500; border: 2px solid ${element.settings.buttonColor || '#4A5568'};">
                <i class="fas fa-file-invoice" style="margin-right: 8px;"></i>
                ${element.settings.buttonText || 'Request for Quote'}
              </div>
            </div>
          `;

        case 'buyWithShopPay':
          return `
            <div class="layout-element-preview">
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <div style="background: #5A31F4; color: #fff; padding: 12px 24px; border-radius: 6px; text-align: center; font-weight: 600; font-size: 13px;">
                  <i class="fab fa-shopify" style="margin-right: 6px;"></i> Buy with Shop Pay
                </div>
                <div style="display: flex; gap: 6px; justify-content: center;">
                  ${element.settings.showApplePay ? '<div style="background: #000; color: #fff; padding: 8px 16px; border-radius: 4px; font-size: 11px;"><i class="fab fa-apple-pay"></i></div>' : ''}
                  ${element.settings.showGooglePay ? '<div style="background: #fff; border: 1px solid #ddd; padding: 8px 16px; border-radius: 4px; font-size: 11px;"><i class="fab fa-google-pay"></i></div>' : ''}
                  ${element.settings.showPayPal ? '<div style="background: #003087; color: #fff; padding: 8px 16px; border-radius: 4px; font-size: 11px;"><i class="fab fa-paypal"></i></div>' : ''}
                </div>
              </div>
            </div>
          `;

        case 'quantity':
          return `
            <div class="layout-element-preview">
              <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 13px; color: #666;">Quantity:</span>
                <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 6px; overflow: hidden;">
                  <button style="background: #f5f5f5; border: none; padding: 8px 12px; cursor: pointer;">-</button>
                  <span style="padding: 8px 16px; border-left: 1px solid #ddd; border-right: 1px solid #ddd;">1</span>
                  <button style="background: #f5f5f5; border: none; padding: 8px 12px; cursor: pointer;">+</button>
                </div>
              </div>
            </div>
          `;

        case 'specifications':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px; color: #666;">
                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee;"><span>Material</span><span style="color: #333;">Polyester Fabric</span></div>
                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee;"><span>Available Sizes</span><span style="color: #333;">Custom</span></div>
                <div style="display: flex; justify-content: space-between; padding: 6px 0;"><span>Weight</span><span style="color: #333;">2.5 lbs</span></div>
              </div>
            </div>
          `;

        case 'reviews':
          return `
            <div class="layout-element-preview">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="color: #f59e0b;">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star-half-alt"></i>
                </div>
                <span style="font-size: 13px; color: #666;">4.5 (128 reviews)</span>
              </div>
            </div>
          `;

        case 'deliveryInfo':
          return `
            <div class="layout-element-preview">
              <div style="font-size: 12px;">
                <div style="display: flex; align-items: center; gap: 8px; color: #22c55e; margin-bottom: 4px;">
                  <i class="fas fa-truck"></i>
                  <span>Free Shipping on orders over $99</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; color: #666;">
                  <i class="fas fa-calendar"></i>
                  <span>Estimated delivery: 5-7 business days</span>
                </div>
              </div>
            </div>
          `;

        default:
          return `
            <div class="layout-element-preview" style="text-align: center; padding: 16px; color: #999;">
              <i class="fas fa-cube" style="font-size: 24px; margin-bottom: 8px;"></i>
              <div style="font-size: 12px;">Element Preview</div>
            </div>
          `;
      }
    }

    // Drag and Drop Handlers for Layout Elements
    function handleElementDragStart(e, elementId) {
      const element = layoutElements.find(el => el.id === elementId);
      if (element && element.fixed) {
        e.preventDefault();
        return;
      }
      draggedElement = elementId;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', elementId);
    }

    function handleElementDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedElement = null;
      document.querySelectorAll('.layout-column').forEach(col => col.classList.remove('drag-over'));
    }

    function handleElementDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function handleElementDrop(e, targetElementId) {
      e.preventDefault();
      e.stopPropagation();

      if (!draggedElement || draggedElement === targetElementId) return;

      const draggedEl = layoutElements.find(el => el.id === draggedElement);
      const targetEl = layoutElements.find(el => el.id === targetElementId);

      if (!draggedEl || !targetEl || draggedEl.fixed) return;

      // Swap orders if in same column
      if (draggedEl.column === targetEl.column) {
        const tempOrder = draggedEl.order;
        draggedEl.order = targetEl.order;
        targetEl.order = tempOrder;
      } else {
        // Move to target's column
        draggedEl.column = targetEl.column;
        draggedEl.order = targetEl.order;
        // Shift other elements
        layoutElements
          .filter(el => el.column === targetEl.column && el.id !== draggedEl.id && el.order >= draggedEl.order)
          .forEach(el => el.order++);
      }

      markUnsaved();
      renderLayoutBuilder();
      saveElementPositions();
    }

    function handleColumnDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      e.currentTarget.classList.add('drag-over');
    }

    function handleColumnDragLeave(e) {
      e.currentTarget.classList.remove('drag-over');
    }

    function handleColumnDrop(e, column) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');

      if (!draggedElement) return;

      const element = layoutElements.find(el => el.id === draggedElement);
      if (!element || element.fixed) return;

      // Move element to this column
      const elementsInColumn = layoutElements.filter(el => el.column === column);
      element.column = column;
      element.order = elementsInColumn.length + 1;

      markUnsaved();
      renderLayoutBuilder();
      saveElementPositions();
      showToast(`Moved "${element.name}" to ${column} column`, 'success');
    }

    // Move element to other column
    async function moveToOtherColumn(elementId) {
      const element = layoutElements.find(el => el.id === elementId);
      if (!element || element.fixed) return;

      const newColumn = element.column === 'left' ? 'right' : 'left';
      const elementsInNewColumn = layoutElements.filter(el => el.column === newColumn);
      element.column = newColumn;
      element.order = elementsInNewColumn.length + 1;

      saveElementPositions();
      renderLayoutBuilder();

      // Auto-save to server
      await saveAllChanges();
      showToast(`Moved "${element.name}" to ${newColumn} column`, 'success');
    }

    // Toggle element visibility
    async function toggleElementVisibility(elementId) {
      const element = layoutElements.find(el => el.id === elementId);
      if (!element || element.fixed) return;

      element.hidden = !element.hidden;

      saveElementPositions();
      renderLayoutBuilder();

      // Auto-save to server
      await saveAllChanges();
      showToast(`${element.name} is now ${element.hidden ? 'hidden' : 'visible'}`, 'success');
    }

    // Delete element (hide it permanently)
    async function deleteElement(elementId) {
      const element = layoutElements.find(el => el.id === elementId);
      if (!element || element.fixed) return;

      if (!confirm(`Are you sure you want to remove "${element.name}" from the layout?`)) {
        return;
      }

      element.hidden = true;
      element.deleted = true;

      saveElementPositions();
      renderLayoutBuilder();

      // Auto-save to server
      showToast(`Saving changes...`, 'info');
      await saveAllChanges();
      showToast(`${element.name} removed and saved!`, 'success');
    }

    // Restore a deleted element
    async function restoreElement(elementId) {
      const element = layoutElements.find(el => el.id === elementId);
      if (!element) return;

      element.hidden = false;
      element.deleted = false;

      saveElementPositions();
      renderLayoutBuilder();

      // Auto-save to server
      showToast(`Restoring ${element.name}...`, 'info');
      await saveAllChanges();
      showToast(`${element.name} restored and saved!`, 'success');
    }

    // Save element positions to pageData
    function saveElementPositions() {
      pageData.layout.elements = layoutElements.map(el => ({
        id: el.id,
        column: el.column,
        order: el.order,
        hidden: el.hidden || false,
        deleted: el.deleted || false,
        settings: el.settings
      }));
    }

    // ==========================================
    // GALLERY IMAGE UPLOAD FUNCTIONS
    // ==========================================

    let currentGallerySlot = 0;

    function triggerGalleryUpload(slot) {
      currentGallerySlot = slot;
      document.getElementById('galleryFileInput').click();
    }

    async function handleGalleryFileUpload(input) {
      if (!input.files || !input.files[0]) return;

      const file = input.files[0];
      if (file.size > 5 * 1024 * 1024) {
        showToast('File too large. Max 5MB allowed.', 'error');
        return;
      }

      const formData = new FormData();
      formData.append('image', file);

      showToast('Uploading image...', 'info');

      try {
        const response = await fetch('/api/admin/upload', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${Admin.Auth.getToken()}` },
          body: formData
        });

        const result = await response.json();

        if (result.success) {
          // Update the gallery element settings
          const galleryElement = layoutElements.find(el => el.id === 'gallery');
          if (galleryElement) {
            if (!galleryElement.settings.images) {
              galleryElement.settings.images = [];
            }
            galleryElement.settings.images[currentGallerySlot] = result.url;

            // Re-render the edit panel
            document.getElementById('editPanelBody').innerHTML = getEditPanelContent(galleryElement);

            // Save changes
            saveElementPositions();
            await saveAllChanges();

            showToast('Image uploaded successfully!', 'success');
            renderLayoutBuilder();
          }
        } else {
          showToast(result.error || 'Upload failed', 'error');
        }
      } catch (error) {
        console.error('Upload error:', error);
        showToast('Upload failed. Please try again.', 'error');
      }

      input.value = '';
    }

    async function removeGalleryImage(slot) {
      const galleryElement = layoutElements.find(el => el.id === 'gallery');
      if (galleryElement && galleryElement.settings.images) {
        galleryElement.settings.images[slot] = null;

        // Re-render the edit panel
        document.getElementById('editPanelBody').innerHTML = getEditPanelContent(galleryElement);

        // Save changes
        saveElementPositions();
        await saveAllChanges();

        showToast('Image removed', 'success');
        renderLayoutBuilder();
      }
    }

    // ==========================================
    // EDIT PANEL FUNCTIONS
    // ==========================================

    function openEditPanel(elementId) {
      const element = layoutElements.find(el => el.id === elementId);
      if (!element) return;

      editingElement = element;

      document.getElementById('editPanelTitle').innerHTML = `
        <i class="fas ${element.icon}"></i>
        Edit: ${element.name}
      `;

      document.getElementById('editPanelBody').innerHTML = getEditPanelContent(element);
      document.getElementById('editPanelOverlay').classList.add('active');
    }

    function closeEditPanel(e) {
      if (e && e.target !== e.currentTarget) return;
      document.getElementById('editPanelOverlay').classList.remove('active');
      editingElement = null;
    }

    function getEditPanelContent(element) {
      switch (element.id) {
        case 'gallery':
          const images = element.settings.images || [];
          return `
            <div class="property-section">
              <div class="property-section-title">Product Gallery Images</div>
              <p style="font-size: 12px; color: #666; margin-bottom: 16px;">Upload up to 5 images for your product gallery.</p>

              <div id="galleryImagesContainer" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                ${[0,1,2,3,4].map(i => `
                  <div class="gallery-upload-slot" style="aspect-ratio: 1; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; position: relative; ${images[i] ? 'border-style: solid;' : ''}"
                       onclick="triggerGalleryUpload(${i})">
                    ${images[i] ? `
                      <img src="${images[i]}" style="width: 100%; height: 100%; object-fit: cover;">
                      <button onclick="event.stopPropagation(); removeGalleryImage(${i})"
                              style="position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; border-radius: 50%; background: #dc2626; color: white; border: none; cursor: pointer; font-size: 14px;"></button>
                    ` : `
                      <div style="text-align: center; color: #999;">
                        <i class="fas fa-plus" style="font-size: 20px;"></i>
                        <div style="font-size: 10px; margin-top: 4px;">Add</div>
                      </div>
                    `}
                  </div>
                `).join('')}
              </div>

              <input type="file" id="galleryFileInput" accept="image/*" style="display: none;" onchange="handleGalleryFileUpload(this)">

              <div style="font-size: 11px; color: #999;">
                <i class="fas fa-info-circle"></i> Supported: JPG, PNG, WebP. Max 5MB each.
              </div>
            </div>
          `;

        case 'selectShades':
          return `
            <div class="property-section">
              <div class="property-section-title">Button Settings</div>

              <div class="property-field">
                <label class="property-label">Button Text</label>
                <input type="text" class="property-input" id="editButtonText"
                       value="${element.settings.buttonText || 'Select your shades'}">
              </div>

              <div class="property-field">
                <label class="property-label">Button Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editButtonColor" value="${element.settings.buttonColor || '#8E6545'}">
                  <input type="text" class="property-input" id="editButtonColorText"
                         value="${element.settings.buttonColor || '#8E6545'}"
                         onchange="document.getElementById('editButtonColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Button Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editButtonTextColor" value="${element.settings.buttonTextColor || '#FFFFFF'}">
                  <input type="text" class="property-input" id="editButtonTextColorText"
                         value="${element.settings.buttonTextColor || '#FFFFFF'}"
                         onchange="document.getElementById('editButtonTextColor').value = this.value">
                </div>
              </div>

              <div class="property-toggle">
                <span class="toggle-label">Start Expanded</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editExpanded" ${element.settings.expanded ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Show Options</div>

              <div class="property-toggle">
                <span class="toggle-label">Width X Height</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowDimensions"
                         ${(element.settings.showOptions || []).includes('dimensions') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Room Label</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowRoomLabel"
                         ${(element.settings.showOptions || []).includes('roomLabel') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Shade Style</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowShadeStyle"
                         ${(element.settings.showOptions || []).includes('shadeStyle') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Mount Type</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowMountType"
                         ${(element.settings.showOptions || []).includes('mountType') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Control Type</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowControlType"
                         ${(element.settings.showOptions || []).includes('controlType') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Solar Type</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowSolarType"
                         ${(element.settings.showOptions || []).includes('solarType') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Hardware Type</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowHardwareType"
                         ${(element.settings.showOptions || []).includes('hardwareType') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Accessories</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowAccessories"
                         ${(element.settings.showOptions || []).includes('accessories') ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Font Family</label>
                <select class="property-input" id="editFontFamily">
                  <option value="inherit" ${element.settings.fontFamily === 'inherit' ? 'selected' : ''}>Default (Inherit)</option>
                  <option value="'Inter', sans-serif" ${element.settings.fontFamily === "'Inter', sans-serif" ? 'selected' : ''}>Inter</option>
                  <option value="'Roboto', sans-serif" ${element.settings.fontFamily === "'Roboto', sans-serif" ? 'selected' : ''}>Roboto</option>
                  <option value="'Open Sans', sans-serif" ${element.settings.fontFamily === "'Open Sans', sans-serif" ? 'selected' : ''}>Open Sans</option>
                  <option value="'Playfair Display', serif" ${element.settings.fontFamily === "'Playfair Display', serif" ? 'selected' : ''}>Playfair Display</option>
                  <option value="'Montserrat', sans-serif" ${element.settings.fontFamily === "'Montserrat', sans-serif" ? 'selected' : ''}>Montserrat</option>
                  <option value="'Lato', sans-serif" ${element.settings.fontFamily === "'Lato', sans-serif" ? 'selected' : ''}>Lato</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Font Size</label>
                <select class="property-input" id="editFontSize">
                  <option value="12px" ${element.settings.fontSize === '12px' ? 'selected' : ''}>12px - Small</option>
                  <option value="14px" ${element.settings.fontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.fontSize === '16px' ? 'selected' : ''}>16px - Medium</option>
                  <option value="18px" ${element.settings.fontSize === '18px' ? 'selected' : ''}>18px - Large</option>
                  <option value="20px" ${element.settings.fontSize === '20px' ? 'selected' : ''}>20px - XL</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Background Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editBackgroundColor" value="${element.settings.backgroundColor || '#FFFFFF'}">
                  <input type="text" class="property-input" id="editBackgroundColorText"
                         value="${element.settings.backgroundColor || '#FFFFFF'}"
                         onchange="document.getElementById('editBackgroundColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Border Radius</label>
                <select class="property-input" id="editBorderRadius">
                  <option value="0px" ${element.settings.borderRadius === '0px' ? 'selected' : ''}>None (0px)</option>
                  <option value="4px" ${element.settings.borderRadius === '4px' ? 'selected' : ''}>Small (4px)</option>
                  <option value="8px" ${element.settings.borderRadius === '8px' ? 'selected' : ''}>Medium (8px)</option>
                  <option value="12px" ${element.settings.borderRadius === '12px' ? 'selected' : ''}>Large (12px)</option>
                  <option value="20px" ${element.settings.borderRadius === '20px' ? 'selected' : ''}>Round (20px)</option>
                </select>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Dimensions Section (Width x Height)</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editDimensionsTitle"
                       value="${element.settings.dimensionsTitle || 'Width X Height'}">
              </div>

              <div class="property-field">
                <label class="property-label">Width Label</label>
                <input type="text" class="property-input" id="editWidthLabel"
                       value="${element.settings.widthLabel || 'Width'}">
              </div>

              <div class="property-field">
                <label class="property-label">Height Label</label>
                <input type="text" class="property-input" id="editHeightLabel"
                       value="${element.settings.heightLabel || 'Height'}">
              </div>

              <div class="property-field">
                <label class="property-label">Unit Label</label>
                <input type="text" class="property-input" id="editUnitLabel"
                       value="${element.settings.unitLabel || 'inches'}">
              </div>

              <div class="property-field">
                <label class="property-label">Min Width</label>
                <input type="number" class="property-input" id="editMinWidth"
                       value="${element.settings.minWidth || 12}">
              </div>

              <div class="property-field">
                <label class="property-label">Max Width</label>
                <input type="number" class="property-input" id="editMaxWidth"
                       value="${element.settings.maxWidth || 96}">
              </div>

              <div class="property-field">
                <label class="property-label">Min Height</label>
                <input type="number" class="property-input" id="editMinHeight"
                       value="${element.settings.minHeight || 12}">
              </div>

              <div class="property-field">
                <label class="property-label">Max Height</label>
                <input type="number" class="property-input" id="editMaxHeight"
                       value="${element.settings.maxHeight || 120}">
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Room Label Options</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editRoomLabelTitle"
                       value="${element.settings.roomLabelTitle || 'Room Label'}">
              </div>

              <div class="property-field">
                <label class="property-label">Placeholder Text</label>
                <input type="text" class="property-input" id="editRoomLabelPlaceholder"
                       value="${element.settings.roomLabelPlaceholder || 'e.g., Living Room'}">
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Shade Style Options</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Edit shade styles (Name | Price). One per line:</p>

              <textarea class="property-input" id="editShadeStyles" rows="6" style="resize: vertical; font-size: 12px;">${(element.settings.shadeStyles || [
                {name: 'Light Filtering', price: 0},
                {name: 'Room Darkening', price: 15},
                {name: 'Blackout', price: 25}
              ]).map(s => s.name + ' | $' + s.price).join('\n')}</textarea>

              <div class="property-field" style="margin-top: 12px;">
                <label class="property-label">Shade Style Label Font Size</label>
                <select class="property-input" id="editShadeStyleFontSize">
                  <option value="12px" ${element.settings.shadeStyleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="13px" ${element.settings.shadeStyleFontSize === '13px' ? 'selected' : ''}>13px</option>
                  <option value="14px" ${element.settings.shadeStyleFontSize === '14px' ? 'selected' : ''}>14px</option>
                  <option value="15px" ${element.settings.shadeStyleFontSize === '15px' ? 'selected' : ''}>15px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Option Background Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionBgColor" value="${element.settings.optionBgColor || '#f5f5f5'}">
                  <input type="text" class="property-input" value="${element.settings.optionBgColor || '#f5f5f5'}"
                         onchange="document.getElementById('editOptionBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Option Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedOptionColor" value="${element.settings.selectedOptionColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.selectedOptionColor || '#8E6545'}"
                         onchange="document.getElementById('editSelectedOptionColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Mount Type Options</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Edit mount types (Name | Description). One per line:</p>

              <textarea class="property-input" id="editMountTypes" rows="4" style="resize: vertical; font-size: 12px;">${(element.settings.mountTypes || [
                {name: 'Inside Mount', desc: 'Fits inside the window frame'},
                {name: 'Outside Mount', desc: 'Mounts on wall above window'}
              ]).map(m => m.name + ' | ' + m.desc).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Control Type Options</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Edit control types (Name | Price). One per line:</p>

              <textarea class="property-input" id="editControlTypes" rows="5" style="resize: vertical; font-size: 12px;">${(element.settings.controlTypes || [
                {name: 'Cordless', price: 0},
                {name: 'Bead Chain', price: -10},
                {name: 'Motorized', price: 75}
              ]).map(c => c.name + ' | $' + c.price).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Hardware Type Options</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Edit hardware types (Name | Price). One per line:</p>

              <textarea class="property-input" id="editHardwareTypes" rows="4" style="resize: vertical; font-size: 12px;">${(element.settings.hardwareTypes || [
                {name: 'Standard White', price: 0},
                {name: 'Brushed Nickel', price: 10},
                {name: 'Matte Black', price: 15}
              ]).map(h => h.name + ' | $' + h.price).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Accessories Options</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Edit accessories (Name | Price). One per line:</p>

              <textarea class="property-input" id="editAccessoriesOptions" rows="4" style="resize: vertical; font-size: 12px;">${(element.settings.accessoriesOptions || [
                {name: 'None', price: 0},
                {name: 'Valance', price: 20},
                {name: 'Side Channels', price: 35}
              ]).map(a => a.name + ' | $' + a.price).join('\n')}</textarea>
            </div>
          `;

        case 'addToCart':
          return `
            <div class="property-section">
              <div class="property-section-title">Button Settings</div>

              <div class="property-field">
                <label class="property-label">Button Text</label>
                <input type="text" class="property-input" id="editButtonText"
                       value="${element.settings.buttonText || 'Add to Cart'}">
              </div>

              <div class="property-field">
                <label class="property-label">Button Background Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editButtonColor" value="${element.settings.buttonColor || '#8E6545'}">
                  <input type="text" class="property-input" id="editButtonColorText"
                         value="${element.settings.buttonColor || '#8E6545'}"
                         onchange="document.getElementById('editButtonColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Button Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editButtonTextColor" value="${element.settings.buttonTextColor || '#FFFFFF'}">
                  <input type="text" class="property-input" id="editButtonTextColorText"
                         value="${element.settings.buttonTextColor || '#FFFFFF'}"
                         onchange="document.getElementById('editButtonTextColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography</div>

              <div class="property-field">
                <label class="property-label">Font Family</label>
                <select class="property-input" id="editFontFamily">
                  <option value="inherit" ${element.settings.fontFamily === 'inherit' ? 'selected' : ''}>Default (Inherit)</option>
                  <option value="'Inter', sans-serif" ${element.settings.fontFamily === "'Inter', sans-serif" ? 'selected' : ''}>Inter</option>
                  <option value="'Roboto', sans-serif" ${element.settings.fontFamily === "'Roboto', sans-serif" ? 'selected' : ''}>Roboto</option>
                  <option value="'Open Sans', sans-serif" ${element.settings.fontFamily === "'Open Sans', sans-serif" ? 'selected' : ''}>Open Sans</option>
                  <option value="'Montserrat', sans-serif" ${element.settings.fontFamily === "'Montserrat', sans-serif" ? 'selected' : ''}>Montserrat</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Font Size</label>
                <select class="property-input" id="editFontSize">
                  <option value="12px" ${element.settings.fontSize === '12px' ? 'selected' : ''}>12px - Small</option>
                  <option value="14px" ${element.settings.fontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.fontSize === '16px' ? 'selected' : ''}>16px - Medium</option>
                  <option value="18px" ${element.settings.fontSize === '18px' ? 'selected' : ''}>18px - Large</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Font Weight</label>
                <select class="property-input" id="editFontWeight">
                  <option value="400" ${element.settings.fontWeight === '400' ? 'selected' : ''}>Normal (400)</option>
                  <option value="500" ${element.settings.fontWeight === '500' ? 'selected' : ''}>Medium (500)</option>
                  <option value="600" ${element.settings.fontWeight === '600' ? 'selected' : ''}>Semi-Bold (600)</option>
                  <option value="700" ${element.settings.fontWeight === '700' ? 'selected' : ''}>Bold (700)</option>
                </select>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Button Style</div>

              <div class="property-field">
                <label class="property-label">Border Radius</label>
                <select class="property-input" id="editBorderRadius">
                  <option value="0px" ${element.settings.borderRadius === '0px' ? 'selected' : ''}>None (0px)</option>
                  <option value="4px" ${element.settings.borderRadius === '4px' ? 'selected' : ''}>Small (4px)</option>
                  <option value="8px" ${element.settings.borderRadius === '8px' ? 'selected' : ''}>Medium (8px)</option>
                  <option value="20px" ${element.settings.borderRadius === '20px' ? 'selected' : ''}>Rounded (20px)</option>
                  <option value="50px" ${element.settings.borderRadius === '50px' ? 'selected' : ''}>Pill (50px)</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Padding</label>
                <select class="property-input" id="editPadding">
                  <option value="8px 16px" ${element.settings.padding === '8px 16px' ? 'selected' : ''}>Small</option>
                  <option value="12px 24px" ${element.settings.padding === '12px 24px' ? 'selected' : ''}>Medium</option>
                  <option value="16px 32px" ${element.settings.padding === '16px 32px' ? 'selected' : ''}>Large</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Hover Background Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editHoverColor" value="${element.settings.hoverColor || '#7a5639'}">
                  <input type="text" class="property-input" id="editHoverColorText"
                         value="${element.settings.hoverColor || '#7a5639'}"
                         onchange="document.getElementById('editHoverColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'requestQuote':
          return `
            <div class="property-section">
              <div class="property-section-title">Request Quote Button Settings</div>

              <div class="property-field">
                <label class="property-label">Button Text</label>
                <input type="text" class="property-input" id="editButtonText"
                       value="${element.settings.buttonText || 'Request for Quote'}">
              </div>

              <div class="property-field">
                <label class="property-label">Button Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editButtonColor" value="${element.settings.buttonColor || '#4A5568'}">
                  <input type="text" class="property-input" id="editButtonColorText"
                         value="${element.settings.buttonColor || '#4A5568'}">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Button Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editButtonTextColor" value="${element.settings.buttonTextColor || '#FFFFFF'}">
                  <input type="text" class="property-input" id="editButtonTextColorText"
                         value="${element.settings.buttonTextColor || '#FFFFFF'}">
                </div>
              </div>

              <div class="property-toggle">
                <span class="toggle-label">Show Icon</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowIcon" ${element.settings.showIcon !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'buyWithShopPay':
          return `
            <div class="property-section">
              <div class="property-section-title">Express Checkout Options</div>

              <div class="property-toggle">
                <span class="toggle-label">Enable Shop Pay</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editEnabled" ${element.settings.enabled !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 12px;">
                <span class="toggle-label">Show Apple Pay</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowApplePay" ${element.settings.showApplePay !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Google Pay</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowGooglePay" ${element.settings.showGooglePay !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show PayPal</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowPayPal" ${element.settings.showPayPal !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'quantity':
          return `
            <div class="property-section">
              <div class="property-section-title">Quantity Settings</div>

              <div class="property-field">
                <label class="property-label">Minimum Quantity</label>
                <input type="number" class="property-input" id="editMinQuantity" min="1"
                       value="${element.settings.minQuantity || 1}">
              </div>

              <div class="property-field">
                <label class="property-label">Maximum Quantity</label>
                <input type="number" class="property-input" id="editMaxQuantity" min="1"
                       value="${element.settings.maxQuantity || 100}">
              </div>

              <div class="property-field">
                <label class="property-label">Default Quantity</label>
                <input type="number" class="property-input" id="editDefaultQuantity" min="1"
                       value="${element.settings.defaultQuantity || 1}">
              </div>
            </div>
          `;

        case 'productTitle':
          return `
            <div class="property-section">
              <div class="property-section-title">Title Settings</div>

              <div class="property-field">
                <label class="property-label">Title Text</label>
                <input type="text" class="property-input" id="editTitle"
                       value="${element.settings.title || ''}">
              </div>

              <div class="property-field">
                <label class="property-label">Description</label>
                <textarea class="property-input" id="editDescription" rows="3"
                          style="resize: vertical;">${element.settings.description || ''}</textarea>
              </div>
            </div>
          `;

        case 'trustBadges':
          return `
            <div class="property-section">
              <div class="property-section-title">Trust Badges Settings</div>

              <div class="property-toggle">
                <span class="toggle-label">Show Free Shipping Badge</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowShipping" ${element.settings.showShipping !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Warranty Badge</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowWarranty" ${element.settings.showWarranty !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Returns Badge</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowReturns" ${element.settings.showReturns !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'deliveryInfo':
          return `
            <div class="property-section">
              <div class="property-section-title">Delivery Information Settings</div>

              <div class="property-toggle">
                <span class="toggle-label">Show Delivery Estimate</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowEstimate" ${element.settings.showEstimate !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Free Shipping Message</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowFreeShipping" ${element.settings.showFreeShipping !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'dimensions':
          return `
            <div class="property-section">
              <div class="property-section-title">Dimensions Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Dimensions'}">
              </div>

              <div class="property-field">
                <label class="property-label">Width Label</label>
                <input type="text" class="property-input" id="editWidthLabel" value="${element.settings.widthLabel || 'Width'}">
              </div>

              <div class="property-field">
                <label class="property-label">Height Label</label>
                <input type="text" class="property-input" id="editHeightLabel" value="${element.settings.heightLabel || 'Height'}">
              </div>

              <div class="property-field">
                <label class="property-label">Unit</label>
                <select class="property-input" id="editUnit">
                  <option value="inches" ${element.settings.unit === 'inches' ? 'selected' : ''}>Inches</option>
                  <option value="cm" ${element.settings.unit === 'cm' ? 'selected' : ''}>Centimeters</option>
                </select>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="13px" ${element.settings.titleFontSize === '13px' ? 'selected' : ''}>13px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="15px" ${element.settings.titleFontSize === '15px' ? 'selected' : ''}>15px</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Input Border Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editInputBorderColor" value="${element.settings.inputBorderColor || '#E8E4E0'}">
                  <input type="text" class="property-input" value="${element.settings.inputBorderColor || '#E8E4E0'}" onchange="document.getElementById('editInputBorderColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'roomLabel':
          return `
            <div class="property-section">
              <div class="property-section-title">Room Label Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Room Label'}">
              </div>

              <div class="property-field">
                <label class="property-label">Placeholder Text</label>
                <input type="text" class="property-input" id="editPlaceholder" value="${element.settings.placeholder || 'e.g., Living Room, Bedroom'}">
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'shadeStyle':
          return `
            <div class="property-section">
              <div class="property-section-title">Shade Style Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Shade Style'}">
              </div>

              <div class="property-field">
                <label class="property-label">Options (Name | Price per line)</label>
                <textarea class="property-input" id="editOptions" rows="5" style="resize: vertical;" placeholder="Light Filtering | 0&#10;Room Darkening | 15&#10;Blackout | 25">${(element.settings.options || []).map(o => o.name + ' | ' + o.price).join('\\n')}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Option Font Size</label>
                <select class="property-input" id="editOptionFontSize">
                  <option value="11px" ${element.settings.optionFontSize === '11px' ? 'selected' : ''}>11px</option>
                  <option value="12px" ${element.settings.optionFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="13px" ${element.settings.optionFontSize === '13px' ? 'selected' : ''}>13px - Default</option>
                  <option value="14px" ${element.settings.optionFontSize === '14px' ? 'selected' : ''}>14px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Option Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionColor" value="${element.settings.optionColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.optionColor || '#333333'}" onchange="document.getElementById('editOptionColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Option Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionBgColor" value="${element.settings.optionBgColor || '#ffffff'}">
                  <input type="text" class="property-input" value="${element.settings.optionBgColor || '#ffffff'}" onchange="document.getElementById('editOptionBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedBgColor" value="${element.settings.selectedBgColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.selectedBgColor || '#8E6545'}" onchange="document.getElementById('editSelectedBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedTextColor" value="${element.settings.selectedTextColor || '#ffffff'}">
                  <input type="text" class="property-input" value="${element.settings.selectedTextColor || '#ffffff'}" onchange="document.getElementById('editSelectedTextColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Price Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editPriceColor" value="${element.settings.priceColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.priceColor || '#8E6545'}" onchange="document.getElementById('editPriceColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'mountType':
          return `
            <div class="property-section">
              <div class="property-section-title">Mount Type Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Mount Type'}">
              </div>

              <div class="property-field">
                <label class="property-label">Options (Name | Description per line)</label>
                <textarea class="property-input" id="editOptions" rows="4" style="resize: vertical;" placeholder="Inside Mount | Fits inside window frame&#10;Outside Mount | Mounts on wall above window">${(element.settings.options || []).map(o => o.name + ' | ' + (o.description || '')).join('\\n')}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Option Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionColor" value="${element.settings.optionColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.optionColor || '#333333'}" onchange="document.getElementById('editOptionColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedBgColor" value="${element.settings.selectedBgColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.selectedBgColor || '#8E6545'}" onchange="document.getElementById('editSelectedBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedTextColor" value="${element.settings.selectedTextColor || '#ffffff'}">
                  <input type="text" class="property-input" value="${element.settings.selectedTextColor || '#ffffff'}" onchange="document.getElementById('editSelectedTextColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'controlType':
          return `
            <div class="property-section">
              <div class="property-section-title">Control Type Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Control Type'}">
              </div>

              <div class="property-field">
                <label class="property-label">Options (Name | Price per line)</label>
                <textarea class="property-input" id="editOptions" rows="4" style="resize: vertical;" placeholder="Bead Chain (Manual) | 0&#10;Cordless | 20&#10;Motorized | 75">${(element.settings.options || []).map(o => o.name + ' | ' + o.price).join('\\n')}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Option Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionColor" value="${element.settings.optionColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.optionColor || '#333333'}" onchange="document.getElementById('editOptionColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedBgColor" value="${element.settings.selectedBgColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.selectedBgColor || '#8E6545'}" onchange="document.getElementById('editSelectedBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Price Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editPriceColor" value="${element.settings.priceColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.priceColor || '#8E6545'}" onchange="document.getElementById('editPriceColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'hardwareType':
          return `
            <div class="property-section">
              <div class="property-section-title">Hardware Type Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Hardware Type'}">
              </div>

              <div class="property-field">
                <label class="property-label">Options (Name | Price per line)</label>
                <textarea class="property-input" id="editOptions" rows="4" style="resize: vertical;" placeholder="Standard Valance | 0&#10;Fabric Wrapped | 15&#10;No Valance | -5">${(element.settings.options || []).map(o => o.name + ' | ' + o.price).join('\\n')}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Option Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionColor" value="${element.settings.optionColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.optionColor || '#333333'}" onchange="document.getElementById('editOptionColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Selected Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSelectedBgColor" value="${element.settings.selectedBgColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.selectedBgColor || '#8E6545'}" onchange="document.getElementById('editSelectedBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Price Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editPriceColor" value="${element.settings.priceColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.priceColor || '#8E6545'}" onchange="document.getElementById('editPriceColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'accessories':
          return `
            <div class="property-section">
              <div class="property-section-title">Accessories Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle" value="${element.settings.sectionTitle || 'Accessories'}">
              </div>

              <div class="property-field">
                <label class="property-label">Options (Name | Price per line)</label>
                <textarea class="property-input" id="editOptions" rows="4" style="resize: vertical;" placeholder="Hold Down Brackets | 5&#10;Extension Brackets | 8&#10;Cord Tensioner | 3">${(element.settings.options || []).map(o => o.name + ' | ' + o.price).join('\\n')}</textarea>
              </div>

              <div class="property-toggle" style="margin-top: 12px;">
                <span class="toggle-label">Allow Multiple Selection</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editMultiSelect" ${element.settings.multiSelect !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography & Styling</div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="12px" ${element.settings.titleFontSize === '12px' ? 'selected' : ''}>12px</option>
                  <option value="14px" ${element.settings.titleFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.titleColor || '#333333'}" onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Option Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOptionColor" value="${element.settings.optionColor || '#333333'}">
                  <input type="text" class="property-input" value="${element.settings.optionColor || '#333333'}" onchange="document.getElementById('editOptionColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Checkbox Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editCheckboxColor" value="${element.settings.checkboxColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.checkboxColor || '#8E6545'}" onchange="document.getElementById('editCheckboxColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Price Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editPriceColor" value="${element.settings.priceColor || '#8E6545'}">
                  <input type="text" class="property-input" value="${element.settings.priceColor || '#8E6545'}" onchange="document.getElementById('editPriceColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor === 'transparent' ? '#ffffff' : (element.settings.sectionBgColor || '#ffffff')}">
                  <input type="text" class="property-input" value="${element.settings.sectionBgColor || 'transparent'}" onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'productDetails':
          return `
            <div class="property-section">
              <div class="property-section-title">Product Details Settings</div>

              <div class="property-toggle">
                <span class="toggle-label">Show Description</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowDescription" ${element.settings.showDescription !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Materials</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowMaterials" ${element.settings.showMaterials !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Care Instructions</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowCareInstructions" ${element.settings.showCareInstructions !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'specifications':
          return `
            <div class="property-section">
              <div class="property-section-title">Specifications Settings</div>

              <div class="property-toggle">
                <span class="toggle-label">Show Material Info</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowMaterial" ${element.settings.showMaterial !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Dimensions</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowSpecDimensions" ${element.settings.showDimensions !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Weight</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowWeight" ${element.settings.showWeight !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'features':
          return `
            <div class="property-section">
              <div class="property-section-title">Feature Badges</div>
              <p style="font-size: 12px; color: #666; margin-bottom: 12px;">Edit the feature badges displayed on the product page.</p>

              <div class="property-field">
                <label class="property-label">Badge 1</label>
                <input type="text" class="property-input" id="editBadge1"
                       value="${(element.settings.badges || [])[0] || 'Energy Efficient'}">
              </div>

              <div class="property-field">
                <label class="property-label">Badge 2</label>
                <input type="text" class="property-input" id="editBadge2"
                       value="${(element.settings.badges || [])[1] || 'Custom Sizes'}">
              </div>

              <div class="property-field">
                <label class="property-label">Badge 3</label>
                <input type="text" class="property-input" id="editBadge3"
                       value="${(element.settings.badges || [])[2] || 'Easy Install'}">
              </div>
            </div>
          `;

        case 'reviews':
          return `
            <div class="property-section">
              <div class="property-section-title">Reviews Settings</div>

              <div class="property-toggle">
                <span class="toggle-label">Show Rating Stars</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowRating" ${element.settings.showRating !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Review Count</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowCount" ${element.settings.showCount !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          `;

        case 'price':
          return `
            <div class="property-section">
              <div class="property-section-title">Price Display Settings</div>

              <div class="property-toggle">
                <span class="toggle-label">Show Original Price</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowOriginalPrice" ${element.settings.showOriginalPrice !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-toggle" style="margin-top: 8px;">
                <span class="toggle-label">Show Discount</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowDiscount" ${element.settings.showDiscount !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-field" style="margin-top: 12px;">
                <label class="property-label">Currency</label>
                <select class="property-input" id="editCurrency">
                  <option value="USD" ${element.settings.currency === 'USD' ? 'selected' : ''}>USD ($)</option>
                  <option value="EUR" ${element.settings.currency === 'EUR' ? 'selected' : ''}>EUR ()</option>
                  <option value="GBP" ${element.settings.currency === 'GBP' ? 'selected' : ''}>GBP ()</option>
                  <option value="INR" ${element.settings.currency === 'INR' ? 'selected' : ''}>INR ()</option>
                  <option value="AUD" ${element.settings.currency === 'AUD' ? 'selected' : ''}>AUD (A$)</option>
                  <option value="CAD" ${element.settings.currency === 'CAD' ? 'selected' : ''}>CAD (C$)</option>
                </select>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Price Label</div>

              <div class="property-toggle">
                <span class="toggle-label">Show "Base Price:" Label</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowPriceLabel" ${element.settings.showPriceLabel !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-field" style="margin-top: 8px;">
                <label class="property-label">Label Text</label>
                <input type="text" class="property-input" id="editPriceLabelText" value="${element.settings.priceLabelText || 'Base Price:'}" placeholder="Base Price:">
              </div>

              <div class="property-field">
                <label class="property-label">Label Position</label>
                <select class="property-input" id="editPriceLabelPosition">
                  <option value="left" ${element.settings.priceLabelPosition === 'left' ? 'selected' : ''}>Left of Price</option>
                  <option value="above" ${element.settings.priceLabelPosition === 'above' ? 'selected' : ''}>Above Price</option>
                  <option value="none" ${element.settings.priceLabelPosition === 'none' ? 'selected' : ''}>Hidden</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Label Font Size</label>
                <select class="property-input" id="editPriceLabelFontSize">
                  <option value="12px" ${element.settings.priceLabelFontSize === '12px' ? 'selected' : ''}>12px - Small</option>
                  <option value="14px" ${element.settings.priceLabelFontSize === '14px' ? 'selected' : ''}>14px - Default</option>
                  <option value="16px" ${element.settings.priceLabelFontSize === '16px' ? 'selected' : ''}>16px - Medium</option>
                  <option value="18px" ${element.settings.priceLabelFontSize === '18px' ? 'selected' : ''}>18px - Large</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Label Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editPriceLabelColor" value="${element.settings.priceLabelColor || '#666666'}">
                  <input type="text" class="property-input" id="editPriceLabelColorText"
                         value="${element.settings.priceLabelColor || '#666666'}"
                         onchange="document.getElementById('editPriceLabelColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Price Typography</div>

              <div class="property-field">
                <label class="property-label">Price Font Family</label>
                <select class="property-input" id="editPriceFontFamily">
                  <option value="inherit" ${element.settings.priceFontFamily === 'inherit' ? 'selected' : ''}>Default (Inherit)</option>
                  <option value="'Inter', sans-serif" ${element.settings.priceFontFamily === "'Inter', sans-serif" ? 'selected' : ''}>Inter</option>
                  <option value="'Roboto', sans-serif" ${element.settings.priceFontFamily === "'Roboto', sans-serif" ? 'selected' : ''}>Roboto</option>
                  <option value="'Open Sans', sans-serif" ${element.settings.priceFontFamily === "'Open Sans', sans-serif" ? 'selected' : ''}>Open Sans</option>
                  <option value="'Montserrat', sans-serif" ${element.settings.priceFontFamily === "'Montserrat', sans-serif" ? 'selected' : ''}>Montserrat</option>
                  <option value="'Playfair Display', serif" ${element.settings.priceFontFamily === "'Playfair Display', serif" ? 'selected' : ''}>Playfair Display</option>
                  <option value="'Lato', sans-serif" ${element.settings.priceFontFamily === "'Lato', sans-serif" ? 'selected' : ''}>Lato</option>
                  <option value="'Poppins', sans-serif" ${element.settings.priceFontFamily === "'Poppins', sans-serif" ? 'selected' : ''}>Poppins</option>
                  <option value="'Oswald', sans-serif" ${element.settings.priceFontFamily === "'Oswald', sans-serif" ? 'selected' : ''}>Oswald</option>
                  <option value="'Raleway', sans-serif" ${element.settings.priceFontFamily === "'Raleway', sans-serif" ? 'selected' : ''}>Raleway</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Price Font Size</label>
                <select class="property-input" id="editPriceFontSize">
                  <option value="18px" ${element.settings.priceFontSize === '18px' ? 'selected' : ''}>18px - Small</option>
                  <option value="20px" ${element.settings.priceFontSize === '20px' ? 'selected' : ''}>20px</option>
                  <option value="22px" ${element.settings.priceFontSize === '22px' ? 'selected' : ''}>22px</option>
                  <option value="24px" ${element.settings.priceFontSize === '24px' ? 'selected' : ''}>24px - Default</option>
                  <option value="28px" ${element.settings.priceFontSize === '28px' ? 'selected' : ''}>28px</option>
                  <option value="32px" ${element.settings.priceFontSize === '32px' ? 'selected' : ''}>32px - Large</option>
                  <option value="36px" ${element.settings.priceFontSize === '36px' ? 'selected' : ''}>36px</option>
                  <option value="40px" ${element.settings.priceFontSize === '40px' ? 'selected' : ''}>40px - XL</option>
                  <option value="48px" ${element.settings.priceFontSize === '48px' ? 'selected' : ''}>48px - XXL</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Price Font Weight</label>
                <select class="property-input" id="editPriceFontWeight">
                  <option value="400" ${element.settings.priceFontWeight === '400' ? 'selected' : ''}>Normal (400)</option>
                  <option value="500" ${element.settings.priceFontWeight === '500' ? 'selected' : ''}>Medium (500)</option>
                  <option value="600" ${element.settings.priceFontWeight === '600' ? 'selected' : ''}>Semi-Bold (600)</option>
                  <option value="700" ${element.settings.priceFontWeight === '700' ? 'selected' : ''}>Bold (700)</option>
                  <option value="800" ${element.settings.priceFontWeight === '800' ? 'selected' : ''}>Extra Bold (800)</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Price Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editPriceColor" value="${element.settings.priceColor || '#1a1a1a'}">
                  <input type="text" class="property-input" id="editPriceColorText"
                         value="${element.settings.priceColor || '#1a1a1a'}"
                         onchange="document.getElementById('editPriceColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Original Price Style (Strikethrough)</div>

              <div class="property-field">
                <label class="property-label">Original Price Font Size</label>
                <select class="property-input" id="editOriginalPriceFontSize">
                  <option value="14px" ${element.settings.originalPriceFontSize === '14px' ? 'selected' : ''}>14px - Small</option>
                  <option value="16px" ${element.settings.originalPriceFontSize === '16px' ? 'selected' : ''}>16px</option>
                  <option value="18px" ${element.settings.originalPriceFontSize === '18px' ? 'selected' : ''}>18px - Default</option>
                  <option value="20px" ${element.settings.originalPriceFontSize === '20px' ? 'selected' : ''}>20px</option>
                  <option value="22px" ${element.settings.originalPriceFontSize === '22px' ? 'selected' : ''}>22px</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Original Price Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editOriginalPriceColor" value="${element.settings.originalPriceColor || '#999999'}">
                  <input type="text" class="property-input" id="editOriginalPriceColorText"
                         value="${element.settings.originalPriceColor || '#999999'}"
                         onchange="document.getElementById('editOriginalPriceColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Discount Badge Style</div>

              <div class="property-field">
                <label class="property-label">Discount Badge Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editDiscountBgColor" value="${element.settings.discountBgColor || '#e53e3e'}">
                  <input type="text" class="property-input" id="editDiscountBgColorText"
                         value="${element.settings.discountBgColor || '#e53e3e'}"
                         onchange="document.getElementById('editDiscountBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Discount Badge Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editDiscountTextColor" value="${element.settings.discountTextColor || '#ffffff'}">
                  <input type="text" class="property-input" id="editDiscountTextColorText"
                         value="${element.settings.discountTextColor || '#ffffff'}"
                         onchange="document.getElementById('editDiscountTextColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Discount Font Size</label>
                <select class="property-input" id="editDiscountFontSize">
                  <option value="10px" ${element.settings.discountFontSize === '10px' ? 'selected' : ''}>10px</option>
                  <option value="11px" ${element.settings.discountFontSize === '11px' ? 'selected' : ''}>11px</option>
                  <option value="12px" ${element.settings.discountFontSize === '12px' ? 'selected' : ''}>12px - Default</option>
                  <option value="13px" ${element.settings.discountFontSize === '13px' ? 'selected' : ''}>13px</option>
                  <option value="14px" ${element.settings.discountFontSize === '14px' ? 'selected' : ''}>14px</option>
                </select>
              </div>
            </div>
          `;

        case 'productDetails':
          return `
            <div class="property-section">
              <div class="property-section-title">Product Details Section</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle"
                       value="${element.settings.sectionTitle || 'Product Details'}">
              </div>

              <div class="property-field">
                <label class="property-label">Features Title</label>
                <input type="text" class="property-input" id="editFeaturesTitle"
                       value="${element.settings.featuresTitle || 'Features'}">
              </div>

              <div class="property-field">
                <label class="property-label">Features List (one per line)</label>
                <textarea class="property-input" id="editFeaturesList" rows="5" style="resize: vertical;">${(element.settings.features || []).join('\n')}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Care & Warranty</div>

              <div class="property-field">
                <label class="property-label">Care Instructions Title</label>
                <input type="text" class="property-input" id="editCareTitle"
                       value="${element.settings.careTitle || 'Care Instructions'}">
              </div>

              <div class="property-field">
                <label class="property-label">Care Instructions Text</label>
                <textarea class="property-input" id="editCareText" rows="3" style="resize: vertical;">${element.settings.careText || ''}</textarea>
              </div>

              <div class="property-field">
                <label class="property-label">Warranty Title</label>
                <input type="text" class="property-input" id="editWarrantyTitle"
                       value="${element.settings.warrantyTitle || 'Warranty'}">
              </div>

              <div class="property-field">
                <label class="property-label">Warranty Text</label>
                <textarea class="property-input" id="editWarrantyText" rows="3" style="resize: vertical;">${element.settings.warrantyText || ''}</textarea>
              </div>
            </div>
          `;

        case 'productCatalogs':
          return `
            <div class="property-section">
              <div class="property-section-title">Product Catalogs Section</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle"
                       value="${element.settings.sectionTitle || 'Product Catalogs'}">
              </div>

              <div class="property-field">
                <label class="property-label">Product Features Title</label>
                <input type="text" class="property-input" id="editProductFeaturesTitle"
                       value="${element.settings.productFeaturesTitle || 'Product Features'}">
              </div>

              <div class="property-field">
                <label class="property-label">Product Features Description</label>
                <textarea class="property-input" id="editProductFeaturesText" rows="4" style="resize: vertical;">${element.settings.productFeaturesText || ''}</textarea>
              </div>

              <div class="property-field">
                <label class="property-label">Side Cover Colors</label>
                <input type="text" class="property-input" id="editSideCoverColors"
                       value="${element.settings.sideCoverColors || 'White, Gray, Black'}">
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Valance Options</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Format: Name | Description (one per line)</p>
              <textarea class="property-input" id="editValanceOptions" rows="7" style="resize: vertical; font-size: 12px;">${(element.settings.valanceOptions || []).map(v => v.name + ' | ' + v.desc).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Bottom Rail Options</div>
              <textarea class="property-input" id="editBottomRailOptions" rows="5" style="resize: vertical; font-size: 12px;">${(element.settings.bottomRailOptions || []).map(v => v.name + ' | ' + v.desc).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Control Systems</div>
              <textarea class="property-input" id="editControlSystems" rows="6" style="resize: vertical; font-size: 12px;">${(element.settings.controlSystems || []).map(v => v.name + ' | ' + v.desc).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Configuration Features</div>
              <textarea class="property-input" id="editConfigFeatures" rows="5" style="resize: vertical; font-size: 12px;">${(element.settings.configFeatures || []).map(v => v.name + ' | ' + v.desc).join('\n')}</textarea>
            </div>

            <div class="property-section">
              <div class="property-section-title">Light Blocker Options</div>
              <textarea class="property-input" id="editLightBlockerOptions" rows="3" style="resize: vertical; font-size: 12px;">${(element.settings.lightBlockerOptions || []).map(v => v.name + ' | ' + v.desc).join('\n')}</textarea>
            </div>
          `;

        case 'productTypeSpecs':
          return `
            <div class="property-section">
              <div class="property-section-title">Product Type Specifications</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle"
                       value="${element.settings.sectionTitle || 'Product Type Specifications'}">
              </div>

              <div class="property-field">
                <label class="property-label">Table Headers (comma separated)</label>
                <input type="text" class="property-input" id="editTableHeaders"
                       value="${(element.settings.tableHeaders || []).join(', ')}">
              </div>

              <div class="property-field">
                <label class="property-label">Table Rows (one row per line, columns separated by |)</label>
                <textarea class="property-input" id="editTableRows" rows="6" style="resize: vertical; font-size: 12px;">${(element.settings.tableRows || []).map(row => row.join(' | ')).join('\n')}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography Settings</div>

              <div class="property-field">
                <label class="property-label">Title Font Family</label>
                <select class="property-input" id="editTitleFontFamily">
                  <option value="inherit" ${element.settings.titleFontFamily === 'inherit' ? 'selected' : ''}>Default (Inherit)</option>
                  <option value="'Inter', sans-serif" ${element.settings.titleFontFamily === "'Inter', sans-serif" ? 'selected' : ''}>Inter</option>
                  <option value="'Roboto', sans-serif" ${element.settings.titleFontFamily === "'Roboto', sans-serif" ? 'selected' : ''}>Roboto</option>
                  <option value="'Open Sans', sans-serif" ${element.settings.titleFontFamily === "'Open Sans', sans-serif" ? 'selected' : ''}>Open Sans</option>
                  <option value="'Playfair Display', serif" ${element.settings.titleFontFamily === "'Playfair Display', serif" ? 'selected' : ''}>Playfair Display</option>
                  <option value="'Montserrat', sans-serif" ${element.settings.titleFontFamily === "'Montserrat', sans-serif" ? 'selected' : ''}>Montserrat</option>
                  <option value="'Lato', sans-serif" ${element.settings.titleFontFamily === "'Lato', sans-serif" ? 'selected' : ''}>Lato</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px - Small</option>
                  <option value="18px" ${element.settings.titleFontSize === '18px' ? 'selected' : ''}>18px - Medium</option>
                  <option value="20px" ${element.settings.titleFontSize === '20px' ? 'selected' : ''}>20px - Default</option>
                  <option value="24px" ${element.settings.titleFontSize === '24px' ? 'selected' : ''}>24px - Large</option>
                  <option value="28px" ${element.settings.titleFontSize === '28px' ? 'selected' : ''}>28px - XL</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#1a1a1a'}">
                  <input type="text" class="property-input" id="editTitleColorText"
                         value="${element.settings.titleColor || '#1a1a1a'}"
                         onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Font Family</label>
                <select class="property-input" id="editTableFontFamily">
                  <option value="inherit" ${element.settings.tableFontFamily === 'inherit' ? 'selected' : ''}>Default (Inherit)</option>
                  <option value="'Inter', sans-serif" ${element.settings.tableFontFamily === "'Inter', sans-serif" ? 'selected' : ''}>Inter</option>
                  <option value="'Roboto', sans-serif" ${element.settings.tableFontFamily === "'Roboto', sans-serif" ? 'selected' : ''}>Roboto</option>
                  <option value="'Open Sans', sans-serif" ${element.settings.tableFontFamily === "'Open Sans', sans-serif" ? 'selected' : ''}>Open Sans</option>
                  <option value="monospace" ${element.settings.tableFontFamily === "monospace" ? 'selected' : ''}>Monospace</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Table Font Size</label>
                <select class="property-input" id="editTableFontSize">
                  <option value="12px" ${element.settings.tableFontSize === '12px' ? 'selected' : ''}>12px - Small</option>
                  <option value="13px" ${element.settings.tableFontSize === '13px' ? 'selected' : ''}>13px - Default</option>
                  <option value="14px" ${element.settings.tableFontSize === '14px' ? 'selected' : ''}>14px - Medium</option>
                  <option value="15px" ${element.settings.tableFontSize === '15px' ? 'selected' : ''}>15px - Large</option>
                  <option value="16px" ${element.settings.tableFontSize === '16px' ? 'selected' : ''}>16px - XL</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Table Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTableTextColor" value="${element.settings.tableTextColor || '#333333'}">
                  <input type="text" class="property-input" id="editTableTextColorText"
                         value="${element.settings.tableTextColor || '#333333'}"
                         onchange="document.getElementById('editTableTextColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Background & Styling</div>

              <div class="property-field">
                <label class="property-label">Section Background Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor || '#ffffff'}">
                  <input type="text" class="property-input" id="editSectionBgColorText"
                         value="${element.settings.sectionBgColor || '#ffffff'}"
                         onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Header Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editHeaderBgColor" value="${element.settings.headerBgColor || '#f5f5f5'}">
                  <input type="text" class="property-input" id="editHeaderBgColorText"
                         value="${element.settings.headerBgColor || '#f5f5f5'}"
                         onchange="document.getElementById('editHeaderBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Header Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editHeaderTextColor" value="${element.settings.headerTextColor || '#1a1a1a'}">
                  <input type="text" class="property-input" id="editHeaderTextColorText"
                         value="${element.settings.headerTextColor || '#1a1a1a'}"
                         onchange="document.getElementById('editHeaderTextColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Row Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editRowBgColor" value="${element.settings.rowBgColor || '#ffffff'}">
                  <input type="text" class="property-input" id="editRowBgColorText"
                         value="${element.settings.rowBgColor || '#ffffff'}"
                         onchange="document.getElementById('editRowBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Alternate Row Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editAltRowBgColor" value="${element.settings.altRowBgColor || '#f9f9f9'}">
                  <input type="text" class="property-input" id="editAltRowBgColorText"
                         value="${element.settings.altRowBgColor || '#f9f9f9'}"
                         onchange="document.getElementById('editAltRowBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Border Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editBorderColor" value="${element.settings.borderColor || '#e0e0e0'}">
                  <input type="text" class="property-input" id="editBorderColorText"
                         value="${element.settings.borderColor || '#e0e0e0'}"
                         onchange="document.getElementById('editBorderColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Border Radius</label>
                <select class="property-input" id="editBorderRadius">
                  <option value="0px" ${element.settings.borderRadius === '0px' ? 'selected' : ''}>None (0px)</option>
                  <option value="4px" ${element.settings.borderRadius === '4px' ? 'selected' : ''}>Small (4px)</option>
                  <option value="8px" ${element.settings.borderRadius === '8px' ? 'selected' : ''}>Medium (8px)</option>
                  <option value="12px" ${element.settings.borderRadius === '12px' ? 'selected' : ''}>Large (12px)</option>
                </select>
              </div>
            </div>
          `;

        case 'sizeChart':
          return `
            <div class="property-section">
              <div class="property-section-title">Customizable Size Chart</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle"
                       value="${element.settings.sectionTitle || 'Customizable Size Chart'}">
              </div>

              <div class="property-field">
                <label class="property-label">Table Headers (comma separated)</label>
                <input type="text" class="property-input" id="editTableHeaders"
                       value="${(element.settings.tableHeaders || []).join(', ')}">
              </div>

              <div class="property-field">
                <label class="property-label">Size Chart Rows (one row per line, columns separated by |)</label>
                <textarea class="property-input" id="editTableRows" rows="10" style="resize: vertical; font-size: 12px;">${(element.settings.tableRows || []).map(row => row.join(' | ')).join('\n')}</textarea>
              </div>

              <div class="property-field">
                <label class="property-label">Note Text</label>
                <textarea class="property-input" id="editNoteText" rows="2" style="resize: vertical;">${element.settings.noteText || ''}</textarea>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Typography Settings</div>

              <div class="property-field">
                <label class="property-label">Title Font Family</label>
                <select class="property-input" id="editTitleFontFamily">
                  <option value="inherit" ${element.settings.titleFontFamily === 'inherit' ? 'selected' : ''}>Default (Inherit)</option>
                  <option value="'Inter', sans-serif" ${element.settings.titleFontFamily === "'Inter', sans-serif" ? 'selected' : ''}>Inter</option>
                  <option value="'Roboto', sans-serif" ${element.settings.titleFontFamily === "'Roboto', sans-serif" ? 'selected' : ''}>Roboto</option>
                  <option value="'Open Sans', sans-serif" ${element.settings.titleFontFamily === "'Open Sans', sans-serif" ? 'selected' : ''}>Open Sans</option>
                  <option value="'Playfair Display', serif" ${element.settings.titleFontFamily === "'Playfair Display', serif" ? 'selected' : ''}>Playfair Display</option>
                  <option value="'Montserrat', sans-serif" ${element.settings.titleFontFamily === "'Montserrat', sans-serif" ? 'selected' : ''}>Montserrat</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Font Size</label>
                <select class="property-input" id="editTitleFontSize">
                  <option value="16px" ${element.settings.titleFontSize === '16px' ? 'selected' : ''}>16px - Small</option>
                  <option value="18px" ${element.settings.titleFontSize === '18px' ? 'selected' : ''}>18px - Medium</option>
                  <option value="20px" ${element.settings.titleFontSize === '20px' ? 'selected' : ''}>20px - Default</option>
                  <option value="24px" ${element.settings.titleFontSize === '24px' ? 'selected' : ''}>24px - Large</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Title Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTitleColor" value="${element.settings.titleColor || '#1a1a1a'}">
                  <input type="text" class="property-input" id="editTitleColorText"
                         value="${element.settings.titleColor || '#1a1a1a'}"
                         onchange="document.getElementById('editTitleColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Table Font Size</label>
                <select class="property-input" id="editTableFontSize">
                  <option value="12px" ${element.settings.tableFontSize === '12px' ? 'selected' : ''}>12px - Small</option>
                  <option value="13px" ${element.settings.tableFontSize === '13px' ? 'selected' : ''}>13px - Default</option>
                  <option value="14px" ${element.settings.tableFontSize === '14px' ? 'selected' : ''}>14px - Medium</option>
                </select>
              </div>

              <div class="property-field">
                <label class="property-label">Table Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editTableTextColor" value="${element.settings.tableTextColor || '#333333'}">
                  <input type="text" class="property-input" id="editTableTextColorText"
                         value="${element.settings.tableTextColor || '#333333'}"
                         onchange="document.getElementById('editTableTextColor').value = this.value">
                </div>
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">Background & Styling</div>

              <div class="property-field">
                <label class="property-label">Section Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editSectionBgColor" value="${element.settings.sectionBgColor || '#ffffff'}">
                  <input type="text" class="property-input" id="editSectionBgColorText"
                         value="${element.settings.sectionBgColor || '#ffffff'}"
                         onchange="document.getElementById('editSectionBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Header Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editHeaderBgColor" value="${element.settings.headerBgColor || '#f5f5f5'}">
                  <input type="text" class="property-input" id="editHeaderBgColorText"
                         value="${element.settings.headerBgColor || '#f5f5f5'}"
                         onchange="document.getElementById('editHeaderBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Header Text Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editHeaderTextColor" value="${element.settings.headerTextColor || '#1a1a1a'}">
                  <input type="text" class="property-input" id="editHeaderTextColorText"
                         value="${element.settings.headerTextColor || '#1a1a1a'}"
                         onchange="document.getElementById('editHeaderTextColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Row Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editRowBgColor" value="${element.settings.rowBgColor || '#ffffff'}">
                  <input type="text" class="property-input" id="editRowBgColorText"
                         value="${element.settings.rowBgColor || '#ffffff'}"
                         onchange="document.getElementById('editRowBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Alternate Row Background</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editAltRowBgColor" value="${element.settings.altRowBgColor || '#f9f9f9'}">
                  <input type="text" class="property-input" id="editAltRowBgColorText"
                         value="${element.settings.altRowBgColor || '#f9f9f9'}"
                         onchange="document.getElementById('editAltRowBgColor').value = this.value">
                </div>
              </div>

              <div class="property-field">
                <label class="property-label">Border Color</label>
                <div class="color-picker-wrapper">
                  <input type="color" id="editBorderColor" value="${element.settings.borderColor || '#e0e0e0'}">
                  <input type="text" class="property-input" id="editBorderColorText"
                         value="${element.settings.borderColor || '#e0e0e0'}"
                         onchange="document.getElementById('editBorderColor').value = this.value">
                </div>
              </div>
            </div>
          `;

        case 'faqSection':
          return `
            <div class="property-section">
              <div class="property-section-title">FAQ Section Settings</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle"
                       value="${element.settings.sectionTitle || 'Frequently Asked Questions (FAQ)'}">
              </div>

              <div class="property-field">
                <label class="property-label">Subtitle</label>
                <input type="text" class="property-input" id="editSubtitle"
                       value="${element.settings.subtitle || 'We have answers to all your Questions'}">
              </div>
            </div>

            <div class="property-section">
              <div class="property-section-title">FAQ Items</div>
              <p style="font-size: 11px; color: #666; margin-bottom: 12px;">Add questions and answers below. Separate Q&A with: ---</p>

              ${(element.settings.faqs || []).map((faq, i) => `
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                  <div class="property-field" style="margin-bottom: 8px;">
                    <label class="property-label">Question ${i + 1}</label>
                    <input type="text" class="property-input" id="editFaqQuestion${i}" value="${faq.question || ''}">
                  </div>
                  <div class="property-field" style="margin-bottom: 0;">
                    <label class="property-label">Answer ${i + 1}</label>
                    <textarea class="property-input" id="editFaqAnswer${i}" rows="2" style="resize: vertical;">${faq.answer || ''}</textarea>
                  </div>
                </div>
              `).join('')}

              <button type="button" onclick="addNewFaq()" style="width: 100%; padding: 10px; background: #8b5cf6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                <i class="fas fa-plus"></i> Add New FAQ
              </button>
            </div>
          `;

        case 'exploreTrends':
          return `
            <div class="property-section">
              <div class="property-section-title">Explore Trends Section</div>

              <div class="property-field">
                <label class="property-label">Section Title</label>
                <input type="text" class="property-input" id="editSectionTitle"
                       value="${element.settings.sectionTitle || 'Explore Latest Trends'}">
              </div>

              <div class="property-field">
                <label class="property-label">Subtitle</label>
                <input type="text" class="property-input" id="editSubtitle"
                       value="${element.settings.subtitle || 'You May Also Like'}">
              </div>

              <div class="property-toggle">
                <span class="toggle-label">Show Related Products</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="editShowProducts" ${element.settings.showProducts !== false ? 'checked' : ''}>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="property-field" style="margin-top: 12px;">
                <label class="property-label">Max Products to Show</label>
                <select class="property-input" id="editMaxProducts">
                  <option value="2" ${element.settings.maxProducts === 2 ? 'selected' : ''}>2 Products</option>
                  <option value="3" ${element.settings.maxProducts === 3 ? 'selected' : ''}>3 Products</option>
                  <option value="4" ${element.settings.maxProducts === 4 ? 'selected' : ''}>4 Products</option>
                  <option value="6" ${element.settings.maxProducts === 6 ? 'selected' : ''}>6 Products</option>
                </select>
              </div>
            </div>
          `;

        default:
          return `
            <div class="empty-state">
              <div class="empty-state-icon"><i class="fas fa-info-circle"></i></div>
              <div class="empty-state-title">No editable settings</div>
              <div class="empty-state-text">This element uses default settings from the CSS Styling panel.</div>
            </div>
          `;
      }
    }

    async function saveElementChanges() {
      if (!editingElement) return;

      switch (editingElement.id) {
        case 'selectShades':
          editingElement.settings.buttonText = document.getElementById('editButtonText')?.value || 'Select your shades';
          editingElement.settings.buttonColor = document.getElementById('editButtonColor')?.value || '#8E6545';
          editingElement.settings.buttonTextColor = document.getElementById('editButtonTextColor')?.value || '#FFFFFF';
          editingElement.settings.expanded = document.getElementById('editExpanded')?.checked || false;

          const showOptions = [];
          if (document.getElementById('editShowDimensions')?.checked) showOptions.push('dimensions');
          if (document.getElementById('editShowRoomLabel')?.checked) showOptions.push('roomLabel');
          if (document.getElementById('editShowShadeStyle')?.checked) showOptions.push('shadeStyle');
          if (document.getElementById('editShowMountType')?.checked) showOptions.push('mountType');
          if (document.getElementById('editShowControlType')?.checked) showOptions.push('controlType');
          if (document.getElementById('editShowSolarType')?.checked) showOptions.push('solarType');
          if (document.getElementById('editShowHardwareType')?.checked) showOptions.push('hardwareType');
          if (document.getElementById('editShowAccessories')?.checked) showOptions.push('accessories');
          editingElement.settings.showOptions = showOptions;

          // Save styling options
          editingElement.settings.fontFamily = document.getElementById('editFontFamily')?.value || 'inherit';
          editingElement.settings.fontSize = document.getElementById('editFontSize')?.value || '14px';
          editingElement.settings.backgroundColor = document.getElementById('editBackgroundColor')?.value || '#FFFFFF';
          editingElement.settings.borderRadius = document.getElementById('editBorderRadius')?.value || '8px';

          // Save dimensions section options
          editingElement.settings.dimensionsTitle = document.getElementById('editDimensionsTitle')?.value || 'Width X Height';
          editingElement.settings.widthLabel = document.getElementById('editWidthLabel')?.value || 'Width';
          editingElement.settings.heightLabel = document.getElementById('editHeightLabel')?.value || 'Height';
          editingElement.settings.unitLabel = document.getElementById('editUnitLabel')?.value || 'inches';
          editingElement.settings.minWidth = parseInt(document.getElementById('editMinWidth')?.value) || 12;
          editingElement.settings.maxWidth = parseInt(document.getElementById('editMaxWidth')?.value) || 96;
          editingElement.settings.minHeight = parseInt(document.getElementById('editMinHeight')?.value) || 12;
          editingElement.settings.maxHeight = parseInt(document.getElementById('editMaxHeight')?.value) || 120;

          // Save room label options
          editingElement.settings.roomLabelTitle = document.getElementById('editRoomLabelTitle')?.value || 'Room Label';
          editingElement.settings.roomLabelPlaceholder = document.getElementById('editRoomLabelPlaceholder')?.value || 'e.g., Living Room';

          // Save shade styles
          const parseOptionsWithPrice = (text) => {
            return (text || '').split('\n').filter(l => l.trim()).map(line => {
              const parts = line.split('|').map(p => p.trim());
              const price = parseInt((parts[1] || '0').replace(/[^0-9-]/g, '')) || 0;
              return { name: parts[0] || '', price: price };
            });
          };

          const parseOptionsWithDesc = (text) => {
            return (text || '').split('\n').filter(l => l.trim()).map(line => {
              const parts = line.split('|').map(p => p.trim());
              return { name: parts[0] || '', desc: parts[1] || '' };
            });
          };

          editingElement.settings.shadeStyles = parseOptionsWithPrice(document.getElementById('editShadeStyles')?.value);
          editingElement.settings.shadeStyleFontSize = document.getElementById('editShadeStyleFontSize')?.value || '13px';
          editingElement.settings.optionBgColor = document.getElementById('editOptionBgColor')?.value || '#f5f5f5';
          editingElement.settings.selectedOptionColor = document.getElementById('editSelectedOptionColor')?.value || '#8E6545';

          // Save mount types
          editingElement.settings.mountTypes = parseOptionsWithDesc(document.getElementById('editMountTypes')?.value);

          // Save control types
          editingElement.settings.controlTypes = parseOptionsWithPrice(document.getElementById('editControlTypes')?.value);

          // Save hardware types
          editingElement.settings.hardwareTypes = parseOptionsWithPrice(document.getElementById('editHardwareTypes')?.value);

          // Save accessories
          editingElement.settings.accessoriesOptions = parseOptionsWithPrice(document.getElementById('editAccessoriesOptions')?.value);
          break;

        case 'addToCart':
          editingElement.settings.buttonText = document.getElementById('editButtonText')?.value || 'Add to Cart';
          editingElement.settings.buttonColor = document.getElementById('editButtonColor')?.value || '#8E6545';
          editingElement.settings.buttonTextColor = document.getElementById('editButtonTextColor')?.value || '#FFFFFF';
          // Typography
          editingElement.settings.fontFamily = document.getElementById('editFontFamily')?.value || 'inherit';
          editingElement.settings.fontSize = document.getElementById('editFontSize')?.value || '14px';
          editingElement.settings.fontWeight = document.getElementById('editFontWeight')?.value || '600';
          // Button style
          editingElement.settings.borderRadius = document.getElementById('editBorderRadius')?.value || '8px';
          editingElement.settings.padding = document.getElementById('editPadding')?.value || '12px 24px';
          editingElement.settings.hoverColor = document.getElementById('editHoverColor')?.value || '#7a5639';
          break;

        case 'requestQuote':
          editingElement.settings.buttonText = document.getElementById('editButtonText')?.value || 'Request for Quote';
          editingElement.settings.buttonColor = document.getElementById('editButtonColor')?.value || '#4A5568';
          editingElement.settings.buttonTextColor = document.getElementById('editButtonTextColor')?.value || '#FFFFFF';
          editingElement.settings.showIcon = document.getElementById('editShowIcon')?.checked;
          break;

        case 'buyWithShopPay':
          editingElement.settings.enabled = document.getElementById('editEnabled')?.checked;
          editingElement.settings.showApplePay = document.getElementById('editShowApplePay')?.checked;
          editingElement.settings.showGooglePay = document.getElementById('editShowGooglePay')?.checked;
          editingElement.settings.showPayPal = document.getElementById('editShowPayPal')?.checked;
          break;

        case 'quantity':
          editingElement.settings.minQuantity = parseInt(document.getElementById('editMinQuantity')?.value) || 1;
          editingElement.settings.maxQuantity = parseInt(document.getElementById('editMaxQuantity')?.value) || 100;
          editingElement.settings.defaultQuantity = parseInt(document.getElementById('editDefaultQuantity')?.value) || 1;
          break;

        case 'productTitle':
          editingElement.settings.title = document.getElementById('editTitle')?.value || '';
          editingElement.settings.description = document.getElementById('editDescription')?.value || '';
          break;

        case 'trustBadges':
          editingElement.settings.showShipping = document.getElementById('editShowShipping')?.checked;
          editingElement.settings.showWarranty = document.getElementById('editShowWarranty')?.checked;
          editingElement.settings.showReturns = document.getElementById('editShowReturns')?.checked;
          break;

        case 'deliveryInfo':
          editingElement.settings.showEstimate = document.getElementById('editShowEstimate')?.checked;
          editingElement.settings.showFreeShipping = document.getElementById('editShowFreeShipping')?.checked;
          break;

        case 'dimensions':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Dimensions';
          editingElement.settings.widthLabel = document.getElementById('editWidthLabel')?.value || 'Width';
          editingElement.settings.heightLabel = document.getElementById('editHeightLabel')?.value || 'Height';
          editingElement.settings.unit = document.getElementById('editUnit')?.value || 'inches';
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          editingElement.settings.inputBorderColor = document.getElementById('editInputBorderColor')?.value || '#E8E4E0';
          break;

        case 'roomLabel':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Room Label';
          editingElement.settings.placeholder = document.getElementById('editPlaceholder')?.value || 'e.g., Living Room, Bedroom';
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          break;

        case 'shadeStyle':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Shade Style';
          // Parse options from textarea
          const shadeOptions = (document.getElementById('editOptions')?.value || '').split('\n').filter(l => l.trim()).map(line => {
            const [name, price] = line.split('|').map(s => s.trim());
            return { name: name || '', price: parseFloat(price) || 0 };
          });
          editingElement.settings.options = shadeOptions;
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.optionFontSize = document.getElementById('editOptionFontSize')?.value || '13px';
          editingElement.settings.optionColor = document.getElementById('editOptionColor')?.value || '#333333';
          editingElement.settings.optionBgColor = document.getElementById('editOptionBgColor')?.value || '#ffffff';
          editingElement.settings.selectedBgColor = document.getElementById('editSelectedBgColor')?.value || '#8E6545';
          editingElement.settings.selectedTextColor = document.getElementById('editSelectedTextColor')?.value || '#ffffff';
          editingElement.settings.priceColor = document.getElementById('editPriceColor')?.value || '#8E6545';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          break;

        case 'mountType':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Mount Type';
          // Parse options from textarea
          const mountOptions = (document.getElementById('editOptions')?.value || '').split('\n').filter(l => l.trim()).map(line => {
            const [name, description] = line.split('|').map(s => s.trim());
            return { name: name || '', description: description || '' };
          });
          editingElement.settings.options = mountOptions;
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.optionColor = document.getElementById('editOptionColor')?.value || '#333333';
          editingElement.settings.selectedBgColor = document.getElementById('editSelectedBgColor')?.value || '#8E6545';
          editingElement.settings.selectedTextColor = document.getElementById('editSelectedTextColor')?.value || '#ffffff';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          break;

        case 'controlType':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Control Type';
          // Parse options from textarea
          const controlOptions = (document.getElementById('editOptions')?.value || '').split('\n').filter(l => l.trim()).map(line => {
            const [name, price] = line.split('|').map(s => s.trim());
            return { name: name || '', price: parseFloat(price) || 0 };
          });
          editingElement.settings.options = controlOptions;
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.optionColor = document.getElementById('editOptionColor')?.value || '#333333';
          editingElement.settings.selectedBgColor = document.getElementById('editSelectedBgColor')?.value || '#8E6545';
          editingElement.settings.priceColor = document.getElementById('editPriceColor')?.value || '#8E6545';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          break;

        case 'hardwareType':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Hardware Type';
          // Parse options from textarea
          const hardwareOptions = (document.getElementById('editOptions')?.value || '').split('\n').filter(l => l.trim()).map(line => {
            const [name, price] = line.split('|').map(s => s.trim());
            return { name: name || '', price: parseFloat(price) || 0 };
          });
          editingElement.settings.options = hardwareOptions;
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.optionColor = document.getElementById('editOptionColor')?.value || '#333333';
          editingElement.settings.selectedBgColor = document.getElementById('editSelectedBgColor')?.value || '#8E6545';
          editingElement.settings.priceColor = document.getElementById('editPriceColor')?.value || '#8E6545';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          break;

        case 'accessories':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Accessories';
          // Parse options from textarea
          const accessoryOptions = (document.getElementById('editOptions')?.value || '').split('\n').filter(l => l.trim()).map(line => {
            const [name, price] = line.split('|').map(s => s.trim());
            return { name: name || '', price: parseFloat(price) || 0 };
          });
          editingElement.settings.options = accessoryOptions;
          editingElement.settings.multiSelect = document.getElementById('editMultiSelect')?.checked;
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '14px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#333333';
          editingElement.settings.optionColor = document.getElementById('editOptionColor')?.value || '#333333';
          editingElement.settings.checkboxColor = document.getElementById('editCheckboxColor')?.value || '#8E6545';
          editingElement.settings.priceColor = document.getElementById('editPriceColor')?.value || '#8E6545';
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || 'transparent';
          break;

        case 'productDetails':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Product Details';
          editingElement.settings.featuresTitle = document.getElementById('editFeaturesTitle')?.value || 'Features';
          editingElement.settings.features = (document.getElementById('editFeaturesList')?.value || '').split('\n').filter(f => f.trim());
          editingElement.settings.careTitle = document.getElementById('editCareTitle')?.value || 'Care Instructions';
          editingElement.settings.careText = document.getElementById('editCareText')?.value || '';
          editingElement.settings.warrantyTitle = document.getElementById('editWarrantyTitle')?.value || 'Warranty';
          editingElement.settings.warrantyText = document.getElementById('editWarrantyText')?.value || '';
          break;

        case 'productCatalogs':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Product Catalogs';
          editingElement.settings.productFeaturesTitle = document.getElementById('editProductFeaturesTitle')?.value || 'Product Features';
          editingElement.settings.productFeaturesText = document.getElementById('editProductFeaturesText')?.value || '';
          editingElement.settings.sideCoverColors = document.getElementById('editSideCoverColors')?.value || 'White, Gray, Black';

          // Parse options from textarea (format: Name | Description)
          const parseOptions = (text) => {
            return (text || '').split('\n').filter(l => l.trim()).map(line => {
              const parts = line.split('|').map(p => p.trim());
              return { name: parts[0] || '', desc: parts[1] || '' };
            });
          };

          editingElement.settings.valanceOptions = parseOptions(document.getElementById('editValanceOptions')?.value);
          editingElement.settings.bottomRailOptions = parseOptions(document.getElementById('editBottomRailOptions')?.value);
          editingElement.settings.controlSystems = parseOptions(document.getElementById('editControlSystems')?.value);
          editingElement.settings.configFeatures = parseOptions(document.getElementById('editConfigFeatures')?.value);
          editingElement.settings.lightBlockerOptions = parseOptions(document.getElementById('editLightBlockerOptions')?.value);
          break;

        case 'productTypeSpecs':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Product Type Specifications';
          editingElement.settings.tableHeaders = (document.getElementById('editTableHeaders')?.value || '').split(',').map(h => h.trim());
          editingElement.settings.tableRows = (document.getElementById('editTableRows')?.value || '').split('\n').filter(r => r.trim()).map(row => row.split('|').map(c => c.trim()));
          // Typography settings
          editingElement.settings.titleFontFamily = document.getElementById('editTitleFontFamily')?.value || 'inherit';
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '20px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#1a1a1a';
          editingElement.settings.tableFontFamily = document.getElementById('editTableFontFamily')?.value || 'inherit';
          editingElement.settings.tableFontSize = document.getElementById('editTableFontSize')?.value || '13px';
          editingElement.settings.tableTextColor = document.getElementById('editTableTextColor')?.value || '#333333';
          // Background & styling
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || '#ffffff';
          editingElement.settings.headerBgColor = document.getElementById('editHeaderBgColor')?.value || '#f5f5f5';
          editingElement.settings.headerTextColor = document.getElementById('editHeaderTextColor')?.value || '#1a1a1a';
          editingElement.settings.rowBgColor = document.getElementById('editRowBgColor')?.value || '#ffffff';
          editingElement.settings.altRowBgColor = document.getElementById('editAltRowBgColor')?.value || '#f9f9f9';
          editingElement.settings.borderColor = document.getElementById('editBorderColor')?.value || '#e0e0e0';
          editingElement.settings.borderRadius = document.getElementById('editBorderRadius')?.value || '0px';
          break;

        case 'sizeChart':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Customizable Size Chart';
          editingElement.settings.tableHeaders = (document.getElementById('editTableHeaders')?.value || '').split(',').map(h => h.trim());
          editingElement.settings.tableRows = (document.getElementById('editTableRows')?.value || '').split('\n').filter(r => r.trim()).map(row => row.split('|').map(c => c.trim()));
          editingElement.settings.noteText = document.getElementById('editNoteText')?.value || '';
          // Typography settings
          editingElement.settings.titleFontFamily = document.getElementById('editTitleFontFamily')?.value || 'inherit';
          editingElement.settings.titleFontSize = document.getElementById('editTitleFontSize')?.value || '20px';
          editingElement.settings.titleColor = document.getElementById('editTitleColor')?.value || '#1a1a1a';
          editingElement.settings.tableFontSize = document.getElementById('editTableFontSize')?.value || '13px';
          editingElement.settings.tableTextColor = document.getElementById('editTableTextColor')?.value || '#333333';
          // Background & styling
          editingElement.settings.sectionBgColor = document.getElementById('editSectionBgColor')?.value || '#ffffff';
          editingElement.settings.headerBgColor = document.getElementById('editHeaderBgColor')?.value || '#f5f5f5';
          editingElement.settings.headerTextColor = document.getElementById('editHeaderTextColor')?.value || '#1a1a1a';
          editingElement.settings.rowBgColor = document.getElementById('editRowBgColor')?.value || '#ffffff';
          editingElement.settings.altRowBgColor = document.getElementById('editAltRowBgColor')?.value || '#f9f9f9';
          editingElement.settings.borderColor = document.getElementById('editBorderColor')?.value || '#e0e0e0';
          break;

        case 'faqSection':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Frequently Asked Questions (FAQ)';
          editingElement.settings.subtitle = document.getElementById('editSubtitle')?.value || 'We have answers to all your Questions';

          // Collect FAQ items
          const faqs = [];
          let i = 0;
          while (document.getElementById('editFaqQuestion' + i)) {
            faqs.push({
              question: document.getElementById('editFaqQuestion' + i)?.value || '',
              answer: document.getElementById('editFaqAnswer' + i)?.value || ''
            });
            i++;
          }
          editingElement.settings.faqs = faqs.filter(f => f.question.trim());
          break;

        case 'exploreTrends':
          editingElement.settings.sectionTitle = document.getElementById('editSectionTitle')?.value || 'Explore Latest Trends';
          editingElement.settings.subtitle = document.getElementById('editSubtitle')?.value || 'You May Also Like';
          editingElement.settings.showProducts = document.getElementById('editShowProducts')?.checked;
          editingElement.settings.maxProducts = parseInt(document.getElementById('editMaxProducts')?.value) || 4;
          break;

        case 'specifications':
          editingElement.settings.showMaterial = document.getElementById('editShowMaterial')?.checked;
          editingElement.settings.showDimensions = document.getElementById('editShowSpecDimensions')?.checked;
          editingElement.settings.showWeight = document.getElementById('editShowWeight')?.checked;
          break;

        case 'features':
          editingElement.settings.badges = [
            document.getElementById('editBadge1')?.value || '',
            document.getElementById('editBadge2')?.value || '',
            document.getElementById('editBadge3')?.value || ''
          ].filter(b => b.trim());
          break;

        case 'reviews':
          editingElement.settings.showRating = document.getElementById('editShowRating')?.checked;
          editingElement.settings.showCount = document.getElementById('editShowCount')?.checked;
          break;

        case 'price':
          editingElement.settings.showOriginalPrice = document.getElementById('editShowOriginalPrice')?.checked;
          editingElement.settings.showDiscount = document.getElementById('editShowDiscount')?.checked;
          editingElement.settings.currency = document.getElementById('editCurrency')?.value || 'USD';
          // Price label settings
          editingElement.settings.showPriceLabel = document.getElementById('editShowPriceLabel')?.checked;
          editingElement.settings.priceLabelText = document.getElementById('editPriceLabelText')?.value || 'Base Price:';
          editingElement.settings.priceLabelPosition = document.getElementById('editPriceLabelPosition')?.value || 'left';
          editingElement.settings.priceLabelFontSize = document.getElementById('editPriceLabelFontSize')?.value || '14px';
          editingElement.settings.priceLabelColor = document.getElementById('editPriceLabelColor')?.value || '#666666';
          // Typography settings
          editingElement.settings.priceFontFamily = document.getElementById('editPriceFontFamily')?.value || 'inherit';
          editingElement.settings.priceFontSize = document.getElementById('editPriceFontSize')?.value || '24px';
          editingElement.settings.priceFontWeight = document.getElementById('editPriceFontWeight')?.value || '700';
          editingElement.settings.priceColor = document.getElementById('editPriceColor')?.value || '#8E6545';
          // Original price styling
          editingElement.settings.originalPriceFontSize = document.getElementById('editOriginalPriceFontSize')?.value || '18px';
          editingElement.settings.originalPriceColor = document.getElementById('editOriginalPriceColor')?.value || '#999999';
          // Discount badge styling
          editingElement.settings.discountBgColor = document.getElementById('editDiscountBgColor')?.value || '#e74c3c';
          editingElement.settings.discountTextColor = document.getElementById('editDiscountTextColor')?.value || '#ffffff';
          editingElement.settings.discountFontSize = document.getElementById('editDiscountFontSize')?.value || '14px';
          break;
      }

      markUnsaved();
      saveElementPositions();
      renderLayoutBuilder();
      closeEditPanel();

      // Auto-save to server
      showToast('Saving changes...', 'info');
      await saveAllChanges();
    }

    window.addEventListener('beforeunload', (e) => {
      if (hasUnsavedChanges) {
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>
</body>
</html>
